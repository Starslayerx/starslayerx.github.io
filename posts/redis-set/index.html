<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Redis Set | Starslayerx' Blog</title><meta name=keywords content="Redis"><meta name=description content="Redis 的集和 set 键允许用户将任意多个不同的元素存储到集和中, 既可以是文本数据, 也可以是二进制数据. 其与列表有以下两个明显的区别:

列表可以存储重复元素, 而集和只存储非重复元素
列表以有序方式存储元素, 而集和则以无序方式存储元素

下面介绍结合键的各个命令
Set 集和


SADD: 将元素添加到集和
SADD set element [element ...]
返回成功添加的新元素数量作为返回值, 由于集和不存储相同元素, 所以会自动忽略重复的元素


SREM: 从集和中移出元素
SREM set element [element ...]
返回被移除的元素数量, 同样的, 不存在的元素会被忽略


SMOVE: 将元素从一个集和移动到另一个集和
SMOVE source target element
移动操作成功时返回1, 若不存在于源集和, 返回0.
如果 source 的元素不存在, 则返回0表示失败.
如果 target 的元素已存在, 则会覆盖该元素. 从结果来看, 并不会导致 target 中元素变化, 但是会导致 source 中的该元素消失.


SMEMBERS: 获取集和包含的所有元素
SMEMBERS set
由于集和是无序的, 且 SMEMBERS 命令不会进行任何排序操作, 所以根据元素添加的顺序不同, 含相同元素的集和执行该命令结果可能不同.


SCARD: 获取集和包含的元素数量
SCARD set


SISMEMBER: 检查给定元素是否存在于集和"><meta name=author content="Starslayerx"><link rel=canonical href=https://starslayerx.github.io/posts/redis-set/><link crossorigin=anonymous href=/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css integrity="sha256-2jIR5e+Ge/K3X9WmUVz+1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as=style><link rel=icon href=https://starslayerx.github.io/favicon.svg><link rel=icon type=image/png sizes=16x16 href=https://starslayerx.github.io/favicon.svg><link rel=icon type=image/png sizes=32x32 href=https://starslayerx.github.io/favicon.svg><link rel=apple-touch-icon href=https://starslayerx.github.io/favicon.svg><link rel=mask-icon href=https://starslayerx.github.io/favicon.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://starslayerx.github.io/posts/redis-set/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://starslayerx.github.io/posts/redis-set/"><meta property="og:site_name" content="Starslayerx' Blog"><meta property="og:title" content="Redis Set"><meta property="og:description" content="Redis 的集和 set 键允许用户将任意多个不同的元素存储到集和中, 既可以是文本数据, 也可以是二进制数据. 其与列表有以下两个明显的区别:
列表可以存储重复元素, 而集和只存储非重复元素 列表以有序方式存储元素, 而集和则以无序方式存储元素 下面介绍结合键的各个命令
Set 集和 SADD: 将元素添加到集和
SADD set element [element ...] 返回成功添加的新元素数量作为返回值, 由于集和不存储相同元素, 所以会自动忽略重复的元素
SREM: 从集和中移出元素
SREM set element [element ...] 返回被移除的元素数量, 同样的, 不存在的元素会被忽略
SMOVE: 将元素从一个集和移动到另一个集和
SMOVE source target element 移动操作成功时返回1, 若不存在于源集和, 返回0.
如果 source 的元素不存在, 则返回0表示失败.
如果 target 的元素已存在, 则会覆盖该元素. 从结果来看, 并不会导致 target 中元素变化, 但是会导致 source 中的该元素消失.
SMEMBERS: 获取集和包含的所有元素
SMEMBERS set 由于集和是无序的, 且 SMEMBERS 命令不会进行任何排序操作, 所以根据元素添加的顺序不同, 含相同元素的集和执行该命令结果可能不同.
SCARD: 获取集和包含的元素数量
SCARD set SISMEMBER: 检查给定元素是否存在于集和"><meta property="og:locale" content="en-US"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-26T08:00:00+08:00"><meta property="article:modified_time" content="2025-08-26T08:00:00+08:00"><meta property="article:tag" content="Redis"><meta property="og:image" content="https://starslayerx.github.io/images/og-default.avif"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://starslayerx.github.io/images/og-default.avif"><meta name=twitter:title content="Redis Set"><meta name=twitter:description content="Redis 的集和 set 键允许用户将任意多个不同的元素存储到集和中, 既可以是文本数据, 也可以是二进制数据. 其与列表有以下两个明显的区别:

列表可以存储重复元素, 而集和只存储非重复元素
列表以有序方式存储元素, 而集和则以无序方式存储元素

下面介绍结合键的各个命令
Set 集和


SADD: 将元素添加到集和
SADD set element [element ...]
返回成功添加的新元素数量作为返回值, 由于集和不存储相同元素, 所以会自动忽略重复的元素


SREM: 从集和中移出元素
SREM set element [element ...]
返回被移除的元素数量, 同样的, 不存在的元素会被忽略


SMOVE: 将元素从一个集和移动到另一个集和
SMOVE source target element
移动操作成功时返回1, 若不存在于源集和, 返回0.
如果 source 的元素不存在, 则返回0表示失败.
如果 target 的元素已存在, 则会覆盖该元素. 从结果来看, 并不会导致 target 中元素变化, 但是会导致 source 中的该元素消失.


SMEMBERS: 获取集和包含的所有元素
SMEMBERS set
由于集和是无序的, 且 SMEMBERS 命令不会进行任何排序操作, 所以根据元素添加的顺序不同, 含相同元素的集和执行该命令结果可能不同.


SCARD: 获取集和包含的元素数量
SCARD set


SISMEMBER: 检查给定元素是否存在于集和"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://starslayerx.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Redis Set","item":"https://starslayerx.github.io/posts/redis-set/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Redis Set","name":"Redis Set","description":"Redis 的集和 set 键允许用户将任意多个不同的元素存储到集和中, 既可以是文本数据, 也可以是二进制数据. 其与列表有以下两个明显的区别:\n列表可以存储重复元素, 而集和只存储非重复元素 列表以有序方式存储元素, 而集和则以无序方式存储元素 下面介绍结合键的各个命令\nSet 集和 SADD: 将元素添加到集和\nSADD set element [element ...] 返回成功添加的新元素数量作为返回值, 由于集和不存储相同元素, 所以会自动忽略重复的元素\nSREM: 从集和中移出元素\nSREM set element [element ...] 返回被移除的元素数量, 同样的, 不存在的元素会被忽略\nSMOVE: 将元素从一个集和移动到另一个集和\nSMOVE source target element 移动操作成功时返回1, 若不存在于源集和, 返回0.\n如果 source 的元素不存在, 则返回0表示失败.\n如果 target 的元素已存在, 则会覆盖该元素. 从结果来看, 并不会导致 target 中元素变化, 但是会导致 source 中的该元素消失.\nSMEMBERS: 获取集和包含的所有元素\nSMEMBERS set 由于集和是无序的, 且 SMEMBERS 命令不会进行任何排序操作, 所以根据元素添加的顺序不同, 含相同元素的集和执行该命令结果可能不同.\nSCARD: 获取集和包含的元素数量\nSCARD set SISMEMBER: 检查给定元素是否存在于集和\n","keywords":["Redis"],"articleBody":"Redis 的集和 set 键允许用户将任意多个不同的元素存储到集和中, 既可以是文本数据, 也可以是二进制数据. 其与列表有以下两个明显的区别:\n列表可以存储重复元素, 而集和只存储非重复元素 列表以有序方式存储元素, 而集和则以无序方式存储元素 下面介绍结合键的各个命令\nSet 集和 SADD: 将元素添加到集和\nSADD set element [element ...] 返回成功添加的新元素数量作为返回值, 由于集和不存储相同元素, 所以会自动忽略重复的元素\nSREM: 从集和中移出元素\nSREM set element [element ...] 返回被移除的元素数量, 同样的, 不存在的元素会被忽略\nSMOVE: 将元素从一个集和移动到另一个集和\nSMOVE source target element 移动操作成功时返回1, 若不存在于源集和, 返回0.\n如果 source 的元素不存在, 则返回0表示失败.\n如果 target 的元素已存在, 则会覆盖该元素. 从结果来看, 并不会导致 target 中元素变化, 但是会导致 source 中的该元素消失.\nSMEMBERS: 获取集和包含的所有元素\nSMEMBERS set 由于集和是无序的, 且 SMEMBERS 命令不会进行任何排序操作, 所以根据元素添加的顺序不同, 含相同元素的集和执行该命令结果可能不同.\nSCARD: 获取集和包含的元素数量\nSCARD set SISMEMBER: 检查给定元素是否存在于集和\nSISMEMBER set element 返回1表示给定的元素存在于集和中, 返回0表示不存在于集和中.\n示例: 唯一计数器 例如, 一个网站想要统计浏览量和用户量\n流览量可以使用是网页被用户访问的次数, 一个用户可以多次访问. 这种类型的数量使用字符串键或者散列键都可以实现 用户数量是访问网站的 IP 地址数量, 这时候就需要构建一个更加严格的计数器, 对每个 IP 地址进行一次次数, 这种计数器就是唯一计数器(unique counter) from redis import Redis class UniqueCounter: def __init__(self, client, key): self.client = client self.key = key def count_in(self, item): return self.client.sadd(self.key, item) def get_result(self): return self.client.scard(self.key) client = Redis(decode_responses=True) counter = UniqueCounter(client, \"ip counter\") print(\"Add ip\", counter.count_in(\"8.8.8.8\")) print(\"Add ip\", counter.count_in(\"9.9.9.9\")) print(\"Add ip\", counter.count_in(\"10.10.10.10\")) print(\"Numbers of IP:\", counter.get_result()) 示例: 点赞 点赞功能可以使用集和来实现, 保证了每个用户对同一个内容只能点1次赞\nfrom redis import Redis class Like: def __init__(self, client, key): self.client = client self.key = key def cast(self, user): \"\"\"执行点赞 True/False\"\"\" return self.client.sadd(self.key, user) def undo(self, user): \"\"\"取消点赞\"\"\" self.client.srem(self.key, user) def is_liked(self, user): \"\"\"是否已点赞\"\"\" return self.client.sismember(self.key, user) def get_all_liked_users(self): \"\"\"所有点赞用户\"\"\" return self.client.smembers(self.key) def count(self): \"\"\"点赞人数\"\"\" return self.client.scard(self.key) client = Redis(decode_responses=True) like_topic = Like(client, \"topic::10086::like\") print(\"Peter like:\", like_topic.cast(\"peter\")) print(\"Mary like:\", like_topic.cast(\"mary\")) print(\"Liked Users:\", like_topic.get_all_liked_users()) print(\"How many likes:\", like_topic.count()) print(\"Peter liked:\", like_topic.is_liked(\"peter\")) print(\"Dan liked:\", like_topic.is_liked(\"dan\")) 示例: 投票 问答网站、文章推荐网、论坛这类注重内容质量的网站上通常会提供投票功能, 用户可以通过投票来支持一项内容或者反对一项内容:\n支持票越多的文章, 会被网站安排到更显眼的位置, 使得网站的用户快速流览高质量内容. 反对票越多的文章, 则会被放到更不明显的位置, 甚至被当作广告隐藏起来, 使得用户可以忽略这些低质量内容. 例如 Stackoverflow 上面会对回答的答案进行投票, 帮助用户发现高质量的问题和答案.\nfrom redis import Redis def vote_up_key(vote_target): \"\"\"赞成 vote_target 用户集和 key\"\"\" return vote_target + \"::vote_up\" def vote_down_key(vote_target): \"\"\"反对 vote_target 用户集和 key\"\"\" return vote_target + \"::vote_down\" class Vote: def __init__(self, client, vote_target): self.client = client self.vote_up_set = vote_up_key(vote_target) self.vote_down_set = vote_down_key(vote_target) def is_voted(self, user): \"\"\"检查用户是否已投过票\"\"\" return self.client.sismember(self.vote_up_set, user) or self.client.sismember(self.vote_down_set, user) def vote_up(self, user): \"\"\"user 投赞成票\"\"\" if self.is_voted(user): return False self.client.sadd(self.vote_up_set, user) return True def vote_down(self, user): \"\"\"user 投反对票\"\"\" if self.is_voted(user): return False self.client.sadd(self.vote_down_set, user) return True def undo(self, user): \"\"\"取消用户投票\"\"\" self.client.srem(self.vote_up_set, user) self.client.srem(self.vote_down_set, user) def vote_up_count(self): \"\"\"赞成票的数量\"\"\" return self.client.scard(self.vote_up_set) def get_all_vote_up_users(self): \"\"\"所有投赞成票的用户\"\"\" return self.client.smembers(self.vote_up_set) def vote_down_count(self): \"\"\"反对票的数量\"\"\" return self.client.scard(self.vote_down_set) def get_all_vote_down_users(self): \"\"\"所有投反对票的用户\"\"\" return self.client.smembers(self.vote_down_set) client = Redis(decode_responses=True) # 是否将字节数据自动解码额日字符串 question_vote = Vote(client, \"question::10\") print(\"Peter 投支持票:\", question_vote.vote_up(\"peter\")) print(\"Jack 投支持票:\", question_vote.vote_up(\"jack\")) print(\"Tom 投支持票:\", question_vote.vote_up(\"tom\")) print(\"Mary 投反对票:\", question_vote.vote_down(\"mary\")) print(\"支持票数量:\", question_vote.vote_up_count()) print(\"反对票数量:\", question_vote.vote_down_count()) print(\"支持票用户:\", question_vote.get_all_vote_up_users()) print(\"反对票用户:\", question_vote.get_all_vote_down_users()) # 取消用户投票(为了多次运行代码) question_vote.undo(\"peter\") question_vote.undo(\"jack\") question_vote.undo(\"tom\") question_vote.undo(\"mary\") 示例: 社交关系 Twitter 这类社交软件都可以通过关注或者加好友的方式, 构成一种社交关系. 这些网站上的用户都可以关注其他用户, 也可以被其他用户关注. 通过正在关注名单(following list), 用户可以查看自己正在关注的用户及其人数; 通过关注者名单(follower list), 用户可以查看有哪些人正在关注自己.\n下面使用集和来维护这种关系:\n程序为每个用户维护两个集和: 一个集和存储用户的正在关注名单, 另一个集和存储用户的关注者名单. 当 A 关注 B 的时候, 将 A 加入自己的 following list, 并加入 B 的follower list. 当 A 取消对 B 的关注的时候, 将 A 从自己的 following list 移出, 并将 A 从 B 的 follower list 移除. def following_key(user): return user + \"::following\" def follower_key(user): return user + \"::follower\" class Relationship: def __init__(self, client, user): self.client = client self.user = user def follow(self, target): \"\"\"关注目标用户\"\"\" user_following_set = following_key(self.user) self.client.sadd(user_following_set, target) target_follower_set = follower_key(target) self.client.sadd(target_follower_set, self.user) def unfollow(self, target): \"\"\"取消关注目标用户\"\"\" user_following_set = following_key(self.user) self.client.srem(user_following_set, target) target_follower_set = follower_key(target) self.client.srem(target_follower_set, self.user) def is_following(self, target): \"\"\"是否关注了目标用户\"\"\" user_following_set = following_key(self.user) return self.client.sismember(user_following_set, target) def get_all_following(self): \"\"\"所有user关注的用户\"\"\" user_following_set = following_key(self.user) return self.client.smembers(user_following_set) def get_all_follower(self): \"\"\"所有关注user的用户\"\"\" user_follower_set = follower_key(self.user) return self.client.smembers(user_follower_set) def count_following(self): \"\"\"user关注的用户数量\"\"\" user_following_set = following_key(self.user) return self.client.scard(user_following_set) def count_follower(self): \"\"\"关注user的用户数量\"\"\" user_follower_set = follower_key(self.user) return self.client.scard(user_follower_set) SRANDMEMBER: 随机获取集和中的元素\nSRANDMEMBER set [count] 该命令接受一个可选的 count 参数, 用于指定用户想要获取的元素数量. 默认只返回一个元素.\n如果 count 为正数, 将返回 count 个不重复的元素. 当 count 值大于集的元素数量, 将返回集和所有元素.\n如果 count 为负数, 则随机返回 abs(count) 个元素, 并且允许出现重复值.\nSPOP: 随机地从集和中移出指定数量的元素\nSPOP key [count] 该命令会返回被移除的元素值作为命令的返回值.\ncount 参数不同于 SRANDMEMBER 命令的参数, 其值只能为正数\n示例: 抽奖 为了推销产品并回馈消费者, 商家经常举办一些抽奖活动, 消费者可以抽奖获取礼品. 下面代码展示了使用集和实现的抽象程序, 这个成会把所有参与抽奖的玩家都添加到一个集和中, 然后通过 SRANDMEMBER 命令随机地选出获奖者.\nclass Lottery: def __init__(self, client, key): self.client = client self.key = key def add_player(self, user): \"\"\"添加用户到抽奖名单中\"\"\" self.client.sadd(self.key, user) def get_all_players(self): \"\"\"返回参加抽奖活动的所有用户\"\"\" return self.client.smembers(self.key) def player_count(self): \"\"\"返回抽奖用户数量\"\"\" return self.client.scard(self.key) def draw(self, number): \"\"\"抽取指定数量的获奖者\"\"\" return self.client.srandmember(self.key, number) 考虑到完整的抽奖者名单可能会有用, 所以这个抽奖程序使用了随机获取元素的 SRANDMEMBER 命令, 而不是随机移除元素的 SPOP 命令. 如果不需要保留完整的名单, 也可以使用 SPOP 命令实现抽奖程序.\nSINTER、SINTERSTORE: 对集和执行交集计算\nSINTER set [set ...] 该命令计算用户给定的所有集和的交集, 返回交集的所有元素.\n此外, 还有 SINTERSTORE 命令, 将集和的交集计算结果存储到指定的键里面.\nSINTERSTORE destination_key set [set ...] 如果给定的键已存在, 则 SINTERSTORE 命令结果会覆盖原来的集和键\nSUNION、SUNIONSTORE: 对集和执行并集计算\nSUNION set [set ...] 并集计算类似上面的交集计算\nSDIFF、SDIFFSTORE: 对集和执行差集计算\nSDIFF set [set ...] SDIFF 命令会安装用户给定集和的顺序, 从左到右依次对给定的集和执行差集计算.\n因为对集合执行交集、并集、差集等集合计算需要耗费大量的资源, 所以用户应该尽量使用SINTERSTORE等命令来存储并重用计算结果, 而不要每次都重复进行计算. 此外, 当集合计算涉及的元素数量非常大时, Redis服务器在进行计算时可能会被阻塞. 这时, 可以考虑使用Redis的复制功能, 通过从服务器来执行集合计算任务, 从而确保主服务器可以继续处理其他客户端发送的命令请求.\n共同关注与推荐关注\n前面使用集和实现了社交网站好友关系的存储, 即关注和被关注列表. 除此之外, 社交网站还通常会提供一些额外功能, 例如共同关注, 推荐关注等.\n要实现共同关注功能, 程序需要计算出两个用户正在关注集和之间的交集.\n推荐关注可以从用户关注集和中, 随机选出指定数量的用户作为种子用户, 然后对这些用户的正在管组集和执行并集计算, 最后从这个并集中随机选出一些推荐关注的对象. 示例: 使用反向索引构建商品筛选器 在访问购物类网站的时候, 通常可以通过一些标签来筛选产品. 这时候, 对每个产品可以建立一个集和, 对每个标签也都建立一个集和, 这样就得到了一份物品到关键字, 以及关键字到物品的映射关系.\ndef make_item_key(item): return \"InvertedIndex::\" + item + \"::keyword\" def make_keyword_key(keyword): return \"InvertedIndex::\" + keyword + \"::item\" class InvertedIndex: def __init__(self, client): self.client = client def add_index(self, item, *keywords): \"\"\"为物品添加关键字\"\"\" # 将给定物品添加到 item_key = make_item_key(item) result = self.client.sadd(item_key, *keywords) # 遍历关键字集和, 将该物品添加进去 for keyword in keywords: keyword_key = make_keyword_key(keyword) self.client.sadd(keyword_key, item) # 返回添加关键字数量作为结果 return result def remove_index(self, item, *keywords): \"\"\"移除物品的关键字\"\"\" item_key = make_item_key(item) result = self.client.srem(item_key, *keywords) for keyword in keywords: keyword_key = make_keyword_key(keyword) self.client.srem(keyword_key, item) return result def get_keywords(self, item): \"\"\"获取物品所有的关键字\"\"\" return self.client.smembers(make_item_key(item)) def get_items(self, *keywords): \"\"\"根据给定的关键字获取物品\"\"\" # 根据给定的关键字计算出与之对应的集合 key keyword_key_list = map(make_keyword_key, keywords) # 将这些集和 key 做并集 return self.client.sinter(*keyword_key_list) ","wordCount":"780","inLanguage":"en","image":"https://starslayerx.github.io/images/og-default.avif","datePublished":"2025-08-26T08:00:00+08:00","dateModified":"2025-08-26T08:00:00+08:00","author":{"@type":"Person","name":"Starslayerx"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://starslayerx.github.io/posts/redis-set/"},"publisher":{"@type":"Organization","name":"Starslayerx' Blog","logo":{"@type":"ImageObject","url":"https://starslayerx.github.io/favicon.svg"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://starslayerx.github.io/ accesskey=h title="Starslayerx' Blog (Alt + H)"><img src=https://starslayerx.github.io/favicon.svg alt aria-label=logo height=35>Starslayerx' Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://starslayerx.github.io/zh-cn/ title=简体中文 aria-label=简体中文>Zh-Cn</a></li></ul></div></div><ul id=menu><li><a href=https://starslayerx.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://starslayerx.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://starslayerx.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://starslayerx.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://starslayerx.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://starslayerx.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://starslayerx.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Redis Set</h1><div class=post-meta><span title='2025-08-26 08:00:00 +0800 +0800'>August 26, 2025</span>&nbsp;·&nbsp;<span>4 min</span>&nbsp;·&nbsp;<span>780 words</span>&nbsp;·&nbsp;<span>Starslayerx</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#set-集和>Set 集和</a><ul><li><a href=#示例-唯一计数器>示例: 唯一计数器</a></li><li><a href=#示例-点赞>示例: 点赞</a></li><li><a href=#示例-投票>示例: 投票</a></li><li><a href=#示例-社交关系>示例: 社交关系</a></li><li><a href=#示例-抽奖>示例: 抽奖</a></li><li><a href=#示例-使用反向索引构建商品筛选器>示例: 使用反向索引构建商品筛选器</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>Redis 的集和 set 键允许用户将任意多个不同的元素存储到集和中, 既可以是文本数据, 也可以是二进制数据. 其与列表有以下两个明显的区别:</p><ul><li>列表可以存储重复元素, 而集和只存储非重复元素</li><li>列表以有序方式存储元素, 而集和则以无序方式存储元素</li></ul><p>下面介绍结合键的各个命令</p><h2 id=set-集和>Set 集和<a hidden class=anchor aria-hidden=true href=#set-集和>#</a></h2><ul><li><p>SADD: 将元素添加到集和</p><pre tabindex=0><code>SADD set element [element ...]
</code></pre><p>返回成功添加的新元素数量作为返回值, 由于集和不存储相同元素, 所以会自动忽略重复的元素</p></li><li><p>SREM: 从集和中移出元素</p><pre tabindex=0><code>SREM set element [element ...]
</code></pre><p>返回被移除的元素数量, 同样的, 不存在的元素会被忽略</p></li><li><p>SMOVE: 将元素从一个集和移动到另一个集和</p><pre tabindex=0><code>SMOVE source target element
</code></pre><p>移动操作成功时返回1, 若不存在于源集和, 返回0.<br>如果 source 的元素不存在, 则返回0表示失败.<br>如果 target 的元素已存在, 则会覆盖该元素. 从结果来看, 并不会导致 target 中元素变化, 但是会导致 source 中的该元素消失.</p></li><li><p>SMEMBERS: 获取集和包含的所有元素</p><pre tabindex=0><code>SMEMBERS set
</code></pre><p>由于集和是无序的, 且 SMEMBERS 命令不会进行任何排序操作, 所以根据元素添加的顺序不同, 含相同元素的集和执行该命令结果可能不同.</p></li><li><p>SCARD: 获取集和包含的元素数量</p><pre tabindex=0><code>SCARD set
</code></pre></li><li><p>SISMEMBER: 检查给定元素是否存在于集和</p><pre tabindex=0><code>SISMEMBER set element
</code></pre><p>返回1表示给定的元素存在于集和中, 返回0表示不存在于集和中.</p></li></ul><h3 id=示例-唯一计数器>示例: 唯一计数器<a hidden class=anchor aria-hidden=true href=#示例-唯一计数器>#</a></h3><p>例如, 一个网站想要统计浏览量和用户量</p><ul><li>流览量可以使用是网页被用户访问的次数, 一个用户可以多次访问. 这种类型的数量使用字符串键或者散列键都可以实现</li><li>用户数量是访问网站的 IP 地址数量, 这时候就需要构建一个更加严格的计数器, 对每个 IP 地址进行一次次数, 这种计数器就是唯一计数器(unique counter)</li></ul><pre tabindex=0><code>from redis import Redis

class UniqueCounter:
    def __init__(self, client, key):
        self.client = client
        self.key = key
    def count_in(self, item):
        return self.client.sadd(self.key, item)
    def get_result(self):
        return self.client.scard(self.key)

client = Redis(decode_responses=True)
counter = UniqueCounter(client, &#34;ip counter&#34;)
print(&#34;Add ip&#34;, counter.count_in(&#34;8.8.8.8&#34;))
print(&#34;Add ip&#34;, counter.count_in(&#34;9.9.9.9&#34;))
print(&#34;Add ip&#34;, counter.count_in(&#34;10.10.10.10&#34;))

print(&#34;Numbers of IP:&#34;, counter.get_result())
</code></pre><h3 id=示例-点赞>示例: 点赞<a hidden class=anchor aria-hidden=true href=#示例-点赞>#</a></h3><p>点赞功能可以使用集和来实现, 保证了每个用户对同一个内容只能点1次赞</p><pre tabindex=0><code>from redis import Redis

class Like:
    def __init__(self, client, key):
        self.client = client
        self.key = key

    def cast(self, user):
        &#34;&#34;&#34;执行点赞 True/False&#34;&#34;&#34;
        return self.client.sadd(self.key, user)

    def undo(self, user):
        &#34;&#34;&#34;取消点赞&#34;&#34;&#34;
        self.client.srem(self.key, user)

    def is_liked(self, user):
        &#34;&#34;&#34;是否已点赞&#34;&#34;&#34;
        return self.client.sismember(self.key, user)

    def get_all_liked_users(self):
        &#34;&#34;&#34;所有点赞用户&#34;&#34;&#34;
        return self.client.smembers(self.key)

    def count(self):
        &#34;&#34;&#34;点赞人数&#34;&#34;&#34;
        return self.client.scard(self.key)

client = Redis(decode_responses=True)
like_topic = Like(client, &#34;topic::10086::like&#34;)

print(&#34;Peter like:&#34;, like_topic.cast(&#34;peter&#34;))
print(&#34;Mary like:&#34;, like_topic.cast(&#34;mary&#34;))
print(&#34;Liked Users:&#34;, like_topic.get_all_liked_users())
print(&#34;How many likes:&#34;, like_topic.count())
print(&#34;Peter liked:&#34;, like_topic.is_liked(&#34;peter&#34;))
print(&#34;Dan liked:&#34;, like_topic.is_liked(&#34;dan&#34;))
</code></pre><h3 id=示例-投票>示例: 投票<a hidden class=anchor aria-hidden=true href=#示例-投票>#</a></h3><p>问答网站、文章推荐网、论坛这类注重内容质量的网站上通常会提供投票功能, 用户可以通过投票来支持一项内容或者反对一项内容:</p><ul><li>支持票越多的文章, 会被网站安排到更显眼的位置, 使得网站的用户快速流览高质量内容.</li><li>反对票越多的文章, 则会被放到更不明显的位置, 甚至被当作广告隐藏起来, 使得用户可以忽略这些低质量内容.</li></ul><p>例如 Stackoverflow 上面会对回答的答案进行投票, 帮助用户发现高质量的问题和答案.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>redis</span> <span class=kn>import</span> <span class=n>Redis</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>vote_up_key</span><span class=p>(</span><span class=n>vote_target</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;赞成 vote_target 用户集和 key&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>vote_target</span> <span class=o>+</span> <span class=s2>&#34;::vote_up&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>vote_down_key</span><span class=p>(</span><span class=n>vote_target</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;反对 vote_target 用户集和 key&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>vote_target</span> <span class=o>+</span> <span class=s2>&#34;::vote_down&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Vote</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>,</span> <span class=n>vote_target</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>vote_up_set</span> <span class=o>=</span> <span class=n>vote_up_key</span><span class=p>(</span><span class=n>vote_target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>vote_down_set</span> <span class=o>=</span> <span class=n>vote_down_key</span><span class=p>(</span><span class=n>vote_target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>is_voted</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;检查用户是否已投过票&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>sismember</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>vote_up_set</span><span class=p>,</span> <span class=n>user</span><span class=p>)</span> <span class=ow>or</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>sismember</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>vote_down_set</span><span class=p>,</span> <span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>vote_up</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;user 投赞成票&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_voted</span><span class=p>(</span><span class=n>user</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>sadd</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>vote_up_set</span><span class=p>,</span> <span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>vote_down</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;user 投反对票&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=bp>self</span><span class=o>.</span><span class=n>is_voted</span><span class=p>(</span><span class=n>user</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>False</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>sadd</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>vote_down_set</span><span class=p>,</span> <span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>undo</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;取消用户投票&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>srem</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>vote_up_set</span><span class=p>,</span> <span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>srem</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>vote_down_set</span><span class=p>,</span> <span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>vote_up_count</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;赞成票的数量&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>scard</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>vote_up_set</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_all_vote_up_users</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;所有投赞成票的用户&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>smembers</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>vote_up_set</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>vote_down_count</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;反对票的数量&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>scard</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>vote_down_set</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_all_vote_down_users</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;所有投反对票的用户&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>smembers</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>vote_down_set</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>Redis</span><span class=p>(</span><span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=c1># 是否将字节数据自动解码额日字符串</span>
</span></span><span class=line><span class=cl><span class=n>question_vote</span> <span class=o>=</span> <span class=n>Vote</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=s2>&#34;question::10&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Peter 投支持票:&#34;</span><span class=p>,</span> <span class=n>question_vote</span><span class=o>.</span><span class=n>vote_up</span><span class=p>(</span><span class=s2>&#34;peter&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Jack 投支持票:&#34;</span><span class=p>,</span> <span class=n>question_vote</span><span class=o>.</span><span class=n>vote_up</span><span class=p>(</span><span class=s2>&#34;jack&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Tom 投支持票:&#34;</span><span class=p>,</span> <span class=n>question_vote</span><span class=o>.</span><span class=n>vote_up</span><span class=p>(</span><span class=s2>&#34;tom&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Mary 投反对票:&#34;</span><span class=p>,</span> <span class=n>question_vote</span><span class=o>.</span><span class=n>vote_down</span><span class=p>(</span><span class=s2>&#34;mary&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;支持票数量:&#34;</span><span class=p>,</span> <span class=n>question_vote</span><span class=o>.</span><span class=n>vote_up_count</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;反对票数量:&#34;</span><span class=p>,</span> <span class=n>question_vote</span><span class=o>.</span><span class=n>vote_down_count</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;支持票用户:&#34;</span><span class=p>,</span> <span class=n>question_vote</span><span class=o>.</span><span class=n>get_all_vote_up_users</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;反对票用户:&#34;</span><span class=p>,</span> <span class=n>question_vote</span><span class=o>.</span><span class=n>get_all_vote_down_users</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 取消用户投票(为了多次运行代码)</span>
</span></span><span class=line><span class=cl><span class=n>question_vote</span><span class=o>.</span><span class=n>undo</span><span class=p>(</span><span class=s2>&#34;peter&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>question_vote</span><span class=o>.</span><span class=n>undo</span><span class=p>(</span><span class=s2>&#34;jack&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>question_vote</span><span class=o>.</span><span class=n>undo</span><span class=p>(</span><span class=s2>&#34;tom&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>question_vote</span><span class=o>.</span><span class=n>undo</span><span class=p>(</span><span class=s2>&#34;mary&#34;</span><span class=p>)</span>
</span></span></code></pre></div><h3 id=示例-社交关系>示例: 社交关系<a hidden class=anchor aria-hidden=true href=#示例-社交关系>#</a></h3><p>Twitter 这类社交软件都可以通过关注或者加好友的方式, 构成一种社交关系. 这些网站上的用户都可以关注其他用户, 也可以被其他用户关注. 通过正在关注名单(following list), 用户可以查看自己正在关注的用户及其人数; 通过关注者名单(follower list), 用户可以查看有哪些人正在关注自己.</p><p>下面使用集和来维护这种关系:</p><ul><li>程序为每个用户维护两个集和: 一个集和存储用户的正在关注名单, 另一个集和存储用户的关注者名单.</li><li>当 A 关注 B 的时候, 将 A 加入自己的 following list, 并加入 B 的follower list.</li><li>当 A 取消对 B 的关注的时候, 将 A 从自己的 following list 移出, 并将 A 从 B 的 follower list 移除.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>def</span> <span class=nf>following_key</span><span class=p>(</span><span class=n>user</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>user</span> <span class=o>+</span> <span class=s2>&#34;::following&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>follower_key</span><span class=p>(</span><span class=n>user</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>user</span> <span class=o>+</span> <span class=s2>&#34;::follower&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Relationship</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>,</span> <span class=n>user</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>user</span> <span class=o>=</span> <span class=n>user</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>follow</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>target</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;关注目标用户&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>user_following_set</span> <span class=o>=</span> <span class=n>following_key</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>sadd</span><span class=p>(</span><span class=n>user_following_set</span><span class=p>,</span> <span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>target_follower_set</span> <span class=o>=</span> <span class=n>follower_key</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>sadd</span><span class=p>(</span><span class=n>target_follower_set</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>unfollow</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>target</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;取消关注目标用户&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>user_following_set</span> <span class=o>=</span> <span class=n>following_key</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>srem</span><span class=p>(</span><span class=n>user_following_set</span><span class=p>,</span> <span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>target_follower_set</span> <span class=o>=</span> <span class=n>follower_key</span><span class=p>(</span><span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>srem</span><span class=p>(</span><span class=n>target_follower_set</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>is_following</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>target</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;是否关注了目标用户&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>user_following_set</span> <span class=o>=</span> <span class=n>following_key</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>sismember</span><span class=p>(</span><span class=n>user_following_set</span><span class=p>,</span> <span class=n>target</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_all_following</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;所有user关注的用户&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>user_following_set</span> <span class=o>=</span> <span class=n>following_key</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>smembers</span><span class=p>(</span><span class=n>user_following_set</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_all_follower</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;所有关注user的用户&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>user_follower_set</span> <span class=o>=</span> <span class=n>follower_key</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>smembers</span><span class=p>(</span><span class=n>user_follower_set</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>count_following</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;user关注的用户数量&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>user_following_set</span> <span class=o>=</span> <span class=n>following_key</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>scard</span><span class=p>(</span><span class=n>user_following_set</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>count_follower</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;关注user的用户数量&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>user_follower_set</span> <span class=o>=</span> <span class=n>follower_key</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>scard</span><span class=p>(</span><span class=n>user_follower_set</span><span class=p>)</span>
</span></span></code></pre></div><ul><li><p>SRANDMEMBER: 随机获取集和中的元素</p><pre tabindex=0><code>SRANDMEMBER set [count]
</code></pre><p>该命令接受一个可选的 count 参数, 用于指定用户想要获取的元素数量. 默认只返回一个元素.<br>如果 count 为正数, 将返回 count 个不重复的元素. 当 count 值大于集的元素数量, 将返回集和所有元素.<br>如果 count 为负数, 则随机返回 abs(count) 个元素, 并且允许出现重复值.</p></li><li><p>SPOP: 随机地从集和中移出指定数量的元素</p><pre tabindex=0><code>SPOP key [count]
</code></pre><p>该命令会返回被移除的元素值作为命令的返回值.<br>count 参数不同于 SRANDMEMBER 命令的参数, 其值只能为正数</p></li></ul><h3 id=示例-抽奖>示例: 抽奖<a hidden class=anchor aria-hidden=true href=#示例-抽奖>#</a></h3><p>为了推销产品并回馈消费者, 商家经常举办一些抽奖活动, 消费者可以抽奖获取礼品. 下面代码展示了使用集和实现的抽象程序, 这个成会把所有参与抽奖的玩家都添加到一个集和中, 然后通过 SRANDMEMBER 命令随机地选出获奖者.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Lottery</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key</span> <span class=o>=</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>add_player</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>user</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;添加用户到抽奖名单中&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>sadd</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>,</span> <span class=n>user</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_all_players</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;返回参加抽奖活动的所有用户&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>smembers</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>player_count</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;返回抽奖用户数量&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>scard</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>draw</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>number</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;抽取指定数量的获奖者&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>srandmember</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>,</span> <span class=n>number</span><span class=p>)</span>
</span></span></code></pre></div><p>考虑到完整的抽奖者名单可能会有用, 所以这个抽奖程序使用了随机获取元素的 SRANDMEMBER 命令, 而不是随机移除元素的 SPOP 命令. 如果不需要保留完整的名单, 也可以使用 SPOP 命令实现抽奖程序.</p><ul><li><p>SINTER、SINTERSTORE: 对集和执行交集计算</p><pre tabindex=0><code>SINTER set [set ...]
</code></pre><p>该命令计算用户给定的所有集和的交集, 返回交集的所有元素.<br>此外, 还有 SINTERSTORE 命令, 将集和的交集计算结果存储到指定的键里面.</p><pre tabindex=0><code>SINTERSTORE destination_key set [set ...]
</code></pre><p>如果给定的键已存在, 则 SINTERSTORE 命令结果会覆盖原来的集和键</p></li><li><p>SUNION、SUNIONSTORE: 对集和执行并集计算</p><pre tabindex=0><code>SUNION set [set ...]
</code></pre><p>并集计算类似上面的交集计算</p></li><li><p>SDIFF、SDIFFSTORE: 对集和执行差集计算</p><pre tabindex=0><code>SDIFF set [set ...]
</code></pre><p>SDIFF 命令会安装用户给定集和的顺序, 从左到右依次对给定的集和执行差集计算.</p></li></ul><blockquote><p>因为对集合执行交集、并集、差集等集合计算需要耗费大量的资源, 所以用户应该尽量使用SINTERSTORE等命令来存储并重用计算结果, 而不要每次都重复进行计算.
此外, 当集合计算涉及的元素数量非常大时, Redis服务器在进行计算时可能会被阻塞.
这时, 可以考虑使用Redis的复制功能, 通过从服务器来执行集合计算任务, 从而确保主服务器可以继续处理其他客户端发送的命令请求.</p></blockquote><ul><li>共同关注与推荐关注<br>前面使用集和实现了社交网站好友关系的存储, 即关注和被关注列表. 除此之外, 社交网站还通常会提供一些额外功能, 例如共同关注, 推荐关注等.<br>要实现共同关注功能, 程序需要计算出两个用户正在关注集和之间的交集.<br>推荐关注可以从用户关注集和中, 随机选出指定数量的用户作为种子用户, 然后对这些用户的正在管组集和执行并集计算, 最后从这个并集中随机选出一些推荐关注的对象.</li></ul><h3 id=示例-使用反向索引构建商品筛选器>示例: 使用反向索引构建商品筛选器<a hidden class=anchor aria-hidden=true href=#示例-使用反向索引构建商品筛选器>#</a></h3><p>在访问购物类网站的时候, 通常可以通过一些标签来筛选产品. 这时候, 对每个产品可以建立一个集和, 对每个标签也都建立一个集和, 这样就得到了一份物品到关键字, 以及关键字到物品的映射关系.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>def</span> <span class=nf>make_item_key</span><span class=p>(</span><span class=n>item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;InvertedIndex::&#34;</span> <span class=o>+</span> <span class=n>item</span> <span class=o>+</span> <span class=s2>&#34;::keyword&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>make_keyword_key</span><span class=p>(</span><span class=n>keyword</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=s2>&#34;InvertedIndex::&#34;</span> <span class=o>+</span> <span class=n>keyword</span> <span class=o>+</span> <span class=s2>&#34;::item&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>InvertedIndex</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>add_index</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=o>*</span><span class=n>keywords</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;为物品添加关键字&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 将给定物品添加到</span>
</span></span><span class=line><span class=cl>        <span class=n>item_key</span> <span class=o>=</span> <span class=n>make_item_key</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>sadd</span><span class=p>(</span><span class=n>item_key</span><span class=p>,</span> <span class=o>*</span><span class=n>keywords</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 遍历关键字集和, 将该物品添加进去</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>keyword</span> <span class=ow>in</span> <span class=n>keywords</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>keyword_key</span> <span class=o>=</span> <span class=n>make_keyword_key</span><span class=p>(</span><span class=n>keyword</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>sadd</span><span class=p>(</span><span class=n>keyword_key</span><span class=p>,</span> <span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 返回添加关键字数量作为结果</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>remove_index</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>,</span> <span class=o>*</span><span class=n>keywords</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;移除物品的关键字&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>item_key</span> <span class=o>=</span> <span class=n>make_item_key</span><span class=p>(</span><span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>srem</span><span class=p>(</span><span class=n>item_key</span><span class=p>,</span> <span class=o>*</span><span class=n>keywords</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>keyword</span> <span class=ow>in</span> <span class=n>keywords</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>keyword_key</span> <span class=o>=</span> <span class=n>make_keyword_key</span><span class=p>(</span><span class=n>keyword</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>srem</span><span class=p>(</span><span class=n>keyword_key</span><span class=p>,</span> <span class=n>item</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_keywords</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>item</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;获取物品所有的关键字&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>smembers</span><span class=p>(</span><span class=n>make_item_key</span><span class=p>(</span><span class=n>item</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_items</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=o>*</span><span class=n>keywords</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;根据给定的关键字获取物品&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># 根据给定的关键字计算出与之对应的集合 key</span>
</span></span><span class=line><span class=cl>        <span class=n>keyword_key_list</span> <span class=o>=</span> <span class=nb>map</span><span class=p>(</span><span class=n>make_keyword_key</span><span class=p>,</span> <span class=n>keywords</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=c1># 将这些集和 key 做并集</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>sinter</span><span class=p>(</span><span class=o>*</span><span class=n>keyword_key_list</span><span class=p>)</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://starslayerx.github.io/tags/redis/>Redis</a></li></ul><nav class=paginav><a class=prev href=https://starslayerx.github.io/posts/from-python-to-go/><span class=title>« Prev</span><br><span>From Python to Go</span>
</a><a class=next href=https://starslayerx.github.io/posts/documenting-rest-apis-with-openapi/><span class=title>Next »</span><br><span>Documenting REST APIs with OpenAPI</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis Set on x" href="https://x.com/intent/tweet/?text=Redis%20Set&amp;url=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-set%2f&amp;hashtags=Redis"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis Set on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-set%2f&amp;title=Redis%20Set&amp;summary=Redis%20Set&amp;source=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-set%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis Set on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-set%2f&title=Redis%20Set"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis Set on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-set%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis Set on whatsapp" href="https://api.whatsapp.com/send?text=Redis%20Set%20-%20https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-set%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis Set on telegram" href="https://telegram.me/share/url?text=Redis%20Set&amp;url=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-set%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis Set on ycombinator" href="https://news.ycombinator.com/submitlink?t=Redis%20Set&u=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-set%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://starslayerx.github.io/>Starslayerx' Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>