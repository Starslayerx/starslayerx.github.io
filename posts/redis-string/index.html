<!doctype html><html lang=en dir=auto data-theme=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Redis String | Starslayerx' Blog</title><meta name=keywords content="Redis"><meta name=description content='介绍Redis中的字符串键
字符串
字符串建是 Redis 最基本的键值对类型, 这种类型的键值对会在数据库中把单独的一个值关联起来, 被关联的键和值可以为文本, 也可以是图片, 视屏, 音频等二进制数据.


SET: 为字符串键设置值 O(1)

SET key value

```Redis
SET number "10086"
> OK

SET book "Redis in action"
> OK
```

对于已经存在的 key, 再次赋值会覆盖原值, 若不想覆盖后面添加参数 NX, 相反, 默认 XX 允许覆盖
```Redis
SET key "10086" NX
> (nil)

SET key "10086" XX
> OK
```



GET: 获取字符串键的值 O(1)

GET key

```Redis
GET number
> "10086"
```

对于不存在的值, 返回空
```Redis
GET key_new
> (nil)
```



GETSET: 获取旧值并更新值 O(1)'><meta name=author content="Starslayerx"><link rel=canonical href=https://starslayerx.github.io/posts/redis-string/><link crossorigin=anonymous href=/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css integrity="sha256-2jIR5e+Ge/K3X9WmUVz+1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as=style><link rel=icon href=https://starslayerx.github.io/favicon.svg><link rel=icon type=image/png sizes=16x16 href=https://starslayerx.github.io/favicon.svg><link rel=icon type=image/png sizes=32x32 href=https://starslayerx.github.io/favicon.svg><link rel=apple-touch-icon href=https://starslayerx.github.io/favicon.svg><link rel=mask-icon href=https://starslayerx.github.io/favicon.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://starslayerx.github.io/posts/redis-string/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51);color-scheme:dark}.list{background:var(--theme)}.toc{background:var(--entry)}}@media(prefers-color-scheme:light){.list::-webkit-scrollbar-thumb{border-color:var(--code-bg)}}</style></noscript><script>localStorage.getItem("pref-theme")==="dark"?document.querySelector("html").dataset.theme="dark":localStorage.getItem("pref-theme")==="light"?document.querySelector("html").dataset.theme="light":window.matchMedia("(prefers-color-scheme: dark)").matches?document.querySelector("html").dataset.theme="dark":document.querySelector("html").dataset.theme="light"</script><meta property="og:url" content="https://starslayerx.github.io/posts/redis-string/"><meta property="og:site_name" content="Starslayerx' Blog"><meta property="og:title" content="Redis String"><meta property="og:description" content='介绍Redis中的字符串键
字符串 字符串建是 Redis 最基本的键值对类型, 这种类型的键值对会在数据库中把单独的一个值关联起来, 被关联的键和值可以为文本, 也可以是图片, 视屏, 音频等二进制数据.
SET: 为字符串键设置值 O(1)
SET key value
```Redis SET number "10086" > OK SET book "Redis in action" > OK ``` 对于已经存在的 key, 再次赋值会覆盖原值, 若不想覆盖后面添加参数 NX, 相反, 默认 XX 允许覆盖 ```Redis SET key "10086" NX > (nil) SET key "10086" XX > OK ``` GET: 获取字符串键的值 O(1)
GET key
```Redis GET number > "10086" ``` 对于不存在的值, 返回空 ```Redis GET key_new > (nil) ``` GETSET: 获取旧值并更新值 O(1)'><meta property="og:locale" content="en-US"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2025-08-19T08:00:00+08:00"><meta property="article:modified_time" content="2025-08-19T08:00:00+08:00"><meta property="article:tag" content="Redis"><meta property="og:image" content="https://starslayerx.github.io/images/og-default.avif"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://starslayerx.github.io/images/og-default.avif"><meta name=twitter:title content="Redis String"><meta name=twitter:description content='介绍Redis中的字符串键
字符串
字符串建是 Redis 最基本的键值对类型, 这种类型的键值对会在数据库中把单独的一个值关联起来, 被关联的键和值可以为文本, 也可以是图片, 视屏, 音频等二进制数据.


SET: 为字符串键设置值 O(1)

SET key value

```Redis
SET number "10086"
> OK

SET book "Redis in action"
> OK
```

对于已经存在的 key, 再次赋值会覆盖原值, 若不想覆盖后面添加参数 NX, 相反, 默认 XX 允许覆盖
```Redis
SET key "10086" NX
> (nil)

SET key "10086" XX
> OK
```



GET: 获取字符串键的值 O(1)

GET key

```Redis
GET number
> "10086"
```

对于不存在的值, 返回空
```Redis
GET key_new
> (nil)
```



GETSET: 获取旧值并更新值 O(1)'><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://starslayerx.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Redis String","item":"https://starslayerx.github.io/posts/redis-string/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Redis String","name":"Redis String","description":"介绍Redis中的字符串键\n字符串 字符串建是 Redis 最基本的键值对类型, 这种类型的键值对会在数据库中把单独的一个值关联起来, 被关联的键和值可以为文本, 也可以是图片, 视屏, 音频等二进制数据.\nSET: 为字符串键设置值 O(1)\nSET key value\n```Redis SET number \u0026quot;10086\u0026quot; \u0026gt; OK SET book \u0026quot;Redis in action\u0026quot; \u0026gt; OK ``` 对于已经存在的 key, 再次赋值会覆盖原值, 若不想覆盖后面添加参数 NX, 相反, 默认 XX 允许覆盖 ```Redis SET key \u0026quot;10086\u0026quot; NX \u0026gt; (nil) SET key \u0026quot;10086\u0026quot; XX \u0026gt; OK ``` GET: 获取字符串键的值 O(1)\nGET key\n```Redis GET number \u0026gt; \u0026quot;10086\u0026quot; ``` 对于不存在的值, 返回空 ```Redis GET key_new \u0026gt; (nil) ``` GETSET: 获取旧值并更新值 O(1)\n","keywords":["Redis"],"articleBody":"介绍Redis中的字符串键\n字符串 字符串建是 Redis 最基本的键值对类型, 这种类型的键值对会在数据库中把单独的一个值关联起来, 被关联的键和值可以为文本, 也可以是图片, 视屏, 音频等二进制数据.\nSET: 为字符串键设置值 O(1)\nSET key value\n```Redis SET number \"10086\" \u003e OK SET book \"Redis in action\" \u003e OK ``` 对于已经存在的 key, 再次赋值会覆盖原值, 若不想覆盖后面添加参数 NX, 相反, 默认 XX 允许覆盖 ```Redis SET key \"10086\" NX \u003e (nil) SET key \"10086\" XX \u003e OK ``` GET: 获取字符串键的值 O(1)\nGET key\n```Redis GET number \u003e \"10086\" ``` 对于不存在的值, 返回空 ```Redis GET key_new \u003e (nil) ``` GETSET: 获取旧值并更新值 O(1)\nGETSET key new_value\n```Redis GETSET key \"123456\" \u003e \"10086\" ``` 示例: 缓存 对数据进行缓存是Redis最常见的用法之一, 将数据存储在内存比存储在硬盘要快得多 首先定义缓存\nclass Cache: def __init__(self, client): self.client = client def set(self, key, value): self.client.set(key, value) def get(self, key): return self.client.get(key) def update(self, new_value, key): return self.client.getset(key, new_value) # 设置新值, 返回旧值 然后缓存文本数据\nclient = Redis(decode_responses=True) # 使用文本编码方式打开客户端 cache = Cache(client) cache.set(\"web_page\", \"hello world\n\") print(cache.get(\"web_page\")) print(cache.update(\"web_page\", \"update\")) print(cache.get(\"web_page\")) 下面是存储一个二进制图片的缓存示例\nclient = Redis() # 二进制编码打开客户端 cache = Cache(client) image = open(\"DailyBing.jpg\", \"rb\") # 二进制只读方式打开图片 data = image.read() # 读取文件内容 image.close() # 关闭文件 cache.set(\"daily_bing.jpg\", data) # 将二进制图片缓存到键 daily_bing.jpg 中 print(cache.get(\"daily_bing.jpg\")[:20]) # 读取二进制数据的前20字节 b’\\xff\\xd8\\xff\\xe0\\x00\\x10JFIF\\x00\\x01\\x01\\x01\\x00\\x00\\x00\\x00\\x00\\x00'\n示例: 锁 锁是一种同步机制, 用于保证一种资源任何时候只能被一个进程使用. 一个锁的实现通常有获取 (acquire) 和释放 (relase) 这两种操作.\n获取操作用于获取资源的独占使用权, 任何时候只能有一个进程取得锁, 此时, 取得锁的进程称为锁的持有者. 释放操作用于放弃资源的独占使用权, 一般由持有者调用. from redis import Redis VALUE_OF_LOCK = \"locking\" class Lock: def __init__(self, client, key): self.client = client self.key = key def acquire(self): result = self.client.set(self.key, VALUE_OF_LOCK, nx=True) return result is True def relase(self): return self.client.delete(self.key) == 1 client = Redis(decode_responses=True) lock = Lock(client, 'test-lock') print(\"第一次获取锁:\", lock.acquire()) print(\"第二次获得锁:\", lock.acquire()) print(\"取消锁:\", lock.relase()) print(\"第三次获得锁:\", lock.acquire()) 第一次获取锁: True 第二次获得锁: False 取消锁: True 第三次获得锁: True\n若要设置锁的时间 SET key value NX EX time 这样是原子性语法, 删除操作对应命令是 DEL key, 返回0表示 key 不存在, 返回1~N表示删除key的数量.\nNX 确保锁只有在没有值时加锁成功, 若有值则返回 None, 通过检查 result 是否为 True 来判断是否获得了锁.\nMSET: 一次为多个字符串键设置值 O(N) MSET key value [key value …]\n同 SET 命令, MSET 执行成功后返回 OK, 并且会用新值覆盖旧值. 由于执行多条 SET 命令要客户端和服务端之间多次进行网络通讯, 因此 MSET 能减少程序执行操作的时间\nMGET: 一次获取多个字符串键的值 O(N)\nMGET key [key …]\nMSETNX: 只在键不存在的情况下, 一次为多个键设置值\nMSETNX key value [key value …]\n若有任意一次键存在值, 则会取消所有操作, 并返回0. 只有所有键都没有值的时候, 执行才成功, 返回1.\n示例: 存储文章信息 在构建应用程序的时候, 经常会需要批量设计和获取多项信息, 以博客为例:\n当用户注册博客时, 程序将用户名字、帐号、密码、注册时间等存储起来, 并在登陆时查取这些信息. 当编写一篇博客文章时, 就要将博客标题、内容、作者、发表时间存储起来, 并在用户阅读的时候取出这些信息. 通过 MSET、MSETNX、MGET 命令, 可以实现上面提到的这些批量设置和批量获取操作\nfrom redis import Redis from datetime import datetime class Article: def __init__(self, client, article_id): \"\"\"根据id创建文章id\"\"\" self.client = client self.id = str(article_id) self.title_key = \"article::\" + self.id + \"::title\" self.content_key = \"article::\" + self.id + \"::content\" self.author_key = \"article::\" + self.id + \"author\" self.create_at_key = \"article::\" + self.id + datetime.now() def create(self, title, content, author): \"\"\"创建文章\"\"\" article_data = { self.title_key: title, self.content_key: content, self.author_key: author, self.create_at_key: datetime.now(), } return self.client.msetnx(article_data) def get(self): \"\"\"获取文章信息\"\"\" result = self.client.mget( self.title_key, self.content_key, self.author_key, self.create_at_key, ) return { \"id\": self.id, \"title\": result[0], \"content\": result[1], \"author\": result[2], \"create_at_key\": result[3], } def update(self, title=None, content=None, author=None): \"\"\"更新文章\"\"\" article_data = {} if title is not None: article_data[self.title_key] = title if content is not None: article_data[self.content_key] = content if author is not None: article_data[self.author_key] = author return self.client.mset(article_data) client = Redis(decode_responses=True) article = Article(client, 10086) # 创建文章 print(article.create(\"message\", \"hello world\", \"sx\")) # 获取文章信息 print(article.get()) # 更新文章作者 print(article.update(author=\"join\")) 上面程序使用了多个字符串键存储文章信息: article::::\nSTRLEN: 获取字符串的字节长度 O(1) STRLEN key\n对于存在的键, 返回字节长度信息. 对于不存在的键, 返回0\nGETRANGE: 获取字符串值指定索引范围上的内容 O(N) GETRANGE key start end\nSET message \"hello world\" GETRANG message 0 4 \u003e hello GETRANGE message -5 -1 \u003e world SETRANGE: 修改字符串索引范围的值 O(N) SETRANGE key index subsitute\nset message \"hello world\" SETRANGE message 6 Redis \u003e (integer) 11 GET message \u003e hello Redis 当用户给定的新内容比被替换内容长的时候, SETRANGE 会自动扩展被修改的字符串值\nSETRANGE message 5 \", this is a message\" \u003e (integer) 24 GET message \u003e \"hello, this is a message\" 当用户给出的索引长度超出被替换字符长度时, 字符串末尾到 index-1 之间部分将使用空字符串填充为0\nSET greeting \"hello\" SETRANGE greeting 10 \"hello\" \u003e (integer) 15 GET greeting \u003e \"hello\\x00\\x00\\x00\\x00\\x00world\" 示例: 给文章存储程序加上文章长度计数功能和文章御览功能给 文章长度计数功能: 显示文章长度, 用于估计阅读时长 文章预览功能: 显示文章开头一部分内容, 帮助读者快速了解文章 class Article: ... def get_content_len(self): return self.client.strlen(self.content_key) def get_content_perview(self, preview_len): start_index = 0 end_index = preview_len - 1 return self.client.getrange(self.content, start_index, end_index) APPEND: 追加新内容到值的末尾 APPEND key suffix\n若用户给定的 key 不存在, 则相当于 SET key suffix\n示例: 存储日志 很多程序运行的时候会产生日志, 日志记录了程序的运行状态以及执行过的重要操作. 若每条日志存储一个键值对, 则会消耗很多资源, 且分散在数据库中, 需要额外的时间查找日志, 这里将不同日志拼接在同一个值里面.\nfrom redis import Redis LOG_SEPERATOR = \"\\n\" class Log: def __init__(self, client, key): self.client = client self.key = key def add(self, new_log): new_log += LOG_SEPERATOR self.client.append(self.key, new_log) def get_all(self): all_logs = self.client.get(self.key) if all_logs is not None: log_list = all_logs.split(LOG_SEPERATOR) log_list.remove(\"\") # 删除默认多余的空字符串 return log_list else: return [] 数字值 下面介绍使用字符串键存储数字值:\n每当存储一个值到字符串键里面的时候, 有下面两种情况\nC 语言 long long int 类型的整数, 取值范围为 -2^63 ~ 2^63-1 (超出范围会被当成字符串) C 语言 long double 类型的浮点数 为了方便地处理字符串键的值, Redis 提供了一系列加法和减法操作命令, 下面介绍这些命令\nINCRBY, DECRBY: 对整数执行加法和减法操作 O(1)\nINCRBY key increment DECRBY key increment\n如果类型为浮点数, 使用上面方法会报错 (key的值 和 increment 都必须为整数) 当该命令遇到**不存在的键**时, 会将键的值初始化为0, 然后再执行操作 INCR, DECR: 对整数执行加1和减1操作 O(1)\nINCR key DECR key\nINCRBYFLOAT: 对数字值执行浮点数加减法操作\nINCRBYFLOAT key increment\nINCRBYFLOAT 命令即执行加法操作, 也可以执行加法操作, 并且操作对象和 increment 都既可以为整数也可以为浮点数 虽然 Redis 没有限制字符串键存储浮点数的小数位数, 但是 INCRBYFLOAT 最多只会保留小数点后的17位数字, 超出部分将被截断 示例: ID 生成器 identifier 标识符, 经常在程序中使用, 通常以数字形式出现, 并通过递增的方法创建新的ID.\nfrom redis import Redis class IdGenerator: def __init__(self, client, key): self.client = client self.key = key def produce(self): \"\"\"生成下一个id\"\"\" return self.client.incr(self.key) def reserve(self, n): \"\"\"初始化\"\"\" result = self.client.set(self.key, n, nx=1) # key 不存在才行 return result is True client = Redis(decode_responses=True) id_generator = IdGenerator(client, \"user::id\") print(id_generator.reserve(1000000)) # 保留100万个ID -\u003e True print(id_generator.produce()) # 生成ID, 均大于100万 print(id_generator.reserve(1000)) # 已存在 -\u003e False 示例: 计数器 除了ID生成器, 计数器也是常用的组件之一, 例如点赞回复数量, 播放量等.\nfrom redis import Redis class Counter: def __init__(self, client, key): self.client = client self.key = key def increase(self, n=1): return self.client.incr(self.key, n) def decrease(self, n=1): return self.client.decr(self.key, n) def get(self): value = self.client.get(self.key) if value in None: return 0 else: return int(value) def reset(self): old_value = self.client.getset(self.key) if old_value is None: return 0 else: return(old_value) client = Redis(decode_responses=True) counter = Counter(client, \"counter::page_viewed\") print(counter.increase()) # +1 print(counter.increase()) print(counter.increase(10)) # +10 print(counter.decrease()) # -1 print(counter.decrease(5)) # -5 print(counter.reset()) # 重置计数器 print(counter.get()) # 返回计数器当前值 注: 在 redis-py 中 INCR 和 INCRBY 都使用 .incr() 方法\n示例: 限速器 为了保障系统的安全性和性能, 并保证重要资源不被滥用, 应用程序需要对用户的行为进行限制\n防止网络爬虫: 限制每个IP地址在固定时间段内访问的页面数量 防止爆力破解: 当用户多次输入错误的密码, 会帐号进行冻结 上面机制的实现可以使用限速器, 下面是一个限速器示例代码, 该程序将操作最大可执行次数存储在一个字符串里面, 每次用户进行该操作后就将其减1\nfrom redis import Redis class Limter: def __init__(self, client, key): self.client = client self.key = key def set_max_execute_times(self, max_execut_time): self.client.set(self.key, max_execut_time) def still_valid_to_execute(self): num = self.client.decr(self.key) return (num \u003e= 0) def remaining_execute_times(self): num = int(self.client.get(self.key)) if num \u003c 0: return 0 else: return num client = Redis(decode_responses=True) limter = Limter(client, \"wrong_password_limter\") print(limter.set_max_execute_times(5)) # 最多5次输入错误密码 print(limter.still_valid_to_execute()) # 前5次 True, 之后 False ","wordCount":"974","inLanguage":"en","image":"https://starslayerx.github.io/images/og-default.avif","datePublished":"2025-08-19T08:00:00+08:00","dateModified":"2025-08-19T08:00:00+08:00","author":{"@type":"Person","name":"Starslayerx"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://starslayerx.github.io/posts/redis-string/"},"publisher":{"@type":"Organization","name":"Starslayerx' Blog","logo":{"@type":"ImageObject","url":"https://starslayerx.github.io/favicon.svg"}}}</script></head><body id=top><header class=header><nav class=nav><div class=logo><a href=https://starslayerx.github.io/ accesskey=h title="Starslayerx' Blog (Alt + H)"><img src=https://starslayerx.github.io/favicon.svg alt aria-label=logo height=35>Starslayerx' Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button><ul class=lang-switch><li>|</li><li><a href=https://starslayerx.github.io/zh-cn/ title=简体中文 aria-label=简体中文>Zh-Cn</a></li></ul></div></div><ul id=menu><li><a href=https://starslayerx.github.io/posts/ title=Posts><span>Posts</span></a></li><li><a href=https://starslayerx.github.io/archives/ title=Archives><span>Archives</span></a></li><li><a href=https://starslayerx.github.io/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://starslayerx.github.io/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://starslayerx.github.io/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://starslayerx.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://starslayerx.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Redis String</h1><div class=post-meta><span title='2025-08-19 08:00:00 +0800 +0800'>August 19, 2025</span>&nbsp;·&nbsp;<span>5 min</span>&nbsp;·&nbsp;<span>974 words</span>&nbsp;·&nbsp;<span>Starslayerx</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#字符串>字符串</a><ul><li><a href=#示例-缓存>示例: 缓存</a></li><li><a href=#示例-锁>示例: 锁</a></li><li><a href=#示例-存储文章信息>示例: 存储文章信息</a></li><li><a href=#示例-给文章存储程序加上文章长度计数功能和文章御览功能给>示例: 给文章存储程序加上文章长度计数功能和文章御览功能给</a></li><li><a href=#示例-存储日志>示例: 存储日志</a></li></ul></li><li><a href=#数字值>数字值</a><ul><li><a href=#示例-id-生成器>示例: ID 生成器</a></li><li><a href=#示例-计数器>示例: 计数器</a></li><li><a href=#示例-限速器>示例: 限速器</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p>介绍Redis中的字符串键</p><h2 id=字符串>字符串<a hidden class=anchor aria-hidden=true href=#字符串>#</a></h2><p>字符串建是 Redis 最基本的键值对类型, 这种类型的键值对会在数据库中把单独的一个值关联起来, 被关联的键和值可以为文本, 也可以是图片, 视屏, 音频等二进制数据.</p><ul><li><p>SET: 为字符串键设置值 O(1)</p><blockquote><p>SET key value</p></blockquote><pre><code>```Redis
SET number &quot;10086&quot;
&gt; OK

SET book &quot;Redis in action&quot;
&gt; OK
```

对于已经存在的 key, 再次赋值会覆盖原值, 若不想覆盖后面添加参数 NX, 相反, 默认 XX 允许覆盖
```Redis
SET key &quot;10086&quot; NX
&gt; (nil)

SET key &quot;10086&quot; XX
&gt; OK
```
</code></pre></li><li><p>GET: 获取字符串键的值 O(1)</p><blockquote><p>GET key</p></blockquote><pre><code>```Redis
GET number
&gt; &quot;10086&quot;
```

对于不存在的值, 返回空
```Redis
GET key_new
&gt; (nil)
```
</code></pre></li><li><p>GETSET: 获取旧值并更新值 O(1)</p><blockquote><p>GETSET key new_value</p></blockquote><pre><code>```Redis
GETSET key &quot;123456&quot;
&gt; &quot;10086&quot;
```
</code></pre></li></ul><h3 id=示例-缓存>示例: 缓存<a hidden class=anchor aria-hidden=true href=#示例-缓存>#</a></h3><p>对数据进行缓存是Redis最常见的用法之一, 将数据存储在内存比存储在硬盘要快得多
首先定义缓存</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Cache</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>set</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>new_value</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>getset</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>new_value</span><span class=p>)</span> <span class=c1># 设置新值, 返回旧值</span>
</span></span></code></pre></div><p>然后缓存文本数据</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>Redis</span><span class=p>(</span><span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span> <span class=c1># 使用文本编码方式打开客户端</span>
</span></span><span class=line><span class=cl><span class=n>cache</span> <span class=o>=</span> <span class=n>Cache</span><span class=p>(</span><span class=n>client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cache</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=s2>&#34;web_page&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;html&gt;&lt;p&gt;hello world&lt;/p&gt;&lt;/html&gt;&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>cache</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;web_page&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>cache</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=s2>&#34;web_page&#34;</span><span class=p>,</span> <span class=s2>&#34;&lt;html&gt;&lt;p&gt;update&lt;p&gt;&lt;/html&gt;&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>cache</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;web_page&#34;</span><span class=p>))</span>
</span></span></code></pre></div><p>下面是存储一个二进制图片的缓存示例</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>Redis</span><span class=p>()</span> <span class=c1># 二进制编码打开客户端</span>
</span></span><span class=line><span class=cl><span class=n>cache</span> <span class=o>=</span> <span class=n>Cache</span><span class=p>(</span><span class=n>client</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>image</span> <span class=o>=</span> <span class=nb>open</span><span class=p>(</span><span class=s2>&#34;DailyBing.jpg&#34;</span><span class=p>,</span> <span class=s2>&#34;rb&#34;</span><span class=p>)</span> <span class=c1># 二进制只读方式打开图片</span>
</span></span><span class=line><span class=cl><span class=n>data</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>read</span><span class=p>()</span> <span class=c1># 读取文件内容</span>
</span></span><span class=line><span class=cl><span class=n>image</span><span class=o>.</span><span class=n>close</span><span class=p>()</span> <span class=c1># 关闭文件</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>cache</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=s2>&#34;daily_bing.jpg&#34;</span><span class=p>,</span> <span class=n>data</span><span class=p>)</span> <span class=c1># 将二进制图片缓存到键 daily_bing.jpg 中</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>cache</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s2>&#34;daily_bing.jpg&#34;</span><span class=p>)[:</span><span class=mi>20</span><span class=p>])</span> <span class=c1># 读取二进制数据的前20字节</span>
</span></span></code></pre></div><blockquote><p>b&rsquo;\xff\xd8\xff\xe0\x00\x10JFIF\x00\x01\x01\x01\x00\x00\x00\x00\x00\x00'</p></blockquote><h3 id=示例-锁>示例: 锁<a hidden class=anchor aria-hidden=true href=#示例-锁>#</a></h3><p>锁是一种同步机制, 用于保证一种资源任何时候只能被一个进程使用.
一个锁的实现通常有获取 (acquire) 和释放 (relase) 这两种操作.</p><ul><li>获取操作用于获取资源的独占使用权, 任何时候只能有一个进程取得锁, 此时, 取得锁的进程称为锁的持有者.</li><li>释放操作用于放弃资源的独占使用权, 一般由持有者调用.</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>redis</span> <span class=kn>import</span> <span class=n>Redis</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>VALUE_OF_LOCK</span> <span class=o>=</span> <span class=s2>&#34;locking&#34;</span>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Lock</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key</span> <span class=o>=</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>acquire</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>,</span> <span class=n>VALUE_OF_LOCK</span><span class=p>,</span> <span class=n>nx</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span> <span class=ow>is</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>relase</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>delete</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>)</span> <span class=o>==</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>Redis</span><span class=p>(</span><span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>lock</span> <span class=o>=</span> <span class=n>Lock</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=s1>&#39;test-lock&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;第一次获取锁:&#34;</span><span class=p>,</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;第二次获得锁:&#34;</span><span class=p>,</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;取消锁:&#34;</span><span class=p>,</span> <span class=n>lock</span><span class=o>.</span><span class=n>relase</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;第三次获得锁:&#34;</span><span class=p>,</span> <span class=n>lock</span><span class=o>.</span><span class=n>acquire</span><span class=p>())</span>
</span></span></code></pre></div><blockquote><p>第一次获取锁: True
第二次获得锁: False
取消锁: True
第三次获得锁: True</p></blockquote><p>若要设置锁的时间 <code>SET key value NX EX time</code> 这样是原子性语法, 删除操作对应命令是 <code>DEL key</code>, 返回0表示 key 不存在, 返回1~N表示删除key的数量.</p><p>NX 确保锁只有在没有值时加锁成功, 若有值则返回 None, 通过检查 result 是否为 True 来判断是否获得了锁.</p><ul><li>MSET: 一次为多个字符串键设置值 O(N)<blockquote><p>MSET key value [key value &mldr;]</p></blockquote></li></ul><p>同 SET 命令, MSET 执行成功后返回 OK, 并且会用新值覆盖旧值. 由于执行多条 SET 命令要客户端和服务端之间多次进行网络通讯, 因此 MSET 能减少程序执行操作的时间</p><ul><li><p>MGET: 一次获取多个字符串键的值 O(N)</p><blockquote><p>MGET key [key &mldr;]</p></blockquote></li><li><p>MSETNX: 只在键不存在的情况下, 一次为多个键设置值</p><blockquote><p>MSETNX key value [key value &mldr;]</p></blockquote></li></ul><p>若有任意一次键存在值, 则会取消所有操作, 并返回0. 只有所有键都没有值的时候, 执行才成功, 返回1.</p><h3 id=示例-存储文章信息>示例: 存储文章信息<a hidden class=anchor aria-hidden=true href=#示例-存储文章信息>#</a></h3><p>在构建应用程序的时候, 经常会需要批量设计和获取多项信息, 以博客为例:</p><ul><li>当用户注册博客时, 程序将用户名字、帐号、密码、注册时间等存储起来, 并在登陆时查取这些信息.</li><li>当编写一篇博客文章时, 就要将博客标题、内容、作者、发表时间存储起来, 并在用户阅读的时候取出这些信息.</li></ul><p>通过 MSET、MSETNX、MGET 命令, 可以实现上面提到的这些批量设置和批量获取操作</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>redis</span> <span class=kn>import</span> <span class=n>Redis</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>datetime</span> <span class=kn>import</span> <span class=n>datetime</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Article</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>,</span> <span class=n>article_id</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;根据id创建文章id&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>id</span> <span class=o>=</span> <span class=nb>str</span><span class=p>(</span><span class=n>article_id</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>title_key</span> <span class=o>=</span> <span class=s2>&#34;article::&#34;</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>id</span> <span class=o>+</span> <span class=s2>&#34;::title&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>content_key</span> <span class=o>=</span> <span class=s2>&#34;article::&#34;</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>id</span> <span class=o>+</span> <span class=s2>&#34;::content&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>author_key</span> <span class=o>=</span> <span class=s2>&#34;article::&#34;</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>id</span> <span class=o>+</span> <span class=s2>&#34;author&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>create_at_key</span> <span class=o>=</span> <span class=s2>&#34;article::&#34;</span> <span class=o>+</span> <span class=bp>self</span><span class=o>.</span><span class=n>id</span> <span class=o>+</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>title</span><span class=p>,</span> <span class=n>content</span><span class=p>,</span> <span class=n>author</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;创建文章&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>article_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>title_key</span><span class=p>:</span> <span class=n>title</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>content_key</span><span class=p>:</span> <span class=n>content</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>author_key</span><span class=p>:</span> <span class=n>author</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>create_at_key</span><span class=p>:</span> <span class=n>datetime</span><span class=o>.</span><span class=n>now</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>msetnx</span><span class=p>(</span><span class=n>article_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;获取文章信息&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>mget</span><span class=p>(</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>title_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>content_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>author_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>create_at_key</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;id&#34;</span><span class=p>:</span> <span class=bp>self</span><span class=o>.</span><span class=n>id</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=mi>0</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;content&#34;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=mi>1</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;author&#34;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=mi>2</span><span class=p>],</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;create_at_key&#34;</span><span class=p>:</span> <span class=n>result</span><span class=p>[</span><span class=mi>3</span><span class=p>],</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>update</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>title</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>content</span><span class=o>=</span><span class=kc>None</span><span class=p>,</span> <span class=n>author</span><span class=o>=</span><span class=kc>None</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;更新文章&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>article_data</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>title</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>article_data</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>title_key</span><span class=p>]</span> <span class=o>=</span> <span class=n>title</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>content</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>article_data</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>content_key</span><span class=p>]</span> <span class=o>=</span> <span class=n>content</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>author</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>article_data</span><span class=p>[</span><span class=bp>self</span><span class=o>.</span><span class=n>author_key</span><span class=p>]</span> <span class=o>=</span> <span class=n>author</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>mset</span><span class=p>(</span><span class=n>article_data</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>Redis</span><span class=p>(</span><span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>article</span> <span class=o>=</span> <span class=n>Article</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=mi>10086</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 创建文章</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>article</span><span class=o>.</span><span class=n>create</span><span class=p>(</span><span class=s2>&#34;message&#34;</span><span class=p>,</span> <span class=s2>&#34;hello world&#34;</span><span class=p>,</span> <span class=s2>&#34;sx&#34;</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 获取文章信息</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>article</span><span class=o>.</span><span class=n>get</span><span class=p>())</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 更新文章作者</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>article</span><span class=o>.</span><span class=n>update</span><span class=p>(</span><span class=n>author</span><span class=o>=</span><span class=s2>&#34;join&#34;</span><span class=p>))</span>
</span></span></code></pre></div><p>上面程序使用了多个字符串键存储文章信息: <code>article::&lt;id>::&lt;attribute></code></p><ul><li>STRLEN: 获取字符串的字节长度 O(1)<blockquote><p>STRLEN key</p></blockquote></li></ul><p>对于存在的键, 返回字节长度信息. 对于不存在的键, 返回0</p><ul><li>GETRANGE: 获取字符串值指定索引范围上的内容 O(N)<blockquote><p>GETRANGE key start end</p></blockquote></li></ul><pre tabindex=0><code class=language-Redis data-lang=Redis>SET message &#34;hello world&#34;
GETRANG message 0 4
&gt; hello

GETRANGE message -5 -1
&gt; world
</code></pre><ul><li>SETRANGE: 修改字符串索引范围的值 O(N)<blockquote><p>SETRANGE key index subsitute</p></blockquote></li></ul><pre tabindex=0><code class=language-Redis data-lang=Redis>set message &#34;hello world&#34;
SETRANGE message 6 Redis
&gt; (integer) 11

GET message
&gt; hello Redis
</code></pre><p>当用户给定的新内容比被替换内容长的时候, SETRANGE 会自动扩展被修改的字符串值</p><pre tabindex=0><code class=language-Redis data-lang=Redis>SETRANGE message 5 &#34;, this is a message&#34;
&gt; (integer) 24

GET message
&gt; &#34;hello, this is a message&#34;
</code></pre><p>当用户给出的索引长度超出被替换字符长度时, 字符串末尾到 index-1 之间部分将使用空字符串填充为0</p><pre tabindex=0><code class=language-Redis data-lang=Redis>SET greeting &#34;hello&#34;
SETRANGE greeting 10 &#34;hello&#34;
&gt; (integer) 15

GET greeting
&gt; &#34;hello\x00\x00\x00\x00\x00world&#34;
</code></pre><h3 id=示例-给文章存储程序加上文章长度计数功能和文章御览功能给>示例: 给文章存储程序加上文章长度计数功能和文章御览功能给<a hidden class=anchor aria-hidden=true href=#示例-给文章存储程序加上文章长度计数功能和文章御览功能给>#</a></h3><ul><li>文章长度计数功能: 显示文章长度, 用于估计阅读时长</li><li>文章预览功能: 显示文章开头一部分内容, 帮助读者快速了解文章</li></ul><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=k>class</span> <span class=nc>Article</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_content_len</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>strlen</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>content_key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_content_perview</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>preview_len</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>start_index</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=n>end_index</span> <span class=o>=</span> <span class=n>preview_len</span> <span class=o>-</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>getrange</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>content</span><span class=p>,</span> <span class=n>start_index</span><span class=p>,</span> <span class=n>end_index</span><span class=p>)</span>
</span></span></code></pre></div><ul><li>APPEND: 追加新内容到值的末尾<blockquote><p>APPEND key suffix</p></blockquote></li></ul><p>若用户给定的 key 不存在, 则相当于 SET key suffix</p><h3 id=示例-存储日志>示例: 存储日志<a hidden class=anchor aria-hidden=true href=#示例-存储日志>#</a></h3><p>很多程序运行的时候会产生日志, 日志记录了程序的运行状态以及执行过的重要操作.
若每条日志存储一个键值对, 则会消耗很多资源, 且分散在数据库中, 需要额外的时间查找日志, 这里将不同日志拼接在同一个值里面.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>redis</span> <span class=kn>import</span> <span class=n>Redis</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>LOG_SEPERATOR</span> <span class=o>=</span> <span class=s2>&#34;</span><span class=se>\n</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Log</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key</span> <span class=o>=</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>add</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>new_log</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>new_log</span> <span class=o>+=</span> <span class=n>LOG_SEPERATOR</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>,</span> <span class=n>new_log</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_all</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>all_logs</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>all_logs</span> <span class=ow>is</span> <span class=ow>not</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>log_list</span> <span class=o>=</span> <span class=n>all_logs</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=n>LOG_SEPERATOR</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>log_list</span><span class=o>.</span><span class=n>remove</span><span class=p>(</span><span class=s2>&#34;&#34;</span><span class=p>)</span> <span class=c1># 删除默认多余的空字符串</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>log_list</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>[]</span>
</span></span></code></pre></div><h2 id=数字值>数字值<a hidden class=anchor aria-hidden=true href=#数字值>#</a></h2><p>下面介绍使用字符串键存储数字值:</p><p>每当存储一个值到字符串键里面的时候, 有下面两种情况</p><ol><li>C 语言 long long int 类型的整数, 取值范围为 -2^63 ~ 2^63-1 (超出范围会被当成字符串)</li><li>C 语言 long double 类型的浮点数</li></ol><p>为了方便地处理字符串键的值, Redis 提供了一系列加法和减法操作命令, 下面介绍这些命令</p><ul><li><p>INCRBY, DECRBY: 对整数执行加法和减法操作 O(1)</p><blockquote><p>INCRBY key increment
DECRBY key increment</p></blockquote><pre><code>如果类型为浮点数, 使用上面方法会报错 (key的值 和 increment 都必须为整数)

当该命令遇到**不存在的键**时, 会将键的值初始化为0, 然后再执行操作
</code></pre></li><li><p>INCR, DECR: 对整数执行加1和减1操作 O(1)</p><blockquote><p>INCR key
DECR key</p></blockquote></li><li><p>INCRBYFLOAT: 对数字值执行浮点数加减法操作</p><blockquote><p>INCRBYFLOAT key increment</p></blockquote><pre><code>INCRBYFLOAT 命令即执行加法操作, 也可以执行加法操作, 并且操作对象和 increment 都既可以为整数也可以为浮点数

虽然 Redis 没有限制字符串键存储浮点数的小数位数, 但是 INCRBYFLOAT 最多只会保留小数点后的17位数字, 超出部分将被截断
</code></pre></li></ul><h3 id=示例-id-生成器>示例: ID 生成器<a hidden class=anchor aria-hidden=true href=#示例-id-生成器>#</a></h3><p>identifier 标识符, 经常在程序中使用, 通常以数字形式出现, 并通过递增的方法创建新的ID.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>redis</span> <span class=kn>import</span> <span class=n>Redis</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>IdGenerator</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key</span> <span class=o>=</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>produce</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;生成下一个id&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>incr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>reserve</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>n</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;初始化&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>result</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>,</span> <span class=n>n</span><span class=p>,</span> <span class=n>nx</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span> <span class=c1># key 不存在才行</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>result</span> <span class=ow>is</span> <span class=kc>True</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>Redis</span><span class=p>(</span><span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>id_generator</span> <span class=o>=</span> <span class=n>IdGenerator</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=s2>&#34;user::id&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>id_generator</span><span class=o>.</span><span class=n>reserve</span><span class=p>(</span><span class=mi>1000000</span><span class=p>))</span> <span class=c1># 保留100万个ID -&gt; True</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>id_generator</span><span class=o>.</span><span class=n>produce</span><span class=p>())</span> <span class=c1># 生成ID, 均大于100万</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>id_generator</span><span class=o>.</span><span class=n>reserve</span><span class=p>(</span><span class=mi>1000</span><span class=p>))</span> <span class=c1># 已存在 -&gt; False</span>
</span></span></code></pre></div><h3 id=示例-计数器>示例: 计数器<a hidden class=anchor aria-hidden=true href=#示例-计数器>#</a></h3><p>除了ID生成器, 计数器也是常用的组件之一, 例如点赞回复数量, 播放量等.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>redis</span> <span class=kn>import</span> <span class=n>Redis</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Counter</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key</span> <span class=o>=</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>increase</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>n</span><span class=o>=</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>incr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>decrease</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>n</span><span class=o>=</span><span class=mi>1</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>decr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>,</span> <span class=n>n</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>value</span> <span class=ow>in</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=nb>int</span><span class=p>(</span><span class=n>value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>reset</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>old_value</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>getset</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>old_value</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span><span class=p>(</span><span class=n>old_value</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>Redis</span><span class=p>(</span><span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>counter</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=s2>&#34;counter::page_viewed&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>counter</span><span class=o>.</span><span class=n>increase</span><span class=p>())</span> <span class=c1># +1</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>counter</span><span class=o>.</span><span class=n>increase</span><span class=p>())</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>counter</span><span class=o>.</span><span class=n>increase</span><span class=p>(</span><span class=mi>10</span><span class=p>))</span> <span class=c1># +10</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>counter</span><span class=o>.</span><span class=n>decrease</span><span class=p>())</span> <span class=c1># -1</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>counter</span><span class=o>.</span><span class=n>decrease</span><span class=p>(</span><span class=mi>5</span><span class=p>))</span> <span class=c1># -5</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>counter</span><span class=o>.</span><span class=n>reset</span><span class=p>())</span> <span class=c1># 重置计数器</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>counter</span><span class=o>.</span><span class=n>get</span><span class=p>())</span> <span class=c1># 返回计数器当前值</span>
</span></span></code></pre></div><blockquote><p>注: 在 redis-py 中 INCR 和 INCRBY 都使用 .incr() 方法</p></blockquote><h3 id=示例-限速器>示例: 限速器<a hidden class=anchor aria-hidden=true href=#示例-限速器>#</a></h3><p>为了保障系统的安全性和性能, 并保证重要资源不被滥用, 应用程序需要对用户的行为进行限制</p><ul><li>防止网络爬虫: 限制每个IP地址在固定时间段内访问的页面数量</li><li>防止爆力破解: 当用户多次输入错误的密码, 会帐号进行冻结</li></ul><p>上面机制的实现可以使用限速器, 下面是一个限速器示例代码, 该程序将操作最大可执行次数存储在一个字符串里面, 每次用户进行该操作后就将其减1</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-Python data-lang=Python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>redis</span> <span class=kn>import</span> <span class=n>Redis</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>Limter</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>client</span><span class=p>,</span> <span class=n>key</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span> <span class=o>=</span> <span class=n>client</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>key</span> <span class=o>=</span> <span class=n>key</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>set_max_execute_times</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>max_execut_time</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>set</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>,</span> <span class=n>max_execut_time</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>still_valid_to_execute</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>num</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>decr</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>num</span> <span class=o>&gt;=</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>remaining_execute_times</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=n>num</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>client</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=bp>self</span><span class=o>.</span><span class=n>key</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>num</span> <span class=o>&lt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>num</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>client</span> <span class=o>=</span> <span class=n>Redis</span><span class=p>(</span><span class=n>decode_responses</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>limter</span> <span class=o>=</span> <span class=n>Limter</span><span class=p>(</span><span class=n>client</span><span class=p>,</span> <span class=s2>&#34;wrong_password_limter&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>limter</span><span class=o>.</span><span class=n>set_max_execute_times</span><span class=p>(</span><span class=mi>5</span><span class=p>))</span> <span class=c1># 最多5次输入错误密码</span>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=n>limter</span><span class=o>.</span><span class=n>still_valid_to_execute</span><span class=p>())</span> <span class=c1># 前5次 True, 之后 False</span>
</span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://starslayerx.github.io/tags/redis/>Redis</a></li></ul><nav class=paginav><a class=prev href=https://starslayerx.github.io/posts/http-methods-status-codes-and-payloads/><span class=title>« Prev</span><br><span>HTTP Methods, Status Codes and Payloads</span>
</a><a class=next href=https://starslayerx.github.io/posts/ieee-754-introduce/><span class=title>Next »</span><br><span>IEEE-754 Introduce</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis String on x" href="https://x.com/intent/tweet/?text=Redis%20String&amp;url=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-string%2f&amp;hashtags=Redis"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis String on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-string%2f&amp;title=Redis%20String&amp;summary=Redis%20String&amp;source=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-string%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis String on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-string%2f&title=Redis%20String"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis String on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-string%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis String on whatsapp" href="https://api.whatsapp.com/send?text=Redis%20String%20-%20https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-string%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis String on telegram" href="https://telegram.me/share/url?text=Redis%20String&amp;url=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-string%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentColor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Redis String on ycombinator" href="https://news.ycombinator.com/submitlink?t=Redis%20String&u=https%3a%2f%2fstarslayerx.github.io%2fposts%2fredis-string%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentColor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer></article></main><footer class=footer><span>&copy; 2026 <a href=https://starslayerx.github.io/>Starslayerx' Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");if(menu){const e=localStorage.getItem("menu-scroll-position");e&&(menu.scrollLeft=parseInt(e,10)),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}}document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{const e=document.querySelector("html");e.dataset.theme==="dark"?(e.dataset.theme="light",localStorage.setItem("pref-theme","light")):(e.dataset.theme="dark",localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>