{"categories":[],"pages":[],"posts":[{"link":"/zh-cn/posts/python-%E6%8A%80%E5%B7%A7/","text":"1. è‡ªæˆ‘å¤åˆ¶æŠ€å·§ å°†ä¸€ä¸ªå«æœ‰ç©ºåˆ—è¡¨çš„åˆ—è¡¨ä¹˜5, å¾—åˆ°æœ‰5ä¸ªç©ºåˆ—è¡¨çš„åˆ—è¡¨\nPYTHON æŠ˜å  å¤åˆ¶ x = [[]] * 5 x ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š [[], [], [], [], []]\nå½“ä½¿ç”¨.append(\u0026quot;x\u0026quot;)æ–¹æ³•æ—¶, æ‰€æœ‰åˆ—è¡¨éƒ½è¢«ä¿®æ”¹\nPYTHON æŠ˜å  å¤åˆ¶ x[0].append(\u0026#34;x\u0026#34;) x ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š [[\u0026ldquo;x\u0026rdquo;], [\u0026ldquo;x\u0026rdquo;], [\u0026ldquo;x\u0026rdquo;], [\u0026ldquo;x\u0026rdquo;], [\u0026ldquo;x\u0026rdquo;]]\næ‰“å°å…¶ id å¯ä»¥çœ‹åˆ°, id éƒ½ç›¸åŒ\nPYTHON æŠ˜å  å¤åˆ¶ for item in x: print(id(item)) ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š 4417579584 4417579584 4417579584 4417579584 4417579584\næˆ–è€…ä½¿ç”¨set()å‘ç° id å”¯ä¸€\nPYTHON æŠ˜å  å¤åˆ¶ set(id(item) for item in x) ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š {4417579584}\nä¹Ÿå°±æ˜¯è¯´, å½“ä½¿ç”¨ä¹˜æ³•çš„æ—¶å€™, åˆ›å»ºäº†5ä¸ªå†…éƒ¨åˆ—è¡¨çš„å¼•ç”¨å‰¯æœ¬\nä½¿ç”¨åæ±‡ç¼–å‘ç°, åªåˆ›å»ºäº†ä¸¤ä¸ªåˆ—è¡¨, å¹¶æ‰§è¡Œä¹˜5\nPYTHON æŠ˜å  å¤åˆ¶ dis.dis(\u0026#34;[[]] * 5\u0026#34;) 0 0 RESUME 0 # ç”¨äºæ”¯æŒè§£é‡Šå™¨æ¢å¤ (py3.11) 1 2 BUILD_LIST 0 # æ„é€ ä¸€ä¸ªç©ºåˆ—è¡¨[], å‹æ ˆ 4 BUILD_LIST 1 # ä»æ ˆé¡¶å–ä¸€ä¸ªå¯¹è±¡, æ„é€ åˆ—è¡¨[[]] 6 LOAD_CONST 0 (5) # åŠ è½½å¸¸é‡ 5 8 BINARY_OP 5 (*) # å¯¹æ ˆé¡¶ä¸¤ä¸ªå…ƒç´ æ‰§è¡Œä¹˜æ³• 12 RETURN_VALUE # è¿”å›æ ˆé¡¶ç»“æœ ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š æ›¿ä»£æ–¹æ³• å¦‚æœè¦æ„é€ ç‹¬ç«‹åˆ—è¡¨, åº”æ”¹ç”¨åˆ—è¡¨æ¨å¯¼å¼\nPYTHON æŠ˜å  å¤åˆ¶ x = [[] for _ in range(5)] x ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š [[], [], [], [], []]\nPYTHON æŠ˜å  å¤åˆ¶ for item in x: print(id(item)) ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š 4587832384 4587818752 4587831168 4587839168 4587809152\nPYTHON æŠ˜å  å¤åˆ¶ set(id(item) for item in x) ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š {4587809152, 4587818752, 4587831168, 4587832384, 4587839168}\n2. ä¼ é€æŠ€å·§ PYTHON æŠ˜å  å¤åˆ¶ def add_to_shopping_list(item, shopping_list=[]): shopping_list.append(item) return shopping_list ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š ä¸Šé¢å‡½æ•°ä¸ºä¸€ä¸ªç©ºåˆ—è¡¨ä¸­æ·»åŠ ä¸€ä¸ª item, æœŸæœ›æ¯æ¬¡åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºåˆ—è¡¨, å¹¶æ·»åŠ ä¸€ä¸ªitem\nPYTHON æŠ˜å  å¤åˆ¶ groceries = add_to_shopping_list(\u0026#34;Bread\u0026#34;) groceries ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š [\u0026lsquo;Bread\u0026rsquo;]\nPYTHON æŠ˜å  å¤åˆ¶ books = add_to_shopping_list(\u0026#34;A Brief History of Time\u0026#34;) books ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š [\u0026lsquo;Bread\u0026rsquo;, \u0026lsquo;A Brief History of Time\u0026rsquo;]\nç„¶è€Œ, \u0026lsquo;Bread\u0026rsquo; è¢«ä¼ é€åˆ° books é‡Œé¢å»äº†\nä¸‹é¢ä¸ä½¿ç”¨é»˜è®¤å‚æ•°, æµ‹è¯•ä¸€ä¸‹å‡½æ•°\nPYTHON æŠ˜å  å¤åˆ¶ cakes = [] cakes = add_to_shopping_list(\u0026#34;Chorolate Cake\u0026#34;, cakes) cakes ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š [\u0026lsquo;Chorolate Cake\u0026rsquo;]\nPYTHON æŠ˜å  å¤åˆ¶ tools = [] tools = add_to_shopping_list(\u0026#34;Snapper\u0026#34;, tools) tools ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š [\u0026lsquo;Snapper\u0026rsquo;]\nå½“ä¼ å…¥ä¸€ä¸ªå­˜åœ¨çš„åˆ—è¡¨æ—¶, æ²¡æœ‰å‘ç”Ÿä¼ é€è¡Œä¸º\nå›åˆ°å‡½æ•°å®šä¹‰: é»˜è®¤å‚æ•°çš„åˆ—è¡¨, åœ¨å‡½æ•°å®šä¹‰çš„æ—¶å€™å·²ç»è¢«åˆ›å»ºäº†, å› æ­¤æ¯æ¬¡ä½¿ç”¨è¯¥å‡½æ•°è€Œä¸ä¼ å…¥åˆ—è¡¨å‚æ•°çš„æ—¶å€™, é»˜è®¤åˆ—è¡¨shopping_listå°±ä¼šè¢«ä½¿ç”¨, ä¸” list æ˜¯ä¸€ä¸ªå¯å˜ç±»å‹, å› æ­¤æ¯æ¬¡ä¼šä¿®æ”¹è¿™ä¸ªåˆ—è¡¨\nä½¿ç”¨ä¸‹é¢æ–¹æ³•, æ¯æ¬¡æ‰“å°å‡ºä½¿ç”¨åˆ—è¡¨çš„ id, ä¼šå‘ç°ä¸ä¼ å…¥åˆ—è¡¨å‚æ•°æ—¶çš„ id éƒ½ç›¸åŒ\nPYTHON æŠ˜å  å¤åˆ¶ def add_to_shopping_list(item, shopping_list=[]): print(id(shopping_list)) shopping_list.append(item) return shopping_list ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š æ›¿ä»£æ–¹æ³• è¿™ä¸ª bug åœ¨ä½¿ç”¨å¯å˜ç±»å‹(mutable)ä½œä¸ºé»˜è®¤å‚æ•°çš„æ—¶å€™éƒ½ä¼šå‘ç”Ÿ, åº”è¯¥é¿å…å¯å˜æ•°æ®ç±»å‹ä½œä¸ºé»˜è®¤å‚æ•°\nå¦‚æœæƒ³è¦é»˜è®¤å€¼å‚æ•°, å¯ä»¥è€ƒè™‘ä½¿ç”¨ None ä½œä¸ºå‚æ•°é»˜è®¤å€¼\nPYTHON æŠ˜å  å¤åˆ¶ def add_to_shopping_list(item, shopping_list=None): if shopping_list is None: shopping_list = [] shopping_list.append(item) return shopping_list ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š æ¶ˆå¤±æŠ€å·§ ä¸‹é¢æ˜¯æœ€åä¸€ä¸ª trick\nPYTHON æŠ˜å  å¤åˆ¶ doubles = (number * 2 for number in range(10)) 4 in doubles # True 4 in doubles # False ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š ä¸Šé¢ç»“æœçœ‹èµ·æ¥å¾ˆçŸ›ç›¾, 4 æ€ä¹ˆä¸€ä¼šå„¿åœ¨ doubles ä¸­, ä¸€ä¼šå„¿åˆä¸å† doubles ä¸­?\nå†æ¥çœ‹ä¸€ä¸ªä¾‹å­\nPYTHON æŠ˜å  å¤åˆ¶ another_doubles = [number * 2 for number in range(10)] 4 in another_doubles # True 4 in another_doubles # True ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š ä¸Šé¢è¿™ä¸ªä¾‹å­ä¸­, å°±éƒ½æ˜¯ True\né—®é¢˜å‡ºåœ¨, å½“ä½¿ç”¨æ‹¬å·()åˆ›å»º doubles çš„æ—¶å€™, å¹¶ä¸æ˜¯åˆ›å»ºäº†å…ƒç»„ tuple, è€Œæ˜¯ä¸€ä¸ªç”Ÿæˆå™¨ generator\nPYTHON æŠ˜å  å¤åˆ¶ doubles = (number ** 2 for number in range(10)) doubles ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š \u0026lt;generator object at 0x111718e10\u0026gt;\nç”Ÿæˆå™¨å¹¶ä¸ä¼šåŒ…å«æ‰€æœ‰çš„å€¼, è€Œæ˜¯åœ¨ä½¿ç”¨çš„æ—¶å€™ç”Ÿæˆæ¯ä¸ªå€¼\nä¾‹å¦‚, è°ƒç”¨ next() ä¼šè¿”å›ä¸‹ä¸€ä¸ªå€¼\nPYTHON æŠ˜å  å¤åˆ¶ next(doubles) # 0 next(doubles) # 1 next(doubles) # 2 next(doubles) # 4 ... next(doubles) # 18 next(doubles) ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š StopIteration Traceback (most recent call last)\nç”Ÿæˆå™¨æ˜¯ä¸€æ¬¡å‹çš„æ•°æ®ç»“æ„, å½“ç”Ÿæˆä¸‹ä¸€ä¸ªæ•°æ®çš„æ—¶å€™, ä¹‹å‰çš„æ•°æ®ä¸ä¼šè¢«ä¿å­˜, ä¹Ÿå°±æ˜¯åªèƒ½éå†æ•°æ®ä¸€æ¬¡\nä¸€ä½†éå†å®Œæˆ, å°±ä¼šæŠ¥StopIterationçš„é”™è¯¯, æ‰€ä»¥å½“è¿è¡Œ4 in doublesçš„æ—¶å€™, å…ˆå¾—åˆ°0, ä¸º False, ç”Ÿæˆå™¨ä¼šç»§ç»­éå†ä¸‹ä¸€ä¸ª, ç›´åˆ°å¾—åˆ°4, å½“å†æ¬¡è°ƒç”¨çš„æ—¶å€™, ä¸‹ä¸€ä¸ªè¿”å›6, ç›´åˆ°éå†ç»“æŸä¹Ÿæ— æ³•å¾—åˆ°åˆ°4\nåŒæ ·çš„è¡Œä¸ºåœ¨è¿­ä»£å™¨ iterator ä¸Šä¹Ÿä¸€æ ·\nPYTHON æŠ˜å  å¤åˆ¶ numbers = [2, 4, 6, 8] numbers_rev = reversed(numbers) numbers_rev # \u0026lt;list_reverseiterator object at 0x......\u0026gt; 4 in numbers_rev # True 4 in numbers_rev # False ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š æ›¿ä»£æ–¹æ³• å¦‚æœä½¿ç”¨ç”Ÿæˆå™¨, è¦çŸ¥é“åªèƒ½éå†æ¯ä¸ªå…ƒç´ ä¸€æ¬¡, å¦‚æœè¦è·å¾—ä¸€ä¸ªæœ‰æ‰€æœ‰å…ƒç´ çš„æ•°æ®ç»“æ„, åº”è¯¥ä½¿ç”¨å…ƒç´  tuple æˆ–åˆ—è¡¨ list\nPYTHON æŠ˜å  å¤åˆ¶ doubles = (number * 2 for number in range(10)) # generator more_doubles = tuple(number * 2 for number in range(10)) # tuple 4 in more_doubles # True 4 in more_doubles # True ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š ","title":"Python æŠ€å·§"},{"link":"/zh-cn/posts/%E9%80%9A%E8%BF%87%E6%B3%A8%E9%87%8A%E6%89%A7%E8%A1%8C%E4%BB%BB%E6%84%8F-python-%E4%BB%A3%E7%A0%81/","text":"é€šè¿‡æ³¨é‡Šæ‰§è¡Œä»»æ„Pythonä»£ç \né—®é¢˜æè¿° Q: åªèƒ½æ§åˆ¶ä¸€è¡Œçš„.pyä»£ç ä¸­æ³¨é‡Šçš„å†…å®¹(\\n\\rå‡ä¼šè¢«æ›¿æ¢ä¸ºç©ºå­—ç¬¦), å¦‚ä½•æ‰§è¡Œä»»æ„ä»£ç ?\nA: åœ¨æ³¨é‡Š#ä¸­, æ„é€ ä¸€ä¸ª.zip æ–‡ä»¶, python ä¼šå°†è¯¥å†…å®¹å½“æˆä¸€ä¸ªzipåŒ…æ‰§è¡Œ, è§¦å‘ä»»æ„ä»£ç æ‰§è¡Œ\nè§£å†³æ–¹æ¡ˆ ä» Python 3.5 èµ·, å¯ä»¥ç›´æ¥æ‰§è¡Œä¸€ä¸ª .zip æ–‡ä»¶\nPYTHON3 æŠ˜å  å¤åˆ¶ python myapp.zip ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š å‰ææ˜¯ZIP åŒ…ä¸­åŒ…å«ä¸€ä¸ªé¡¶å±‚çš„__main__.pyæ–‡ä»¶, Python ä¼šæŠŠå®ƒå½“ä½œ zipapp, è‡ªåŠ¨è§£å‹å¹¶è¿è¡Œ__main__.py\nPython ä¼šä»æœ«å°¾æ‰¾åˆ° ZIP çš„ç›®å½•ç»“æ„, è€Œä¸æ˜¯ä¾èµ–æ–‡ä»¶å¤´, æ‰€ä»¥å‰é¢çš„â€œåƒåœ¾â€å­—èŠ‚ä¼šè¢«å¿½ç•¥\nPython æºç ä¸­çš„ä»»ä½•è¡Œ, åªè¦ä»¥ # å¼€å¤´, è§£é‡Šå™¨éƒ½ä¼šå¿½ç•¥åé¢å†…å®¹, å› æ­¤å¯ä»¥:\næŠŠ ZIP æ–‡ä»¶çš„æ•°æ®è—åœ¨ Python æºç ä¸­çš„æ³¨é‡Šä¸­ï¼ˆå¼€å¤´åŠ  #ï¼‰ æŠŠ ZIP æ•°æ®ç›´æ¥æ‹¼æ¥åœ¨ Python æ–‡ä»¶çš„åé¢, åªä¿è¯æ–‡ä»¶å¤´éƒ¨åˆ†æ˜¯åˆæ³• Python ZIP ä¸å…³å¿ƒå‰ç¼€, Python åªè¦æœ€å‰é¢æ˜¯æœ‰æ•ˆæºç , ä¹Ÿä¸ä¼šç®¡åé¢ éš¾ç‚¹ ZIP æ–‡ä»¶å¤´åŒ…å«äºŒè¿›åˆ¶å­—æ®µï¼Œæ¯”å¦‚\nåç§»é‡ï¼ˆæ–‡ä»¶æ•°æ®ç›¸å¯¹äº ZIP å¼€å¤´çš„ä½ç½®ï¼‰ é•¿åº¦ï¼ˆæ–‡ä»¶åé•¿åº¦ã€æ³¨é‡Šé•¿åº¦ç­‰ï¼‰ è¿™äº›å€¼å†™æ­»åœ¨ header é‡Œ, æ˜¯åå…­è¿›åˆ¶æ•´æ•° å¦‚æœè¿™äº›å­—èŠ‚ä¸­å‡ºç°äº†åƒ \\x00ã€\\xFF ç­‰é ASCII å†…å®¹, Python å°±ä¸èƒ½æŠŠå®ƒå½“æ³¨é‡Š è§£å†³æ–¹æ³•: æš´åŠ›ç©·ä¸¾åˆæ³•ç»„åˆ\næƒ³åŠæ³• è°ƒæ•´åç§»å€¼å’Œç»“æ„ä½ç½®ï¼Œä½¿å¾—æœ€ç»ˆå†™å‡ºæ¥çš„ ZIP æ–‡ä»¶\næ‰€æœ‰çš„å­—æ®µå€¼éƒ½è½¬åŒ–ä¸º å¯æ‰“å°å­—ç¬¦ï¼ˆASCII èŒƒå›´å†…ï¼‰ æ‰€æœ‰ binary å­—æ®µçœ‹èµ·æ¥éƒ½åƒåˆæ³•çš„æ³¨é‡Šå­—ç¬¦ä¸² äºæ˜¯ç”¨ itertools.product(range(256), repeat=2) æš´åŠ›å°è¯•åç§»ç»„åˆï¼Œåªè¦ç¢°å·§ç”Ÿæˆçš„ ZIP åŒ…æ‰€æœ‰å…³é”®å­—èŠ‚éƒ½åœ¨å¯æ‰“å°èŒƒå›´å†…ï¼ˆASCII 32~126ï¼‰ï¼Œå°±è®¤ä¸ºæˆåŠŸã€‚ ä¸‹é¢æ˜¯generate_polygloy_zip.pyä»£ç , ä¼šç”Ÿæˆä¸€ä¸ªç¬¦åˆè¦æ±‚çš„polygloy.pyä»£ç , æœ€åè¿è¡Œè¯¥ä»£ç , å¯ä»¥æ‰§è¡ŒBodyé‡Œé¢çš„å†…å®¹BODY = b\u0026quot;print('FROM MAIN.py FILE!!!')#\u0026quot;\nPYTHON3 æŠ˜å  å¤åˆ¶ # struct: æŒ‰å­—èŠ‚ç»“æ„æ‰“åŒ…æ•°æ®ï¼Œæ–¹ä¾¿æ„é€  ZIP æ–‡ä»¶äºŒè¿›åˆ¶å¤´ # itertools: ç”¨æ¥æš´åŠ›æšä¸¾ CRC æ ¡éªŒå’Œåç¼€ï¼ˆç¡®ä¿å®‰å…¨ASCIIï¼‰ # zlib: è®¡ç®— CRC32 æ ¡éªŒå’Œ import struct, itertools, zlib # æ–‡ä»¶å¼€å¤´ä»£ç  # encode(): Unicode å­—ç¬¦ä¸² -\u0026gt; bytes å­—èŠ‚ä¸² JUNK_HEAD = \u0026#34;\u0026#34;\u0026#34;print(\u0026#34;Hello World!\u0026#34;) # This is a comment. Here\u0026#39;s another: # \u0026#34;\u0026#34;\u0026#34;.encode() # æ–‡ä»¶ç»“å°¾ä»£ç  JUNK_TAIL = \u0026#34;\u0026#34;\u0026#34; print(\u0026#34;Thanks for playing!\u0026#34;)\u0026#34;\u0026#34;\u0026#34; # zip æ–‡ä»¶æ ¸å¿ƒä»£ç  # b: å­—èŠ‚ä¸² FILENAME = b\u0026#34;__main__.py\u0026#34; BODY = b\u0026#34;print(\u0026#39;FROM MAIN.py FILE!!!\u0026#39;)#\u0026#34; # æ ¡éªŒ CRC æ˜¯å¦ä¸º ASCII-safe def ascii_safe(x: int) -\u0026gt; bool: return all(((x \u0026gt;\u0026gt; (8*i)) \u0026amp; 0x80) == 0 for i in range(4)) # æ£€æŸ¥ 32 ä½æ•´æ•°çš„å››ä¸ªå­—èŠ‚ï¼Œæ¯ä¸ªå­—èŠ‚æœ€é«˜ä½ï¼ˆ0x80ï¼‰æ˜¯å¦ä¸º 0ï¼Œå³æ˜¯å¦ä¸º ASCII èŒƒå›´å†…çš„å­—èŠ‚ def find_suffix(core: bytes, length: int = 4) -\u0026gt; tuple[bytes, int]: \u0026#34;\u0026#34;\u0026#34; - ZIP æ–‡ä»¶ CRC32 è®¡ç®—ç»“æœå¿…é¡» ASCII-safeï¼ˆä½äº 0x80ï¼‰ - è¿™é‡Œç”¨æš´åŠ›æ–¹æ³•ï¼Œç»™ payload åé¢åŠ 4å­—èŠ‚åç¼€ï¼Œæ‰¾åˆ°åˆé€‚çš„åç¼€è®© CRC32 æ»¡è¶³ ASCII-safe æ¡ä»¶ \u0026#34;\u0026#34;\u0026#34; printable = range(0x20, 0x7f) for tail in itertools.product(printable, repeat=length): payload = core + bytes(tail) crc = zlib.crc32(payload) \u0026amp; 0xFFFFFFFF if ascii_safe(crc): return bytes(tail), crc raise RuntimeError(\u0026#34;No ASCII-safe CRC found.\u0026#34;) # è®¡ç®—æœ€ç»ˆ payload SUFFIX, CRC = find_suffix(BODY) PAYLOAD = BODY + SUFFIX SIZE = len(PAYLOAD) def le32(x): return struct.pack(\u0026#34;\u0026lt;I\u0026#34;, x) # 4å­—èŠ‚å°ç«¯æ— ç¬¦å·æ•´æ•° def le16(x): return struct.pack(\u0026#34;\u0026lt;H\u0026#34;, x) # 2å­—èŠ‚å°ç«¯æ— ç¬¦å·æ•´æ•° # ZIP ç»“æ„ä¸­å„ç­¾åå¸¸é‡ SIG_LFH = 0x04034B50 # æœ¬åœ°æ–‡ä»¶å¤´ Local File Header SIG_CDH = 0x02014B50 # ä¸­å¤®ç›®å½•å¤´ Central Directory Header SIG_EOCD = 0x06054B50 # ç»“æŸç›®å½•å¤´ End of Central Directory # zip æ–‡ä»¶åç§»é‡è®¾ç½® delta = len(JUNK_HEAD) # æ„å»º Local File Header \u0026#34;\u0026#34;\u0026#34; Local File Header æ˜¯ ZIP æ ¼å¼ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå‘Šè¯‰è§£å‹ç¨‹åºè¯¥æ–‡ä»¶çš„å…ƒä¿¡æ¯ - version needed to extractï¼Œflagsï¼Œcompression method ç­‰å­—æ®µç½® 0 è¡¨ç¤ºæ— å‹ç¼©ï¼Œç®€å•å­˜å‚¨ - CRC32ã€å‹ç¼©å¤§å°ã€è§£å‹å¤§å°éƒ½æ˜¯æˆ‘ä»¬è®¡ç®—çš„ - æ–‡ä»¶åé•¿åº¦å’Œæ–‡ä»¶å \u0026#34;\u0026#34;\u0026#34; lfh = ( le32(SIG_LFH) + le16(0) + le16(0) + le16(0) + le16(0) + le16(0) + le32(CRC) + le32(SIZE) + le32(SIZE) + le16(len(FILENAME)) + le16(0) + FILENAME ) # æ„å»º Central Directory Header \u0026#34;\u0026#34;\u0026#34; - Central Directory æ˜¯ ZIP æ–‡ä»¶ç›®å½•ç»“æ„ï¼Œè®°å½•æ¯ä¸ªæ–‡ä»¶ä¿¡æ¯å’Œåç§»ï¼Œ - å…¶ä¸­é‡è¦çš„æ˜¯ relative offset of LFHï¼Œä¹Ÿå°±æ˜¯ Local File Header åœ¨æ•´ä¸ª ZIP æ–‡ä»¶é‡Œçš„åç§»ï¼Œå¿…é¡»åŠ ä¸Š delta \u0026#34;\u0026#34;\u0026#34; cdh = ( le32(SIG_CDH) + le16(0) + le16(0) + le16(0) + le16(0) + le16(0) + le16(0) + le32(CRC) + le32(SIZE) + le32(SIZE) + le16(len(FILENAME)) + le16(0) + le16(0) + le16(0) + le16(0) + le32(0) + le32(delta) + FILENAME ) # ç¡®ä¿åç§»é‡ ASCII-safe \u0026#34;\u0026#34;\u0026#34; - ZIP ç›®å½•åç§»éœ€è¦æ˜¯ ASCII å­—èŠ‚ï¼Œå¦åˆ™å†™å…¥ .py æ–‡ä»¶æ—¶ä¼šå‡ºé”™ - è¿™é‡Œé€šè¿‡å¡«å……è‹¥å¹² \\x00 å­—èŠ‚ï¼Œä¿è¯åç§»åˆæ³• \u0026#34;\u0026#34;\u0026#34; cd_offset = delta + len(lfh) + len(PAYLOAD) pad = 0 while not ascii_safe(cd_offset + pad): pad += 1 padding = b\u0026#39;\\x00\u0026#39; * pad cd_offset += pad # æ„å»º End of Central Directory Header \u0026#34;\u0026#34;\u0026#34; EOCD è®°å½• ZIP ä¸­å¤®ç›®å½•å¤§å°ã€åç§»åŠæ³¨é‡Šé•¿åº¦ç­‰ä¿¡æ¯ \u0026#34;\u0026#34;\u0026#34; eocd = ( le32(SIG_EOCD) + le16(0) + le16(0) + le16(1) + le16(1) + le32(len(cdh)) + le32(cd_offset) + le16(len(JUNK_TAIL)) ) # æ‹¼æ¥å®Œæ•´ ZIP å†…å®¹ zip_bytes = lfh + PAYLOAD + padding + cdh + eocd zip_bytes = bytearray(zip_bytes) assert all(b \u0026lt; 0x80 for b in zip_bytes), \u0026#34;é ASCII å­—èŠ‚å­˜åœ¨\u0026#34; # å†™å…¥ polyglot.py æ–‡ä»¶ with open(\u0026#34;polyglot.py\u0026#34;, \u0026#34;wb\u0026#34;) as f: f.write(JUNK_HEAD + zip_bytes + JUNK_TAIL.encode()) # è¿è¡Œæç¤º print(\u0026#34;âœ… polyglot.py ç”Ÿæˆå®Œæ¯•ã€‚è¿è¡Œå®ƒå³å¯æ‰§è¡ŒåµŒå…¥çš„ __main__.py å†…å®¹ï¼š\u0026#34;) print(\u0026#34; $ python3 polyglot.py\u0026#34;) ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š ","title":"é€šè¿‡æ³¨é‡Šæ‰§è¡Œä»»æ„ Python ä»£ç "},{"link":"/zh-cn/posts/fastapi-%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86/","text":"FastAPI çš„å·¥ä½œåŸç†: ä» routing åˆ° lifecycle ä»¥åŠåœ¨ç°å®ä¸­çš„ä½¿ç”¨\nFastAPI FastAPI æ˜¯ä¸€ä¸ªç°ä»£çš„ Python Web æ¡†æ¶, æ³¨é‡é«˜æ€§èƒ½å’Œå¼€å‘æ•ˆç‡. æ—¨åœ¨å¸®åŠ©å¼€å‘è€…ç¼–å†™ç»“æ„æ¸…æ™°ã€å¯é çš„API, åŒæ—¶å°½é‡å‡å°‘æ ·æ¿ä»£ç  (boilerplate)\nå…¶ç”±ä»¥ä¸‹ä¸¤ä¸ªåº“é©±åŠ¨:\nStarlette: è´Ÿè´£ Web æœåŠ¡å™¨é€»è¾‘ã€è·¯ç”±ã€ä¸­é—´ä»¶å’Œå¼‚æ­¥èƒ½åŠ› Pydantic: åŸºäº Python ç±»å‹æç¤º, å¤„ç†æ•°æ®éªŒè¯ã€è§£æå’Œåºåˆ—åŒ– æ­¤å¤–, Fastapi è¿˜æœ‰è¾“å…¥éªŒè¯ã€åŸºäº Swagger UI çš„è‡ªåŠ¨æ–‡æ¡£ç”Ÿæˆå’Œä»£ç æ¸…æ™°åŒ–çš„åŸºç¡€\nAPI è¯·æ±‚å‘¨æœŸ Fastapi çš„è¯·æ±‚ç”Ÿå‘½å‘¨æœŸå¦‚ä¸‹\nPLAINTEXT æŠ˜å  å¤åˆ¶ å®¢æˆ·ç«¯è¯·æ±‚ (Client Request) â†“ FastAPI App â†“ ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰ â†“ è·¯ç”±åŒ¹é… (Route Matching) â†“ ä¾èµ–æ³¨å…¥ï¼ˆDependency Injectionï¼‰ â†“ è¾“å…¥éªŒè¯ (Input Validation) â†“ ç«¯ç‚¹å‡½æ•° (Endpoint) â†“ å“åº”åºåˆ—åŒ– (Response Serialization) â†“ å®¢æˆ·ç«¯å“åº” (Client Response) ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š è¯·æ±‚é¦–å…ˆè¿›å…¥ FastAPI åº”ç”¨ (æœ¬è´¨å°±æ˜¯ä¸€ä¸ª Starlette åº”ç”¨) æ‰€æœ‰ä¸­é—´ä»¶ä¼˜å…ˆæ‰§è¡Œ (å¦‚: æ—¥å¿—ã€é”™è¯¯å¤„ç†ã€CORSç­‰) è·¯ç”±å™¨æ£€æŸ¥è·¯å¾„å’Œæ–¹æ³•, æ‰¾åˆ°å¯¹åº”çš„å¤„ç†å‡½æ•° FastAPI ä½¿ç”¨Dependsè§£æä¾èµ– ä½¿ç”¨ Pydantic è‡ªåŠ¨è§£æå¹¶éªŒè¯è¾“å…¥æ•°æ® æ‰§è¡Œç«¯ç‚¹å‡½æ•°, å‚æ•°éªŒè¯å®Œæ¯• è¿”å›ç»“æœè¢«åºåˆ—åŒ–ä¸ºåˆé€‚çš„å“åº”æ ¼å¼ (JSON) å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ è·¯ç”± Router åœ¨åº”ç”¨å¯¹è±¡ä¸Šå®šä¹‰\né€‚åˆå°é¡¹ç›®æˆ–åŸå‹éªŒè¯ PYTHON æŠ˜å  å¤åˆ¶ from fastapi import FastAPI app = FastAPI() @app.get(\u0026#34;/items/{item_id}\u0026#34;) def read_item(): return {\u0026#34;item_id\u0026#34;: item_id} ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š ä½¿ç”¨ APIRouter æ¨¡å—åŒ–\né€‚åˆå¤§é¡¹ç›® PYTHON æŠ˜å  å¤åˆ¶ from fastapi import FastAPI router = APIRouter(prefix=\u0026#34;/users\u0026#34;, tags=[\u0026#34;users\u0026#34;]) @router.get(\u0026#34;/{user_id}\u0026#34;) def get_user(user_id: int): return {\u0026#34;user_id\u0026#34;: user_id} ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š ä½¿ç”¨APIRouterå¯ä»¥å°†ç›¸å…³çš„ç«¯ç‚¹åˆ†ç»„, æ·»åŠ å‰ç¼€å’Œæ ‡ç­¾, ä¿æŒä»£ç ç»“æ„æ¸…æ™°æ¨¡å—åŒ– å½“æŸä¸ªè¯·æ±‚ä¸ç«¯ç‚¹åŒ¹é…æ—¶, FastAPI å†…éƒ¨æ‰§è¡Œä¸€ä¸‹æ­¥éª¤:\nStarlette æ‰¾åˆ°å¯¹åº”è·¯ç”±, å¹¶åˆ›å»ºä¸€ä¸ªAPIRouterå®ä¾‹ FastAPI ä½¿ç”¨get_router_header()åŒ…è£…ç«¯ç‚¹å‡½æ•°å¹¶è§£æä¾èµ– ä½¿ç”¨ Pydantic æˆ–åŸºæœ¬ç±»å‹å¯¹è¯·æ±‚æ•°æ®è§£æä¸éªŒè¯ è£…é¥°å‡½æ•°è¢«è°ƒç”¨, ä¼ å…¥éªŒè¯åçš„å‚æ•° è¿”å›å€¼è¢«åºåˆ—åŒ–ä¸ºå“åº”å¯¹è±¡ ä¾èµ–æ³¨å…¥: å¹²å‡€ã€å¯å¤ç”¨çš„é€»è¾‘ FastAPI æœ‰ä¸€ä¸ªè½»é‡ä¸”å¼ºå¤§çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿ, å¯ä»¥è¿›è¡Œæ•°æ®åº“é“¾æ¥ã€èº«ä»½éªŒè¯ä¿¡æ¯æˆ–é…ç½®ä¿¡æ¯ç­‰\nPYTHON æŠ˜å  å¤åˆ¶ from fastapi import Depends def get_db(): db = create_db_session() try: yield db finally: db.close() @app.get(\u0026#34;/items/\u0026#34;) def read_items(db=Depends(get_db)): return db.query(item).all() ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š ä½¿ç”¨Depends, FastAPI ä¼šè´Ÿè´£è°ƒç”¨get_db, å¤„ç†ç”Ÿæˆå™¨ç”Ÿå‘½å‘¨æœŸ, å¹¶å°†ç»“æœæ³¨å…¥åˆ°å‡½æ•°ä¸­\nåŸç”Ÿæ”¯æŒå¼‚æ­¥ (Async) ä¸åŒäºä¸€äº›ååŠ å…¥ async çš„æ¡†æ¶, FastAPI ä¸€å¼€å§‹å°±è®¾è®¡ä¸ºæ”¯æŒ async/await\nPYTHON æŠ˜å  å¤åˆ¶ from fastapi import FastAPI import asyncio app = FastAPI() @app.get(\u0026#34;/hi\u0026#34;) async def greet(): await asyncio.sleep(1) return \u0026#34;Hello? World?\u0026#34; ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š å½“ fastapi æ”¶åˆ° /hi è¿™ä¸ª URL çš„ GET è¯·æ±‚æ—¶ï¼Œä¼šè‡ªåŠ¨è°ƒç”¨ async greet(), æ— éœ€åœ¨ä»»ä½•åœ°æ–¹æ·»åŠ  await\nä½†æ˜¯, å¯¹äºå…¶ä»–çš„ async def å‡½æ•°, è°ƒç”¨çš„æ—¶å€™å¿…é¡»åœ¨å‰é¢åŠ ä¸Š await\nFastAPI ä¼šè¿è¡Œä¸€ä¸ªå¼‚æ­¥äº‹ä»¶å¾ªç¯ï¼Œç”¨äºæ‰§è¡Œå¼‚æ­¥è·¯å¾„å‡½æ•°(async path functions)ï¼ŒåŒæ—¶ä¹Ÿä¼šä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ± æ¥å¤„ç†åŒæ­¥å‡½æ•°(synchronous path functions), è¿™æ ·å°±ä¸éœ€è¦æ‰‹åŠ¨è°ƒç”¨ asyncio.gather() å’Œ asyncio.run() ä¹‹ç±»çš„æ–¹æ³•\nç¤ºä¾‹: CURD API PYTHON æŠ˜å  å¤åˆ¶ from fastapi import FastAPI from pydantic import BaseModel app = FastAPI() class Item(BaseModel): name: str description: str = None price: float tax: float = None @app.post(\u0026#34;/items/\u0026#34;) async def create_item(item: Item): total = item.price + (item.tax or 0) return {\u0026#34;name\u0026#34;: item.name, \u0026#34;total_price\u0026#34;: total} @app.get(\u0026#34;/\u0026#34;) def read_root(): return {\u0026#34;message\u0026#34;: \u0026#34;FastAPI is working!\u0026#34;} ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š è¿è¡Œ\nPLAINTEXT æŠ˜å  å¤åˆ¶ uvicorn main:app --reload ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š è¿˜å¯ä»¥ä½¿ç”¨ Gunicorn éƒ¨ç½²4ä¸ª Uvicorn å¼‚æ­¥æœåŠ¡ PLAINTEXT æŠ˜å  å¤åˆ¶ gunicorn main:app --workers 4 --worker-class \\ uvicorn.workers.UvicornWorker --bind 0.0.0.0:8000 ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š å®é™…ä¸Šä¹Ÿå¯ä»¥ç›´æ¥è¯¶ä½¿ç”¨ uvicorn è¿è¡Œå¤šä¸ªè¿›ç¨‹, ä½†æ˜¯è¿™æ ·æ— æ³•è¿›è¡Œè¿›ç¨‹ç®¡ç†ï¼Œå› æ­¤ä½¿ç”¨ gunicorn çš„æ–¹æ³•ä¸€èˆ¬æ›´å¤šè¢«ä½¿ç”¨ æ€§èƒ½æå‡ å¦‚æœ API è¿”å›å¤§é‡æ•°æ®, ä½¿ç”¨ ORJSON åŠ å¿«åºåˆ—åŒ–é€Ÿåº¦\nPYTHON æŠ˜å  å¤åˆ¶ from fastapi import FastAPI from fastapi.responses import ORJSONResponse app = FastAPI(default_response_class=ORJSONResponse) ç‚¹å‡»å±•å¼€æŸ¥çœ‹æ›´å¤š ","title":"FastAPI çš„å·¥ä½œåŸç†"},{"link":"/zh-cn/posts/blaugust/","text":"ğŸˆ å…«æœˆä½ å¥½! æ˜¯æ—¶å€™å¼€å¯ Blaugust äº†ã€‚\nBlaugust: è®©å†™ä½œæˆä¸ºå¼€å‘è€…çš„ä¹ æƒ¯ ä»Šå¹´æˆ‘å†³å®šå‚ä¸ Blaugust â€”â€” è¿™æ˜¯ä¸€ä¸ªæŒç»­ä¸€ä¸ªæœˆçš„åšå®¢å†™ä½œæŒ‘æˆ˜, é¼“åŠ±å¤§å®¶åœ¨æ•´ä¸ªå…«æœˆåšæŒå†™ä½œ\nå¯¹å¼€å‘è€…æ¥è¯´, å†™åšå®¢ä¸ä»…ä»…æ˜¯åˆ†äº«, æ›´æ˜¯æ•´ç†æ€è·¯, è®°å½•ç»éªŒ, æ„å»ºé•¿æœŸå‚è€ƒèµ„æ–™çš„è¿‡ç¨‹\næ‰“ç®—å†™äº›ä»€ä¹ˆ? è¿™ä¸ªæœˆæˆ‘è®¡åˆ’å›´ç»•ä»¥ä¸‹å‡ ä¸ªä¸»é¢˜è¿›è¡Œå†™ä½œ:\næ¯æ—¥å¼€å‘å®è·µï¼šå·¥å…·ä½¿ç”¨, æ—¥å¿—å¤„ç†, é¡¹ç›®ç»“æ„è®¾è®¡ç­‰ Python æŠ€æœ¯ç”Ÿæ€ï¼šFastAPI, Pydantic, LangChain, Pytest ç­‰ AI é¡¹ç›®æ—¥å¿—ï¼šæ„å»º AI Agent å’Œç¼–æ’å·¥ä½œæµçš„è¿‡ç¨‹è®°å½• æ¶æ„ç¬”è®°ï¼šå¼‚æ­¥æ¨¡å¼, å¾®æœåŠ¡, æ•°æ®æµè®¾è®¡ å­¦ä¹ ç¬”è®° \u0026amp; æŠ€æœ¯æ–‡ç« ç¿»è¯‘ï¼šæ·±å…¥æºç åˆ†æä¸ä¼˜è´¨æŠ€æœ¯åšå®¢çš„æ•´ç† ä½†ä¸ä¸€å®šæ¯å¤©å†™ä¸€ç¯‡æ–‡ç« , æœ‰æ—¶å€™ä¼šæå‰å†™å¥½å‡ ç¯‡, ä½†ç›®æ ‡æ˜¯ æ¯å¤©å‘å¸ƒä¸€ç¯‡, å¹¶ä¸“æ³¨äºå†…å®¹çš„ æŒç»­æ€§, å¯å¤ç”¨æ€§å’Œå®é™…ä»·å€¼\nå†™ä½œå¹³å°ä¸ç¯å¢ƒ è¿™ä¸ªåšå®¢ä½¿ç”¨ Hugo + GitHub Pages æ­å»º, é‡‡ç”¨äº† narrow ä¸»é¢˜.\nç”¨ Markdown å†™ä½œç®€å•é«˜æ•ˆ, ç‰ˆæœ¬æ§åˆ¶é€šè¿‡ Git ç®¡ç†.\næ”¯æŒ RSS è®¢é˜… (æ¬¢è¿äº’æ¢åšå®¢é“¾æ¥!)\nå¦‚æœä½ ä¹Ÿåœ¨å†™åšå®¢æˆ–è€…æ­£åœ¨å‚åŠ  Blaugust, æ¬¢è¿ç•™è¨€äº¤æµ ğŸ‘‹ ","title":"Blaugust"}],"tags":[]}