<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Designing and Building REST APIs | Starslayerx&#39; Blog</title>
<meta name="keywords" content="REST">
<meta name="description" content="这篇文章延续之前微服务的内容, 将介绍关于 REST API 的以下几个方面:

REST API 的设计原则
Richardson maturity model (RMM) 如何帮助理解 REST 的优势和设计原则
REST API 中资源(resource)和端点(endpoints)设计的概念

表达性状态转移 representational state transfer (REST) 描述了一种通过网络进行通信的应用程序架构风格.
最初, REST 的概念包含了一组用于设计分布式、可扩展 Web 应用的约束条件.
随着时间推移, 出现了更为细致的协议和规范, 为 REST API 的设计提供了明确的指导方针.
如今, REST 已经成为构建 Web API 的最流行选择.
下面将继续在 CoffeeMesh 项目上, 设计相关订单 API.
What is REST?
REST 由 Roy Fielding 在他的博士论文 &ldquo;Architectural Styles and the Design of Network-based Software Atchitecture&rdquo; (PhD diss. University of California,Irvine,2000,p. 109) 中创造.">
<meta name="author" content="Starslayerx">
<link rel="canonical" href="http://localhost:1313/posts/designing-and-building-rest-apis/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css" integrity="sha256-2jIR5e&#43;Ge/K3X9WmUVz&#43;1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.svg">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon.svg">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon.svg">
<link rel="apple-touch-icon" href="http://localhost:1313/favicon.svg">
<link rel="mask-icon" href="http://localhost:1313/favicon.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/designing-and-building-rest-apis/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="http://localhost:1313/posts/designing-and-building-rest-apis/">
  <meta property="og:site_name" content="Starslayerx&#39; Blog">
  <meta property="og:title" content="Designing and Building REST APIs">
  <meta property="og:description" content="这篇文章延续之前微服务的内容, 将介绍关于 REST API 的以下几个方面:
REST API 的设计原则 Richardson maturity model (RMM) 如何帮助理解 REST 的优势和设计原则 REST API 中资源(resource)和端点(endpoints)设计的概念 表达性状态转移 representational state transfer (REST) 描述了一种通过网络进行通信的应用程序架构风格. 最初, REST 的概念包含了一组用于设计分布式、可扩展 Web 应用的约束条件. 随着时间推移, 出现了更为细致的协议和规范, 为 REST API 的设计提供了明确的指导方针. 如今, REST 已经成为构建 Web API 的最流行选择.
下面将继续在 CoffeeMesh 项目上, 设计相关订单 API.
What is REST? REST 由 Roy Fielding 在他的博士论文 “Architectural Styles and the Design of Network-based Software Atchitecture” (PhD diss. University of California,Irvine,2000,p. 109) 中创造.">
  <meta property="og:locale" content="en-US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-08-17T08:00:00+08:00">
    <meta property="article:modified_time" content="2025-08-17T08:00:00+08:00">
    <meta property="article:tag" content="REST">
      <meta property="og:image" content="http://localhost:1313/images/og-default.avif">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/images/og-default.avif">
<meta name="twitter:title" content="Designing and Building REST APIs">
<meta name="twitter:description" content="这篇文章延续之前微服务的内容, 将介绍关于 REST API 的以下几个方面:

REST API 的设计原则
Richardson maturity model (RMM) 如何帮助理解 REST 的优势和设计原则
REST API 中资源(resource)和端点(endpoints)设计的概念

表达性状态转移 representational state transfer (REST) 描述了一种通过网络进行通信的应用程序架构风格.
最初, REST 的概念包含了一组用于设计分布式、可扩展 Web 应用的约束条件.
随着时间推移, 出现了更为细致的协议和规范, 为 REST API 的设计提供了明确的指导方针.
如今, REST 已经成为构建 Web API 的最流行选择.
下面将继续在 CoffeeMesh 项目上, 设计相关订单 API.
What is REST?
REST 由 Roy Fielding 在他的博士论文 &ldquo;Architectural Styles and the Design of Network-based Software Atchitecture&rdquo; (PhD diss. University of California,Irvine,2000,p. 109) 中创造.">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Designing and Building REST APIs",
      "item": "http://localhost:1313/posts/designing-and-building-rest-apis/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Designing and Building REST APIs",
  "name": "Designing and Building REST APIs",
  "description": "这篇文章延续之前微服务的内容, 将介绍关于 REST API 的以下几个方面:\nREST API 的设计原则 Richardson maturity model (RMM) 如何帮助理解 REST 的优势和设计原则 REST API 中资源(resource)和端点(endpoints)设计的概念 表达性状态转移 representational state transfer (REST) 描述了一种通过网络进行通信的应用程序架构风格. 最初, REST 的概念包含了一组用于设计分布式、可扩展 Web 应用的约束条件. 随着时间推移, 出现了更为细致的协议和规范, 为 REST API 的设计提供了明确的指导方针. 如今, REST 已经成为构建 Web API 的最流行选择.\n下面将继续在 CoffeeMesh 项目上, 设计相关订单 API.\nWhat is REST? REST 由 Roy Fielding 在他的博士论文 \u0026ldquo;Architectural Styles and the Design of Network-based Software Atchitecture\u0026rdquo; (PhD diss. University of California,Irvine,2000,p. 109) 中创造.\n",
  "keywords": [
    "REST"
  ],
  "articleBody": "这篇文章延续之前微服务的内容, 将介绍关于 REST API 的以下几个方面:\nREST API 的设计原则 Richardson maturity model (RMM) 如何帮助理解 REST 的优势和设计原则 REST API 中资源(resource)和端点(endpoints)设计的概念 表达性状态转移 representational state transfer (REST) 描述了一种通过网络进行通信的应用程序架构风格. 最初, REST 的概念包含了一组用于设计分布式、可扩展 Web 应用的约束条件. 随着时间推移, 出现了更为细致的协议和规范, 为 REST API 的设计提供了明确的指导方针. 如今, REST 已经成为构建 Web API 的最流行选择.\n下面将继续在 CoffeeMesh 项目上, 设计相关订单 API.\nWhat is REST? REST 由 Roy Fielding 在他的博士论文 “Architectural Styles and the Design of Network-based Software Atchitecture” (PhD diss. University of California,Irvine,2000,p. 109) 中创造.\n定义: REST 是一个松耦合和高伸缩的 API 架构风格. REST APIs 以资源为核心来组织, 这些资源是可以通过 API 操作的实体.\n资源 resource 是可以通过唯一的 URL 来标识的实体, 有两种类型: 集和 collections 和 单体 singletons. 单体标识一个单独的实体, 而集和标识一组实体.\n例如, 在 CoffeeMesh 的订单服务负责管理订单, 通过 /orders/{order_id} 访问特定订单, 是一个单体端点(singleton endpoint); 而所有订单通过 /orders 获取, 是一个集和端点 (collection endpoint).\n某些资源还可以嵌套进其他资源中, 例如一个订单的 payload 中, 可能包含一个嵌套数组列出该订单的多个商品 , 例如下面这样:\n{ \"id\": \"924721eb-a1a1-4f13-b384-37e89c0e0875\", \"status\": \"progress\", \"created\": \"2023-09-01\", \"order\": [ { \"product\": \"cappuccino\", \"size\": \"small\", \"quantity\": 1 }, { \"product\": \"croissant\", \"size\": \"medium\", \"quantity\": 2 } ] } 可以创建一个嵌套端点来表示嵌套资源, 例如通过 GET /orders/{order_id}/status 端点查询订单的状态和细节信息. 当资源对应的负载 payload 较大时, 使用嵌套端点是一种常见的优化策略, 例如只想知道状态信息, 就不需要查询大量的详细数据了, status 端点返回信息如下:\n{ \"status\": \"processing\" } Architectural constraints of REST applications 这里解释 REST 应用的架构约束, 这些约束由 Fielding 列出, 用于规定服务器应如何处理并响应客户端请求. 下面是每个约束的简单描述:\nClient-server architecture 客户端-服务器架构: 用户界面必须与后端解耦 decoupled Statelessness 无状态性: 服务器不能在请求之间维护状态 Cacheability 可缓存性: 返回相同内容的请求, 应支持缓存 Layered system 分层系统: API 按层架构, 但要向用户隐藏复杂性 Code on demand 按需代码: 服务器可以按需将代码注入到用户界面 Uniform interferace 统一接口: API 必须提供一致的接口来访问和操作资源 Separation of concers: The client-server architecture principle 关注点分离: 客户端-服务器架构原则\nREST 依赖于关注点分离原则, 因此要求用户界面(UI)必须于数据存储和服务器逻辑解耦. 这样一来, 服务器组件就可以独立于 UI 元素进行开发. 一种常见的实现方法是: 将 UI 构建为一个独立应用, 例如单页应用(SPA)\nMake it scalable: The statelessness principle 可扩展性: 无状态原则\n在 REST 中, 每一次对服务器的请求都必须包含处理该请求的全部信息. 特别是, 服务器不能在请求之间保持状态. 将状态管理从服务器组件中移除, 可以更容易地对后端进行水平扩展, 这使得我们能够部署多个服务器示例, 并且由于这些实例都不管理 API 客户端的状态, 客户端就可以于任意一个实例进行通信.\nOptimize for performance: The cacheability principle 性能优化: 可缓存原则\n在适用的情况下, 服务器必须是可缓存的. 缓存提升 API 的性能, 这意味着不必一次又一次地执行生成响应所需要的计算. GET 请求适合缓存, 因为他们返回的是服务器中已保存的数据. 通过缓存 GET 请求, 可以避免在用户每次请求相同信息时都从数据源重新获取数据, 生成 GET 请求响应所需要的时间越长, 缓存所带来的收益就越大.\nMake it simple for the client: The layered system principle 让客户端更简单: 分层系统原则\n在 REST 架构中, 客户端必须通过一个唯一的入口访问 API, 而且不应该知道自己是直接连接到最终服务器, 还是连接到某个中间层(例如负载均衡器). 可以把服务端的应用的不同组件部署在不同的服务器上, 或者把相同的组件部署在多个服务器上, 以实现冗余和壳扩展性. 但这些复杂性必须对用户隐藏, 只暴露一个统一的入口来封装服务访问.\nExtendable interferaces: The code-on-demand principle 可扩展接口: 按需代码原则\n服务器可以通过直接从后端发送可执行代码, 来扩展客户端应用的功能. 这个约束是可选的, 只适用于后端提供客户端界面的应用.\nKeep it consistent: The uniform interface principle 保持统一性: 统一接口原则\nREST 应用必须向其使用者提供统一且一直的接口, 接口必须有文档说明, 服务器和客户端必须严格遵循 API 规范. 每个资源通过统一资源标识符(URI)来标识, 每个 URI 必须唯一, 并且始终返回相同的资源. 资源必须使用某种序列化方法表示, 并且这种方法在整个 API 中应保持一致. 如今, REST API 通常使用 JSON 作为序列化格式, 但也可以使用其他格式, 例如 XML.\nHypermedia as the engine of application state 超媒介作为应用状态引擎 (HATEOAS)\n在 2008 年发表的一篇题为REST APIs Must Be Hypertext-Driven的文章中, Fielding 提出:\nREST API 的响应必须包含相关链接, 以便客户端可以通过这些链接导航 API\nHATEOAS 是 REST API 设计中的一种范式(paradigm), 它强调可发现性. 每当客户端向服务器请求某个资源时, 响应必须包含指向该资源的相关链接列表. 例如, 客户端请求订单详情时, 响应必须包含取消订单和支付订单的相关链接.\n例如下面这样\n{ \"id\": 8, \"status\": \"progress\", \"created\": \"2025-8-16\", \"order\": [ { \"product\": \"cappuccino\", \"size\": \"small\", \"quantity\": 1 }, { \"product\": \"croissant\", \"size\": \"medium\", \"quantity\": 2 } ], \"links\": [ { \"href\": \"/orders/8/cancel\", \"description\": \"Cancels the order\", \"type\": \"POST\" }, { \"href\": \"/orders/8/pay\", \"description\": \"Pays for the order\", \"type\": \"POST\" } ] } 提供关联链接可以使 API 具有可导航性, 更易于使用, 因为每个资源都会附带与之交互所需的所有 URL. 然而在实际中, 许多 API 并没有这样实现, 原因包括:\n超链接提供的信息在 API 文档中已经可用 实际上, OpenAPI 规范中包含的信息比单独为特定资源提供的相关链接列表要丰富和结构化得多 不总是清楚应该返回哪些链接 不同用户拥有不同的权限和角色, 可以执行不同操作和访问不同资源 例如，CoffeeMesh API 的外部用户可以使用 POST /orders 下单, 也可以使用 GET /orders/{order_id} 查询订单详情, 但不能使用 DELETE /orders/{order_id} 删除订单, 因为该接口仅限内部用户 如果 HATEOAS 的目标是让 API 可以从单一入口导航, 那么向外部用户返回他们无法使用的 DELETE 链接显然没有意义 因此, 需要根据用户权限返回不同的相关链接列表, 但这会增加 API 设计和实现的复杂性, 并将授权层与 API 层耦合 资源状态可能限制某些操作 例如, POST /orders/1234/cancel 只能在活跃订单上调用, 而无法对已取消订单调用 这种不确定性会增加遵循 HATEOAS 原则的接口设计和实现难度 响应负载可能过大 在一些 API 中, 相关链接列表可能非常庞大, 使响应体变大, 从而影响 API 性能, 以及对网络连接较差的小设备的可靠性 在设计自己的 API 时, 可以根据实际情况决定是否遵循 HATEOAS 原则, 在某些情况下是有用的, 例如:\n在 Wiki 应用中, 响应中的 “linked resources” 部分可以列出\n与某篇文章相关的内容 该文章的多语言版本链接 可以对文章执行的操作链接 总体来说, 需要在 API 文档已经清晰详细提供信息 与 通过响应辅助客户端交互 之间找到平衡\n面向公众的 API: 客户端会从关联链接中受益 小型内部 API: 通常不需要提供关联链接 Analyzing the matruity of an API with the Richardson maturity model 使用 Richardson 成熟度模型分析 API 的成熟度\n这是由 Leonard Richardson 提出的一种思维模型, 用于帮助评估一个 API 在多大程度上遵循了 REST 原则, Richardson 成熟度模型将 API 的\"成熟度\"划分为四个等级: 0. Level 0: RPC over HTTP\nLevel 1: Resources Level 2: HTTP methods and status codes Level 3: Hypermedia controls (HATEOAS) Glory of REST! Level 0: Web APIs à la RPC 类似 PRC 的 Web API\n在0级中, HTTP 本质上只作为一种传输系统, 用于承载与服务器的交互. 在这种情况下, API 的概念更接近 远程过程调用(remote procedure call, RPC). 所有服务器的请求都在同一个端点发起, 并使用相同的 HTTP 方法, 客户端请求的具体细节通过 HTTP 的 payload 传递.\n例如, 在 CoffeeMesh 网站下单时, 客户端可能会向通用 /api 端点发送如下 POST 请求:\n{ \"action\": \"placeOrder\", \"order\": [ { \"product\": \"mocha\", \"size\": \"medium\", \"quantity\": 2 } ] } 服务器通常会返回200状态码, 并附带一个 payload, 告诉请求处理结果.\n类似地, 要获取某个订单的详情, 客户端也可能向通用 /api 端点发送如下 POST 请求:\n{ \"action\": \"getOrder\", \"order\": [ { \"id\": 8 } ] } Level 1: Intorducing the concept of resource 第1级引入了资源 URL 的概念, 服务器不再使用通用的 /api 端点, 而是暴露表示资源的 URL. 例如:\n/orders 表示订单集和 /order/{order_id} 表示单个订单 要下单时, 客户端向 /orders 端点发送 POST 请求, payload 与 0 级类似\n{ \"action\": \"placeOrder\", \"order\": [ { \"product\": \"mocha\", \"size\": \"medium\", \"quantity\": 2 } ] } 在这一层, API 还没有使用不同的 HTTP 方法来区分不同操作\nLevel 2: Using HTTP methods and status codes 第2级引入了 HTTP 请求方法verbs 和 状态码status 的概念, 这一层, HTTP verbs 用于表示具体操作. 例如, 要下订单, 客户端向 /orders 端点发送一个 POST 请求, 内容如下:\n{ \"order\": [ { \"product\": \"mocha\", \"size\": \"medium\", \"quantity\": 2 } ] } 在这个例子中, HTTP 方法 POST 表示要执行的操作, 而请求体仅包含想要下的订单的具体信息\n类似地, 如果要获取某个订单的详细信息, 我们会向该订单的 URI 发送 GET 请求: /orders/{order_id}. 这里使用 GET 告诉服务器, 希望获取 URI 指定资源的详细信息\n前几个级别的响应通常都使用相同的状态码(通常为 200), 而第二级引入了 HTTP 状态码的语义化使用, 用来报告客户端请求处理的结果. 例如:\n使用 POST 创建资源时, 服务器会返回 201 Created 状态码 请求不存在的资源时, 会返回 404 Not Found 状态码 Level 3: API discoverability 第3级引入了可发现性的概念, 通过 HATEOAS 原则, 并在响应中添加表示可对资源执行操作的链接来实现.\n例如, 对 /orders/{order_id} 端点发送 GET 请求, 会返回该订单的表示(representation), 并包含一系列相关链接\n{ \"id\": 8, \"status\": \"progress\", \"created\": \"2023-09-01\", \"order\": [ { \"product\": \"cappuccino\", \"size\": \"small\", \"quantity\": 1 }, { \"product\": \"croissant\", \"size\": \"medium\", \"quantity\": 2 } ], \"links\": [ { \"href\": \"/orders/8/cancel\", \"description\": \"Cancels the order\", \"type\": \"POST\" }, { \"href\": \"/orders/8/pay\", \"description\": \"Pays for the order\", \"type\": \"GET\" } ] } 在 Richardson 成熟度模型中, 第三级代表了他所称的 “REST 的荣耀(Glory of REST)” 的最后一步\n该模型为我们提供了一个框架, 用来思考 API 设计在 REST 原则体系中的位置. 它的目的不是衡量 API 在多大程度上\"符合\"REST 原则, 也不是评估 API 设计的质量; 而是帮助我们思考如何充分利用 HTTP 协议, 创建表达力强、易理解、易使用的 API.\n",
  "wordCount" : "878",
  "inLanguage": "en",
  "image": "http://localhost:1313/images/og-default.avif","datePublished": "2025-08-17T08:00:00+08:00",
  "dateModified": "2025-08-17T08:00:00+08:00",
  "author":{
    "@type": "Person",
    "name": "Starslayerx"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/designing-and-building-rest-apis/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Starslayerx' Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.svg"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Starslayerx&#39; Blog (Alt + H)">
                <img src="http://localhost:1313/favicon.svg" alt="" aria-label="logo"
                    height="35">Starslayerx&#39; Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                    <ul class="lang-switch"><li>|</li>
                        <li>
                            <a href="http://localhost:1313/zh-cn/" title="简体中文"
                                aria-label="简体中文">Zh-Cn</a>
                        </li>
                    </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Designing and Building REST APIs
    </h1>
    <div class="post-meta"><span title='2025-08-17 08:00:00 +0800 CST'>August 17, 2025</span>&nbsp;·&nbsp;<span>5 min</span>&nbsp;·&nbsp;<span>878 words</span>&nbsp;·&nbsp;<span>Starslayerx</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#what-is-rest">What is REST?</a>
      <ul>
        <li><a href="#architectural-constraints-of-rest-applications">Architectural constraints of REST applications</a>
          <ul>
            <li><a href="#separation-of-concers-the-client-server-architecture-principle">Separation of concers: The client-server architecture principle</a></li>
            <li><a href="#make-it-scalable-the-statelessness-principle">Make it scalable: The statelessness principle</a></li>
            <li><a href="#optimize-for-performance-the-cacheability-principle">Optimize for performance: The cacheability principle</a></li>
            <li><a href="#make-it-simple-for-the-client-the-layered-system-principle">Make it simple for the client: The layered system principle</a></li>
            <li><a href="#extendable-interferaces-the-code-on-demand-principle">Extendable interferaces: The code-on-demand principle</a></li>
            <li><a href="#keep-it-consistent-the-uniform-interface-principle">Keep it consistent: The uniform interface principle</a></li>
          </ul>
        </li>
      </ul>
    </li>
    <li><a href="#hypermedia-as-the-engine-of-application-state">Hypermedia as the engine of application state</a></li>
    <li><a href="#analyzing-the-matruity-of-an-api-with-the-richardson-maturity-model">Analyzing the matruity of an API with the Richardson maturity model</a>
      <ul>
        <li><a href="#level-0-web-apis-à-la-rpc">Level 0: Web APIs à la RPC</a></li>
        <li><a href="#level-1-intorducing-the-concept-of-resource">Level 1: Intorducing the concept of resource</a></li>
        <li><a href="#level-2-using-http-methods-and-status-codes">Level 2: Using HTTP methods and status codes</a></li>
        <li><a href="#level-3-api-discoverability">Level 3: API discoverability</a></li>
      </ul>
    </li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>这篇文章延续之前微服务的内容, 将介绍关于 REST API 的以下几个方面:</p>
<ul>
<li>REST API 的设计原则</li>
<li>Richardson maturity model (RMM) 如何帮助理解 REST 的优势和设计原则</li>
<li>REST API 中资源(resource)和端点(endpoints)设计的概念</li>
</ul>
<p>表达性状态转移 representational state transfer (REST) 描述了一种通过网络进行通信的应用程序架构风格.
最初, REST 的概念包含了一组用于设计分布式、可扩展 Web 应用的约束条件.
随着时间推移, 出现了更为细致的协议和规范, 为 REST API 的设计提供了明确的指导方针.
如今, REST 已经成为构建 Web API 的最流行选择.</p>
<p>下面将继续在 CoffeeMesh 项目上, 设计相关订单 API.</p>
<h2 id="what-is-rest">What is REST?<a hidden class="anchor" aria-hidden="true" href="#what-is-rest">#</a></h2>
<p>REST 由 Roy Fielding 在他的博士论文 &ldquo;Architectural Styles and the Design of Network-based Software Atchitecture&rdquo; (PhD diss. University of California,Irvine,2000,p. 109) 中创造.</p>
<blockquote>
<p>定义: REST 是一个松耦合和高伸缩的 API 架构风格. REST APIs 以资源为核心来组织, 这些资源是可以通过 API 操作的实体.</p>
</blockquote>
<p>资源 resource 是可以通过唯一的 URL 来标识的实体, 有两种类型: 集和 collections 和 单体 singletons.
单体标识一个单独的实体, 而集和标识一组实体.</p>
<p>例如, 在 CoffeeMesh 的订单服务负责管理订单, 通过 <code>/orders/{order_id}</code> 访问特定订单, 是一个单体端点(singleton endpoint); 而所有订单通过 <code>/orders</code> 获取, 是一个集和端点 (collection endpoint).</p>
<p>某些资源还可以嵌套进其他资源中, 例如一个订单的 payload 中, 可能包含一个嵌套数组列出该订单的多个商品
, 例如下面这样:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-JSON" data-lang="JSON"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="s2">&#34;924721eb-a1a1-4f13-b384-37e89c0e0875&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;progress&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;created&#34;</span><span class="p">:</span> <span class="s2">&#34;2023-09-01&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;order&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;product&#34;</span><span class="p">:</span> <span class="s2">&#34;cappuccino&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="s2">&#34;small&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;product&#34;</span><span class="p">:</span> <span class="s2">&#34;croissant&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="s2">&#34;medium&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>可以创建一个嵌套端点来表示嵌套资源, 例如通过 GET <code>/orders/{order_id}/status</code> 端点查询订单的状态和细节信息.
当资源对应的负载 payload 较大时, 使用嵌套端点是一种常见的优化策略, 例如只想知道状态信息, 就不需要查询大量的详细数据了, status 端点返回信息如下:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-JSON" data-lang="JSON"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;processing&#34;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="architectural-constraints-of-rest-applications">Architectural constraints of REST applications<a hidden class="anchor" aria-hidden="true" href="#architectural-constraints-of-rest-applications">#</a></h3>
<p>这里解释 REST 应用的架构约束, 这些约束由 Fielding 列出, 用于规定服务器应如何处理并响应客户端请求.
下面是每个约束的简单描述:</p>
<ul>
<li>Client-server architecture 客户端-服务器架构: 用户界面必须与后端解耦 decoupled</li>
<li>Statelessness 无状态性: 服务器不能在请求之间维护状态</li>
<li>Cacheability 可缓存性: 返回相同内容的请求, 应支持缓存</li>
<li>Layered system 分层系统: API 按层架构, 但要向用户隐藏复杂性</li>
<li>Code on demand 按需代码: 服务器可以按需将代码注入到用户界面</li>
<li>Uniform interferace 统一接口: API 必须提供一致的接口来访问和操作资源</li>
</ul>
<h4 id="separation-of-concers-the-client-server-architecture-principle">Separation of concers: The client-server architecture principle<a hidden class="anchor" aria-hidden="true" href="#separation-of-concers-the-client-server-architecture-principle">#</a></h4>
<p>关注点分离: 客户端-服务器架构原则</p>
<p>REST 依赖于关注点分离原则, 因此要求用户界面(UI)必须于数据存储和服务器逻辑解耦.
这样一来, 服务器组件就可以独立于 UI 元素进行开发.
一种常见的实现方法是: 将 UI 构建为一个独立应用, 例如单页应用(SPA)</p>
<h4 id="make-it-scalable-the-statelessness-principle">Make it scalable: The statelessness principle<a hidden class="anchor" aria-hidden="true" href="#make-it-scalable-the-statelessness-principle">#</a></h4>
<p>可扩展性: 无状态原则</p>
<p>在 REST 中, 每一次对服务器的请求都必须包含处理该请求的全部信息.
特别是, 服务器不能在请求之间保持状态. 将状态管理从服务器组件中移除, 可以更容易地对后端进行水平扩展, 这使得我们能够部署多个服务器示例, 并且由于这些实例都不管理 API 客户端的状态, 客户端就可以于任意一个实例进行通信.</p>
<h4 id="optimize-for-performance-the-cacheability-principle">Optimize for performance: The cacheability principle<a hidden class="anchor" aria-hidden="true" href="#optimize-for-performance-the-cacheability-principle">#</a></h4>
<p>性能优化: 可缓存原则</p>
<p>在适用的情况下, 服务器必须是可缓存的. 缓存提升 API 的性能, 这意味着不必一次又一次地执行生成响应所需要的计算. GET 请求适合缓存, 因为他们返回的是服务器中已保存的数据. 通过缓存 GET 请求, 可以避免在用户每次请求相同信息时都从数据源重新获取数据, 生成 GET 请求响应所需要的时间越长, 缓存所带来的收益就越大.</p>
<h4 id="make-it-simple-for-the-client-the-layered-system-principle">Make it simple for the client: The layered system principle<a hidden class="anchor" aria-hidden="true" href="#make-it-simple-for-the-client-the-layered-system-principle">#</a></h4>
<p>让客户端更简单: 分层系统原则</p>
<p>在 REST 架构中, 客户端必须通过一个唯一的入口访问 API, 而且不应该知道自己是直接连接到最终服务器, 还是连接到某个中间层(例如负载均衡器). 可以把服务端的应用的不同组件部署在不同的服务器上, 或者把相同的组件部署在多个服务器上, 以实现冗余和壳扩展性. 但这些复杂性必须对用户隐藏, 只暴露一个统一的入口来封装服务访问.</p>
<h4 id="extendable-interferaces-the-code-on-demand-principle">Extendable interferaces: The code-on-demand principle<a hidden class="anchor" aria-hidden="true" href="#extendable-interferaces-the-code-on-demand-principle">#</a></h4>
<p>可扩展接口: 按需代码原则</p>
<p>服务器可以通过直接从后端发送可执行代码, 来扩展客户端应用的功能. 这个约束是可选的, 只适用于后端提供客户端界面的应用.</p>
<h4 id="keep-it-consistent-the-uniform-interface-principle">Keep it consistent: The uniform interface principle<a hidden class="anchor" aria-hidden="true" href="#keep-it-consistent-the-uniform-interface-principle">#</a></h4>
<p>保持统一性: 统一接口原则</p>
<p>REST 应用必须向其使用者提供统一且一直的接口, 接口必须有文档说明, 服务器和客户端必须严格遵循 API 规范. 每个资源通过统一资源标识符(URI)来标识, 每个 URI 必须唯一, 并且始终返回相同的资源. 资源必须使用某种序列化方法表示, 并且这种方法在整个 API 中应保持一致. 如今, REST API 通常使用 JSON 作为序列化格式, 但也可以使用其他格式, 例如 XML.</p>
<h2 id="hypermedia-as-the-engine-of-application-state">Hypermedia as the engine of application state<a hidden class="anchor" aria-hidden="true" href="#hypermedia-as-the-engine-of-application-state">#</a></h2>
<p>超媒介作为应用状态引擎 (HATEOAS)</p>
<p>在 2008 年发表的一篇题为<a href="https://roy.gbiv.com/untangled/2008/rest-apis-must-be-hypertext-driven">REST APIs Must Be Hypertext-Driven</a>的文章中, Fielding 提出:</p>
<blockquote>
<p>REST API 的响应必须包含相关链接, 以便客户端可以通过这些链接导航 API</p>
</blockquote>
<p>HATEOAS 是 REST API 设计中的一种范式(paradigm), 它强调可发现性. 每当客户端向服务器请求某个资源时, 响应必须包含指向该资源的相关链接列表. 例如, 客户端请求订单详情时, 响应必须包含取消订单和支付订单的相关链接.</p>
<p>例如下面这样</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-JSON" data-lang="JSON"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;progress&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;created&#34;</span><span class="p">:</span> <span class="s2">&#34;2025-8-16&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;order&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;product&#34;</span><span class="p">:</span> <span class="s2">&#34;cappuccino&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="s2">&#34;small&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;product&#34;</span><span class="p">:</span> <span class="s2">&#34;croissant&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="s2">&#34;medium&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">],</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&#34;links&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;/orders/8/cancel&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Cancels the order&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;POST&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="p">},</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;/orders/8/pay&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Pays for the order&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;POST&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>提供关联链接可以使 API 具有可导航性, 更易于使用, 因为每个资源都会附带与之交互所需的所有 URL.
然而在实际中, 许多 API 并没有这样实现, 原因包括:</p>
<ul>
<li>超链接提供的信息在 API 文档中已经可用
<ul>
<li>实际上, OpenAPI 规范中包含的信息比单独为特定资源提供的相关链接列表要丰富和结构化得多</li>
</ul>
</li>
<li>不总是清楚应该返回哪些链接
<ul>
<li>不同用户拥有不同的权限和角色, 可以执行不同操作和访问不同资源</li>
<li>例如，CoffeeMesh API 的外部用户可以使用 <code>POST /orders</code> 下单, 也可以使用 <code>GET /orders/{order_id}</code> 查询订单详情, 但不能使用 <code>DELETE /orders/{order_id}</code> 删除订单, 因为该接口仅限内部用户</li>
<li>如果 HATEOAS 的目标是让 API 可以从单一入口导航, 那么向外部用户返回他们无法使用的 DELETE 链接显然没有意义</li>
<li>因此, 需要根据用户权限返回不同的相关链接列表, 但这会增加 API 设计和实现的复杂性, 并将授权层与 API 层耦合</li>
</ul>
</li>
<li>资源状态可能限制某些操作
<ul>
<li>例如, <code>POST /orders/1234/cancel</code> 只能在活跃订单上调用, 而无法对已取消订单调用</li>
<li>这种不确定性会增加遵循 HATEOAS 原则的接口设计和实现难度</li>
</ul>
</li>
<li>响应负载可能过大
<ul>
<li>在一些 API 中, 相关链接列表可能非常庞大, 使响应体变大, 从而影响 API 性能, 以及对网络连接较差的小设备的可靠性</li>
</ul>
</li>
</ul>
<p>在设计自己的 API 时, 可以根据实际情况决定是否遵循 HATEOAS 原则, 在某些情况下是有用的, 例如:</p>
<p>在 Wiki 应用中, 响应中的 &ldquo;linked resources&rdquo; 部分可以列出</p>
<ul>
<li>与某篇文章相关的内容</li>
<li>该文章的多语言版本链接</li>
<li>可以对文章执行的操作链接</li>
</ul>
<p>总体来说, 需要在 API 文档已经清晰详细提供信息 与 通过响应辅助客户端交互 之间找到平衡</p>
<ul>
<li>面向公众的 API: 客户端会从关联链接中受益</li>
<li>小型内部 API: 通常不需要提供关联链接</li>
</ul>
<h2 id="analyzing-the-matruity-of-an-api-with-the-richardson-maturity-model">Analyzing the matruity of an API with the Richardson maturity model<a hidden class="anchor" aria-hidden="true" href="#analyzing-the-matruity-of-an-api-with-the-richardson-maturity-model">#</a></h2>
<p>使用 Richardson 成熟度模型分析 API 的成熟度</p>
<p>这是由 Leonard Richardson 提出的一种思维模型, 用于帮助评估一个 API 在多大程度上遵循了 REST 原则, Richardson 成熟度模型将 API 的&quot;成熟度&quot;划分为四个等级: 0. Level 0: RPC over HTTP</p>
<ol>
<li>Level 1: Resources</li>
<li>Level 2: HTTP methods and status codes</li>
<li>Level 3: Hypermedia controls (HATEOAS)</li>
</ol>
<ul>
<li>Glory of REST!</li>
</ul>
<h3 id="level-0-web-apis-à-la-rpc">Level 0: Web APIs à la RPC<a hidden class="anchor" aria-hidden="true" href="#level-0-web-apis-à-la-rpc">#</a></h3>
<p>类似 PRC 的 Web API</p>
<p>在0级中, HTTP 本质上只作为一种传输系统, 用于承载与服务器的交互. 在这种情况下, API 的概念更接近 远程过程调用(remote procedure call, RPC). 所有服务器的请求都在同一个端点发起, 并使用相同的 HTTP 方法, 客户端请求的具体细节通过 HTTP 的 payload 传递.</p>
<p>例如, 在 CoffeeMesh 网站下单时, 客户端可能会向通用 <code>/api</code> 端点发送如下 POST 请求:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-JSON" data-lang="JSON"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="s2">&#34;placeOrder&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;order&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;product&#34;</span><span class="p">:</span> <span class="s2">&#34;mocha&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="s2">&#34;medium&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>服务器通常会返回200状态码, 并附带一个 payload, 告诉请求处理结果.</p>
<p>类似地, 要获取某个订单的详情, 客户端也可能向通用 <code>/api</code> 端点发送如下 POST 请求:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-JSON" data-lang="JSON"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="s2">&#34;getOrder&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;order&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;id&#34;</span><span class="p">:</span> <span class="mi">8</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><h3 id="level-1-intorducing-the-concept-of-resource">Level 1: Intorducing the concept of resource<a hidden class="anchor" aria-hidden="true" href="#level-1-intorducing-the-concept-of-resource">#</a></h3>
<p>第1级引入了资源 URL 的概念, 服务器不再使用通用的 <code>/api</code> 端点, 而是暴露表示资源的 URL. 例如:</p>
<ul>
<li><code>/orders</code> 表示订单集和</li>
<li><code>/order/{order_id}</code> 表示单个订单</li>
</ul>
<p>要下单时, 客户端向 <code>/orders</code> 端点发送 POST 请求, payload 与 0 级类似</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-JSON" data-lang="JSON"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;action&#34;</span><span class="p">:</span> <span class="s2">&#34;placeOrder&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&#34;order&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;product&#34;</span><span class="p">:</span> <span class="s2">&#34;mocha&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;size&#34;</span><span class="p">:</span> <span class="s2">&#34;medium&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="nt">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>在这一层, API 还没有使用不同的 HTTP 方法来区分不同操作</p>
<h3 id="level-2-using-http-methods-and-status-codes">Level 2: Using HTTP methods and status codes<a hidden class="anchor" aria-hidden="true" href="#level-2-using-http-methods-and-status-codes">#</a></h3>
<p>第2级引入了 HTTP 请求方法verbs 和 状态码status 的概念, 这一层, HTTP verbs 用于表示具体操作.
例如, 要下订单, 客户端向 <code>/orders</code> 端点发送一个 POST 请求, 内容如下:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;order&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;product&#34;</span><span class="p">:</span> <span class="s2">&#34;mocha&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;size&#34;</span><span class="p">:</span> <span class="s2">&#34;medium&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>在这个例子中, HTTP 方法 POST 表示要执行的操作, 而请求体仅包含想要下的订单的具体信息</p>
<p>类似地, 如果要获取某个订单的详细信息, 我们会向该订单的 URI 发送 GET 请求: <code>/orders/{order_id}</code>. 这里使用 GET 告诉服务器, 希望获取 URI 指定资源的详细信息</p>
<p>前几个级别的响应通常都使用相同的状态码(通常为 200), 而第二级引入了 HTTP 状态码的语义化使用, 用来报告客户端请求处理的结果. 例如:</p>
<ul>
<li>使用 POST 创建资源时, 服务器会返回 201 Created 状态码</li>
<li>请求不存在的资源时, 会返回 404 Not Found 状态码</li>
</ul>
<h3 id="level-3-api-discoverability">Level 3: API discoverability<a hidden class="anchor" aria-hidden="true" href="#level-3-api-discoverability">#</a></h3>
<p>第3级引入了可发现性的概念, 通过 HATEOAS 原则, 并在响应中添加表示可对资源执行操作的链接来实现.</p>
<p>例如, 对 <code>/orders/{order_id}</code> 端点发送 GET 请求, 会返回该订单的表示(representation), 并包含一系列相关链接</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;id&#34;</span><span class="p">:</span> <span class="mi">8</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;status&#34;</span><span class="p">:</span> <span class="s2">&#34;progress&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;created&#34;</span><span class="p">:</span> <span class="s2">&#34;2023-09-01&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;order&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;product&#34;</span><span class="p">:</span> <span class="s2">&#34;cappuccino&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;size&#34;</span><span class="p">:</span> <span class="s2">&#34;small&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;product&#34;</span><span class="p">:</span> <span class="s2">&#34;croissant&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;size&#34;</span><span class="p">:</span> <span class="s2">&#34;medium&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;quantity&#34;</span><span class="p">:</span> <span class="mi">2</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">],</span>
</span></span><span class="line"><span class="cl">  <span class="s2">&#34;links&#34;</span><span class="p">:</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;/orders/8/cancel&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Cancels the order&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;POST&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">},</span>
</span></span><span class="line"><span class="cl">      <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;href&#34;</span><span class="p">:</span> <span class="s2">&#34;/orders/8/pay&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;description&#34;</span><span class="p">:</span> <span class="s2">&#34;Pays for the order&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">          <span class="s2">&#34;type&#34;</span><span class="p">:</span> <span class="s2">&#34;GET&#34;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>在 Richardson 成熟度模型中, 第三级代表了他所称的 &ldquo;REST 的荣耀(Glory of REST)&rdquo; 的最后一步</p>
<p>该模型为我们提供了一个框架, 用来思考 API 设计在 REST 原则体系中的位置. 它的目的不是衡量 API 在多大程度上&quot;符合&quot;REST 原则, 也不是评估 API 设计的质量; 而是帮助我们思考如何充分利用 HTTP 协议, 创建表达力强、易理解、易使用的 API.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/rest/">REST</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/ieee-754-introduce/">
    <span class="title">« Prev</span>
    <br>
    <span>IEEE-754 Introduce</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/intorduce-uuid/">
    <span class="title">Next »</span>
    <br>
    <span>Intorduce UUID</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Designing and Building REST APIs on x"
            href="https://x.com/intent/tweet/?text=Designing%20and%20Building%20REST%20APIs&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fdesigning-and-building-rest-apis%2f&amp;hashtags=REST">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Designing and Building REST APIs on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fdesigning-and-building-rest-apis%2f&amp;title=Designing%20and%20Building%20REST%20APIs&amp;summary=Designing%20and%20Building%20REST%20APIs&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fdesigning-and-building-rest-apis%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Designing and Building REST APIs on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fdesigning-and-building-rest-apis%2f&title=Designing%20and%20Building%20REST%20APIs">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Designing and Building REST APIs on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fdesigning-and-building-rest-apis%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Designing and Building REST APIs on whatsapp"
            href="https://api.whatsapp.com/send?text=Designing%20and%20Building%20REST%20APIs%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fdesigning-and-building-rest-apis%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Designing and Building REST APIs on telegram"
            href="https://telegram.me/share/url?text=Designing%20and%20Building%20REST%20APIs&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fdesigning-and-building-rest-apis%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Designing and Building REST APIs on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Designing%20and%20Building%20REST%20APIs&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fdesigning-and-building-rest-apis%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">Starslayerx&#39; Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
