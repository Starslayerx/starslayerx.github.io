<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>CS144 - lab0 | Starslayerx&#39; Blog</title>
<meta name="keywords" content="Netowrk">
<meta name="description" content="CS 144: Introduction to Computer Networking, Fall 2025
本篇文章对应 check0.pdf 的内容
3 Network by hand
3.1 Fetch a Web page
这个介绍怎么发送一个 GET 请求


telent cs144.keithw.org http
该命令告诉 telnet 打开一个可靠字节流(reliable byte stream)，并在我电脑上运行一个 http 服务
预计会收到这样的内容
Trying 104.196.238.229...
Connected to cs144.keithw.org.
Escape character is &#39;^]&#39;.
^]
telnet&gt; close
Connection closed.
该命令不能使用常见的 Ctrl-C 之类方法退出，而是 Ctrl-] 然后输入 close


GET /hello HTTP/1.1
该命令告诉服务器 URL 的 path 部分


Host: cs144.keithw.org
该命令告诉服务器 URL 的 host 部分


Connection: close">
<meta name="author" content="Starslayerx">
<link rel="canonical" href="http://localhost:1313/posts/cs144-lab0/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css" integrity="sha256-2jIR5e&#43;Ge/K3X9WmUVz&#43;1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.svg">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon.svg">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon.svg">
<link rel="apple-touch-icon" href="http://localhost:1313/favicon.svg">
<link rel="mask-icon" href="http://localhost:1313/favicon.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/cs144-lab0/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="http://localhost:1313/posts/cs144-lab0/">
  <meta property="og:site_name" content="Starslayerx&#39; Blog">
  <meta property="og:title" content="CS144 - lab0">
  <meta property="og:description" content="CS 144: Introduction to Computer Networking, Fall 2025
本篇文章对应 check0.pdf 的内容
3 Network by hand 3.1 Fetch a Web page 这个介绍怎么发送一个 GET 请求
telent cs144.keithw.org http
该命令告诉 telnet 打开一个可靠字节流(reliable byte stream)，并在我电脑上运行一个 http 服务
预计会收到这样的内容
Trying 104.196.238.229... Connected to cs144.keithw.org. Escape character is &#39;^]&#39;. ^] telnet&gt; close Connection closed. 该命令不能使用常见的 Ctrl-C 之类方法退出，而是 Ctrl-] 然后输入 close
GET /hello HTTP/1.1
该命令告诉服务器 URL 的 path 部分
Host: cs144.keithw.org
该命令告诉服务器 URL 的 host 部分
Connection: close">
  <meta property="og:locale" content="en-US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2026-01-11T08:00:00+08:00">
    <meta property="article:modified_time" content="2026-01-11T08:00:00+08:00">
    <meta property="article:tag" content="Netowrk">
      <meta property="og:image" content="http://localhost:1313/images/og-default.avif">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/images/og-default.avif">
<meta name="twitter:title" content="CS144 - lab0">
<meta name="twitter:description" content="CS 144: Introduction to Computer Networking, Fall 2025
本篇文章对应 check0.pdf 的内容
3 Network by hand
3.1 Fetch a Web page
这个介绍怎么发送一个 GET 请求


telent cs144.keithw.org http
该命令告诉 telnet 打开一个可靠字节流(reliable byte stream)，并在我电脑上运行一个 http 服务
预计会收到这样的内容
Trying 104.196.238.229...
Connected to cs144.keithw.org.
Escape character is &#39;^]&#39;.
^]
telnet&gt; close
Connection closed.
该命令不能使用常见的 Ctrl-C 之类方法退出，而是 Ctrl-] 然后输入 close


GET /hello HTTP/1.1
该命令告诉服务器 URL 的 path 部分


Host: cs144.keithw.org
该命令告诉服务器 URL 的 host 部分


Connection: close">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "CS144 - lab0",
      "item": "http://localhost:1313/posts/cs144-lab0/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "CS144 - lab0",
  "name": "CS144 - lab0",
  "description": "CS 144: Introduction to Computer Networking, Fall 2025\n本篇文章对应 check0.pdf 的内容\n3 Network by hand 3.1 Fetch a Web page 这个介绍怎么发送一个 GET 请求\ntelent cs144.keithw.org http\n该命令告诉 telnet 打开一个可靠字节流(reliable byte stream)，并在我电脑上运行一个 http 服务\n预计会收到这样的内容\nTrying 104.196.238.229... Connected to cs144.keithw.org. Escape character is \u0026#39;^]\u0026#39;. ^] telnet\u0026gt; close Connection closed. 该命令不能使用常见的 Ctrl-C 之类方法退出，而是 Ctrl-] 然后输入 close\nGET /hello HTTP/1.1\n该命令告诉服务器 URL 的 path 部分\nHost: cs144.keithw.org\n该命令告诉服务器 URL 的 host 部分\nConnection: close\n",
  "keywords": [
    "Netowrk"
  ],
  "articleBody": "CS 144: Introduction to Computer Networking, Fall 2025\n本篇文章对应 check0.pdf 的内容\n3 Network by hand 3.1 Fetch a Web page 这个介绍怎么发送一个 GET 请求\ntelent cs144.keithw.org http\n该命令告诉 telnet 打开一个可靠字节流(reliable byte stream)，并在我电脑上运行一个 http 服务\n预计会收到这样的内容\nTrying 104.196.238.229... Connected to cs144.keithw.org. Escape character is '^]'. ^] telnet\u003e close Connection closed. 该命令不能使用常见的 Ctrl-C 之类方法退出，而是 Ctrl-] 然后输入 close\nGET /hello HTTP/1.1\n该命令告诉服务器 URL 的 path 部分\nHost: cs144.keithw.org\n该命令告诉服务器 URL 的 host 部分\nConnection: close\n该命令告诉服务器这是最后一个 HTTP 请求，服务器在发送完最后一字节的响应数据后应主动关闭 TCP 连接\n再按一次回车，会发送一个空行给服务器，表明发送的 HTTP 请求完成了，这会看到和浏览器一样的响应内容 这不是关闭连接，它只是 HTTP 请求报文语法的结束符\nHTTP/1.1 200 OK Date: Tue, 09 Dec 2025 07:32:01 GMT Server: Apache Last-Modified: Thu, 13 Dec 2018 15:45:29 GMT ETag: \"e-57ce93446cb64\" Accept-Ranges: bytes Content-Length: 14 Connection: close Content-Type: text/plain Hello, CS144! Connection closed by foreign host. Connection: close 属于 HTTP 语义层，告诉服务器：“响应完就关闭连接”\n空行 CRLF 属于 HTTP 报文语法，告诉服务器：“我的请求已经完整，可以开始处理”\n3.2 Send yourself an email 这节介绍怎么通过 SMTP 协议发送邮件\n首先看课程文档里面的步骤：\nssh sunetid@cardinal.stanford.edu 这里要用 Stanford 的学生 id 去登陆\ntelnet 67.231.149.169 smtp\n使用 SMTP (Simple Mail Transfer Protocol) 服务连接到服务器，应该会显示\nTrying 67.231.149.169... Connected to 67.231.149.169. Escape character is '^]'. 220 mx0a-00000d07.pphosted.com ESMTP mfa-m0342459 HELO mycomputer.stanford.edu\n该命令会建立会话，一般后是个域名或者 [IP] 这种形式，也可以自定义字段，但可能会因此被归类为垃圾邮件\n实际上现代的 SMTP 一般都支持 EHLO 扩展命令，这里就不详细说了\n会返回类似下面内容\n250 ... Hello cardinal3.stanford.edu [171.67.24.75], pleased to meet you MAIL FROM: sunetid@stanford.edu\n这里是明确发送方的 email，由于早期互联网是一个信任网络，因此这里可以随便写\n但现在一般服务器都会去检测，如果是乱写的会被拒绝\n返回如下\n250 2.1.0 Sender ok RCPT TO: sunetid@stanford.edu\n这里指定接收人的地址，可以直接指定自己，这样就是自己给自己发邮件\n也可以指定其他任意地址，不过要注意可能会被当成垃圾邮件\n返回内容如下\n250 2.1.5 Recipient ok. DATA\n输入该命令后，下面就是信封的文本内容了，如果正常会看到下面输出：\n354 End data with . 现在需要先写好发件人、收件人、主题\nFrom: sunetid@stanford.edu To: sunetid@stanford.edu Subject: Hello from CS144 Lab 0! This is an email sent via SMTP manually! ... . 这些内容是给人类看的，当然可以随便写，但有些比较严格的服务器会检测这些字段内容。 如果和上面的 MAIL FROM: / RCPT TO: 不一致，可能会被拒收。 我试了下，qq 邮件会拒收，并会收到拒收码；而网易 126 邮箱就可以随便写。\n抱歉，您的信件被退回 尊敬的用户 **@126.com： 您发送到 **@qq.com 的邮件被系统退回，以下是退信相关信息： 因信头from字段拒收邮件 建议解决方案：建议您检查邮件信头是否包含from字段，from字段中的邮箱地址是否正确，是否存在多个from字段等问题，并进行相应调整。您也可以尝试使用网页版邮箱或邮箱大师发送邮件。如果仍然投递失败，请联系收件方协助调整，或通过网易邮件帮助中心进行反馈问题。 ------------------------------- 原邮件信息 ------------------------------- 发送时间：2025-12-09 22:08:36 邮件主题：CS144 - Test Message 收件地址：**@qq.com 服务器返回码： SMTP error, DOT: Host qq.com(157.255.221.253) DOT said 550 The \"From\" header is missing or invalid. Please follow RFC5322, RFC2047, RFC822 standard protocol. [MPaFZkPlT3GZDlVMiasbtU2tOYMzMMEOLjt1R3UrOzI24oWss6B56APQJEAznwCF9Q== IP: ***.***.***.*]. https://service.mail.qq.com/detail/124/995. 在 Subject 后面的邮件正文，必须要隔一行空格才行，否则解析会出错，最后邮件看不到正文信息。\n.\n单行的点代表结束，会收到下面类似返回\n250 2.0.0 33h24dpdsr-1 Message accepted for delivery QUIT\n该命令结束邮件服务器的会话，一般邮件会加入队列，过一会儿才会收到。\n好了，上面介绍的是课程文档里面写的，但由于没有 sunetid，也就无法 ssh 到 Standard 去完成该课程实验，但是可以可以通过 126 邮箱完成。\n注释一个 126 邮箱，去设置里面找到 POP3/SMTP/IMAP 相关项，把服务给打开，然后弄个授权码，等下可以使用这个连接到 126 服务器（QQ 不行）。\n得到授权码后，要对邮件和授权吗进行编码\n% echo -n \"xxx@126.com\" | base64 a********************= % echo -n \"授权码\" | base64 T*********************== 由于现实中都使用 https，因此无法直接使用 telnet 连接，这里使用 openssl\nopenssl s_client -connect smtp.126.com:465 -quiet 然后通过命令 HELO 或 EHLO 后面加任意内容建立连接\n这里使用上面生成的编码进行验证：\nAUTH LOGIN 输入验证登陆命令后，复制上面 邮件编码 回车，再复制 授权码编码 回车，这样就登陆成功了，接下来和前面的内容就一样了！\n下面简单复制粘贴一个示例参考一下\n% openssl s_client -connect smtp.126.com:465 -quiet Connecting to 220.197.33.216 depth=2 C=US, O=DigiCert Inc, OU=www.digicert.com, CN=DigiCert Global Root G2 verify return:1 depth=1 C=US, O=DigiCert, Inc., CN=GeoTrust G2 TLS CN RSA4096 SHA256 2022 CA1 verify return:1 depth=0 C=CN, ST=Zhejiang, L=Hangzhou, O=NetEase (Hangzhou) Network Co., Ltd, CN=*.126.com verify return:1 220 126.com Anti-spam GT for Coremail System (126com[20140526]) HELO macbook.sx 250 OK AUTH LOGIN 334 dXNlcm5hbWU6 a**********************= 334 UGFzc3dvcmQ6 T*********************== 235 Authentication successful MAIL FROM: \u003c**@126.com\u003e 250 Mail OK MAIL TO: \u003c**@126.com\u003e 503 bad sequence of commands RCPT TO: \u003c**@126.com\u003e 250 Mail OK DATA 354 End data with . From: **@126.com To: **@126.com Subject: CS144 Test This is an email sent via SMTP manually! . 250 Mail OK queued as gzga-smtp-mtada-g1-1,_____wD3f1hH6DdpREvXAQ--.30649S2 1765271741 QUIT 221 Bye 00488F0302000000:error:0A000126:SSL routines::unexpected eof while reading:ssl/record/rec_layer_s3.c:701: 00488F0302000000:error:0A000197:SSL routines:SSL_shutdown:shutdown while in init:ssl/ssl_lib.c:2834: 3.3 Listening and Connecting 之前的实验都是通过 telnet 运行的 client 程序，下面来运行一个 server 程序\nnetcat -v -l -p 9090 然后再开一个窗口，连接到该服务器\ntelnet localhost 9090 应该会看到 server 输出 Connection fromlocalhost 53500 received! 这样的内容，在两个窗口里输出任何内容回车，会立刻显示在两个窗口中，在 netcat 窗口按 Ctrl-C 会使两个窗口都被关闭。\n4 Writing a network program using an OS system socket 现代 C++ 编程规则：\n使用文档 https://en.cppreference.com，cplusplus.com 有点过时了 永远不要使用 malloc() 或 free() 永远不要使用 new 或 delete 基本上永远不要使用原始指针 *，只在需要的时候使用智能指针 smart pointers unique_ptr 或 shared_ptr（本课程用不上） 避免 templates、threads、locks 和 virtual functions（本课程不会使用） 避免 C 风格字符串 char *str 或字符串函数 strlen(), strcpy()，这些很容易出错，应该使用 std::string。 永远不要使用 C 风格的类型转换，例如 (FILE *) x，使用 C++ static_cast 使用常量引用传递函数参数，例如 const Address \u0026 address 每个变量都使用 const，除非要修改它 每个对象方法都使用 const，除非要修改它 避免使用全局变量，并给每个变量尽可能小的作用域 提交之前，运行 cmake --build build --target tidy 来获取改进建议，并运行 cmake --build build --target format 来格式化代码 关于使用 Git：\n高频率的最小化提交，并解释修改了什么，以及为什么。\n进行小规模的“语义化”提交有助于调试（如果每次提交都能编译通过，并且提交信息清晰地描述了该次提交所做的一件事，那么调试起来会容易得多）\n为了支持这种编程风格，Minnow 的类将操作系统函数（可通过 C 语言调用）封装在“现代” C++ 中。 并提供了针对 CS 111 课程中可能已广泛熟悉的概念（尤其是套接字和文件描述符）的 C++ 封装类。\n请仔细阅读公共接口部分（位于文件 util/socket.hh 和 util/file_descriptor.hh 中 public: 之后的内容）。 （请注意，Socket 是 FileDescriptor 的一种类型，而 TCPSocket 是 Socket 的一种类型。）\n4.5 Writing webget 现在要实现 webget 程序，一个利用操作系统 TCP 支持及流套接字抽象，来获取网页的程序，就像上那样。\n在 bulid 目录下，打开文件 ../apps/webget.cc\n在 get_URL 函数中，安装文本描述实现简易 Web 客户端，使用前面一样的 HTTP 请求格式。使用 TCPSocket 和 Address 类。\n提示：\n注意在 HTTP 每行必须以 \\r\\n 结尾\n不要忘记在请求中包含 Connection: close，这告诉服务器，在这个请求后不应该继续等待更多信息的发送。\n相反，服务器将发送一个回复，然后立即结束其输出字节流。\n当读取完服务器发送的整个字节流后，套接字会达到 “EOF” 文件结束状态，这意味着传入的字节流已经终止。\n这样客户段就能知道服务器已经完成了回复。\n确保 print 所有来自服务器的输出，直到 sockets 遇到 “EOF” (End Of File)，一次读取调用是不够的。\n期望编写 8 行左右代码\n使用 cmake --build build 编译代码\n使用 ./apps/webget cs144.keithw.org /hello 测试程序。\n对比浏览器中得到的结果，和上面 3.1 节中得到的结果\n当系统运行正常时，执行 cmake --build biuld --target check webget 命令来运行自动化测试。\n在实现 get_URL 函数之前，应该会看到以下输出：\n$ cmake --build build --target check_webget Test project /home/cs144/minnow/build Start 1: compile with bug-checkers 1/2 Test #1: compile with bug-checkers ........ Passed 1.02 sec Start 2: t_webget 2/2 Test #2: t_webget .........................***Failed 0.01 sec DEBUG: Function called: get_URL( \"cs144.keithw.org\", \"/nph-hasher/xyzzy\" ) DEBUG: get_URL() function not yet implemented ERROR: webget returned output that did not match the test's expectations 实现后会看到\n$ cmake --build build --target check_webget Test project /home/cs144/minnow/build Start 1: compile with bug-checkers 1/2 Test #1: compile with bug-checkers ........ Passed 1.09 sec Start 2: t_webget 2/2 Test #2: t_webget ......................... Passed 0.72 sec 100% tests passed, 0 tests failed out of 2 我的实现：\nvoid get_URL( const string\u0026 host, const string\u0026 path ) { // 创建 socket TCPSocket sock; // 连接服务器 sock.connect( Address( host, \"http\" ) ); // 发送数据 sock.write( \"GET \" + path + \" HTTP/1.1\\r\\n\" ); // GET: path HTTP/1.1 sock.write( \"Host: \" + host + \"\\r\\n\" ); // Host: host sock.write( \"Connection: close\\r\\n\\r\\n\" ); // 关闭写端 sock.shutdown( SHUT_WR ); // 读取返回数据 string data; // 判断是结束 while ( !sock.eof() ) { // 存储读取内容到 data sock.read( data ); cout \u003c\u003c data; } } 到 build/ 目录下运行测试命令 ./apps/webget cs144.keithw.org /hello 返回内容：\nHTTP/1.1 200 OK Date: Sat, 10 Jan 2026 16:56:46 GMT Server: Apache Last-Modified: Thu, 13 Dec 2018 15:45:29 GMT ETag: \"e-57ce93446cb64\" Accept-Ranges: bytes Content-Length: 14 Connection: close Content-Type: text/plain Hello, CS144! 对比之前使用 telnet 的返回内容：\nHTTP/1.1 200 OK Date: Sat, 10 Jan 2026 16:00:48 GMT Server: Apache Last-Modified: Thu, 13 Dec 2018 15:45:29 GMT ETag: \"e-57ce93446cb64\" Accept-Ranges: bytes Content-Length: 14 Connection: close Content-Type: text/plain Hello, CS144! Connection closed by foreign host. 运行测试成功通过！\n5 An in-memory reliable byte stream 类/接口 角色/关系 说明 ByteStream 基类 提供共享缓冲区 Writer 继承自 ByteStream 写端，负责写入数据 Reader 继承自 ByteStream 读端，负责读出数据 关键设计：Writer 和 Reader 都继承自 ByteStream，共享同一个缓冲区。所有成员变量应定义在 ByteStream 类的 protected 部分。\nWriter 端（写入） 方法 功能 push(data) 写入数据（不超过可用容量） close() 关闭流 is_closed() 流是否已关闭 available_capacity() 还能写多少字节 bytes_pushed() 累计写入了多少字节 Reader 端（读出） 方法 功能 peek() 查看缓冲区内容（不移除） pop(len) 移除前 len 个字节 is_finished() 流是否结束（已关闭且读完） bytes_buffered() 缓冲区当前有多少字节 bytes_popped() 累计读出了多少字节 类实现代码：\n这里使用 string 作为数据流存储\n// byte_stream.hh class ByteStream { public: explicit ByteStream( uint64_t capacity ); // Helper functions (provided) to access the ByteStream's Reader and Writer interfaces Reader\u0026 reader(); const Reader\u0026 reader() const; Writer\u0026 writer(); const Writer\u0026 writer() const; void set_error() { error_ = true; }; // Signal that the stream suffered an error. bool has_error() const { return error_; }; // Has the stream had an error? protected: // Please add any additional state to the ByteStream here, and not to the Writer and Reader interfaces. uint64_t capacity_; bool error_ {}; bool is_closed_ { false }; // 流刚创建时为未关闭状态 std::string buffer_ {}; // 使用字符串存储数据流 uint64_t bytes_pushed_ {}; uint64_t bytes_popped_ {}; }; 注意流刚创建状态为为关闭。\n具体方法实现代码\nWriter ByteStream::ByteStream( uint64_t capacity ) : capacity_( capacity ) {} // Push data to stream, but only as much as available capacity allows. void Writer::push( string data ) { const uint64_t available = capacity_ - buffer_.size(); // 缓存满了 if ( available == 0 ) { return; } // 对比 剩余空间 和 数据大小 const uint64_t to_write = min( available, data.size() ); // 阶段字符串 data.resize( to_write ); // 拼接缓存结果 buffer_ += data; // 累计写入字节量 bytes_pushed_ += to_write; } // Signal that the stream has reached its ending. Nothing more will be written. void Writer::close() { is_closed_ = true; } // Has the stream been closed? bool Writer::is_closed() const { return is_closed_; } // How many bytes can be pushed to the stream right now? uint64_t Writer::available_capacity() const { return capacity_ - buffer_.size(); } // Total number of bytes cumulatively pushed to the stream uint64_t Writer::bytes_pushed() const { return bytes_pushed_; } Reader // Peek at the next bytes in the buffer -- ideally as many as possible. // It's not required to return a string_view of the *whole* buffer, but // if the peeked string_view is only one byte at a time, it will probably force // the caller to do a lot of extra work. string_view Reader::peek() const { return buffer_; } // Remove `len` bytes from the buffer. void Reader::pop( uint64_t len ) { const uint64_t popped = min( len, buffer_.size() ); buffer_.erase( 0, popped ); bytes_popped_ += popped; } // Is the stream finished (closed and fully popped)? bool Reader::is_finished() const { return is_closed_ \u0026\u0026 buffer_.empty(); } // Number of bytes currently buffered (pushed and not popped) uint64_t Reader::bytes_buffered() const { return buffer_.size(); } // Total number of bytes cumulatively popped from stream uint64_t Reader::bytes_popped() const { return bytes_popped_; } 注意使用的变量尽量使用 const，除非要修改它。\n",
  "wordCount" : "1431",
  "inLanguage": "en",
  "image": "http://localhost:1313/images/og-default.avif","datePublished": "2026-01-11T08:00:00+08:00",
  "dateModified": "2026-01-11T08:00:00+08:00",
  "author":{
    "@type": "Person",
    "name": "Starslayerx"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/cs144-lab0/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Starslayerx' Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.svg"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Starslayerx&#39; Blog (Alt + H)">
                <img src="http://localhost:1313/favicon.svg" alt="" aria-label="logo"
                    height="35">Starslayerx&#39; Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                    <ul class="lang-switch"><li>|</li>
                        <li>
                            <a href="http://localhost:1313/zh-cn/" title="简体中文"
                                aria-label="简体中文">Zh-Cn</a>
                        </li>
                    </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      CS144 - lab0
    </h1>
    <div class="post-meta"><span title='2026-01-11 08:00:00 +0800 CST'>January 11, 2026</span>&nbsp;·&nbsp;<span>7 min</span>&nbsp;·&nbsp;<span>1431 words</span>&nbsp;·&nbsp;<span>Starslayerx</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#3-network-by-hand">3 Network by hand</a>
      <ul>
        <li><a href="#31-fetch-a-web-page">3.1 Fetch a Web page</a></li>
        <li><a href="#32-send-yourself-an-email">3.2 Send yourself an email</a></li>
        <li><a href="#33-listening-and-connecting">3.3 Listening and Connecting</a></li>
      </ul>
    </li>
    <li><a href="#4-writing-a-network-program-using-an-os-system-socket">4 Writing a network program using an OS system socket</a>
      <ul>
        <li><a href="#45-writing-webget">4.5 Writing webget</a></li>
      </ul>
    </li>
    <li><a href="#5-an-in-memory-reliable-byte-stream">5 An in-memory reliable byte stream</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p><a href="https://cs144.github.io/">CS 144: Introduction to Computer Networking, Fall 2025</a></p>
<p>本篇文章对应 <code>check0.pdf</code> 的内容</p>
<h2 id="3-network-by-hand">3 Network by hand<a hidden class="anchor" aria-hidden="true" href="#3-network-by-hand">#</a></h2>
<h3 id="31-fetch-a-web-page">3.1 Fetch a Web page<a hidden class="anchor" aria-hidden="true" href="#31-fetch-a-web-page">#</a></h3>
<p>这个介绍怎么发送一个 GET 请求</p>
<ol>
<li>
<p><code>telent cs144.keithw.org http</code></p>
<p>该命令告诉 telnet 打开一个可靠字节流(reliable byte stream)，并在我电脑上运行一个 http 服务</p>
<p>预计会收到这样的内容</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Trying 104.196.238.229...
</span></span><span class="line"><span class="cl">Connected to cs144.keithw.org.
</span></span><span class="line"><span class="cl">Escape character is &#39;^]&#39;.
</span></span><span class="line"><span class="cl">^]
</span></span><span class="line"><span class="cl">telnet&gt; close
</span></span><span class="line"><span class="cl">Connection closed.
</span></span></code></pre></div><p>该命令不能使用常见的 <code>Ctrl-C</code> 之类方法退出，而是 <code>Ctrl-]</code> 然后输入 close</p>
</li>
<li>
<p><code>GET /hello HTTP/1.1</code></p>
<p>该命令告诉服务器 URL 的 <em>path</em> 部分</p>
</li>
<li>
<p><code>Host: cs144.keithw.org</code></p>
<p>该命令告诉服务器 URL 的 <em>host</em> 部分</p>
</li>
<li>
<p><code>Connection: close</code></p>
<p>该命令告诉服务器这是最后一个 HTTP 请求，服务器在发送完最后一字节的响应数据后应主动关闭 TCP 连接</p>
<p>再按一次回车，会发送一个空行给服务器，表明发送的 HTTP 请求完成了，这会看到和浏览器一样的响应内容
这不是关闭连接，它只是 HTTP 请求报文语法的结束符</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">HTTP/1.1 200 OK
</span></span><span class="line"><span class="cl">Date: Tue, 09 Dec 2025 07:32:01 GMT
</span></span><span class="line"><span class="cl">Server: Apache
</span></span><span class="line"><span class="cl">Last-Modified: Thu, 13 Dec 2018 15:45:29 GMT
</span></span><span class="line"><span class="cl">ETag: &#34;e-57ce93446cb64&#34;
</span></span><span class="line"><span class="cl">Accept-Ranges: bytes
</span></span><span class="line"><span class="cl">Content-Length: 14
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Type: text/plain
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Hello, CS144!
</span></span><span class="line"><span class="cl">Connection closed by foreign host.
</span></span></code></pre></div><p><code>Connection: close</code> 属于 HTTP 语义层，告诉服务器：“响应完就关闭连接”</p>
<p>空行 CRLF 属于 HTTP 报文语法，告诉服务器：“我的请求已经完整，可以开始处理”</p>
</li>
</ol>
<h3 id="32-send-yourself-an-email">3.2 Send yourself an email<a hidden class="anchor" aria-hidden="true" href="#32-send-yourself-an-email">#</a></h3>
<p>这节介绍怎么通过 SMTP 协议发送邮件</p>
<p>首先看课程文档里面的步骤：</p>
<p><code>ssh sunetid@cardinal.stanford.edu</code> 这里要用 Stanford 的学生 id 去登陆</p>
<ol>
<li>
<p><code>telnet 67.231.149.169 smtp</code></p>
<p>使用 SMTP (Simple Mail Transfer Protocol) 服务连接到服务器，应该会显示</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">Trying 67.231.149.169...
</span></span><span class="line"><span class="cl">Connected to 67.231.149.169.
</span></span><span class="line"><span class="cl">Escape character is &#39;^]&#39;.
</span></span><span class="line"><span class="cl">220 mx0a-00000d07.pphosted.com ESMTP mfa-m0342459
</span></span></code></pre></div></li>
<li>
<p><code>HELO mycomputer.stanford.edu</code></p>
<p>该命令会建立会话，一般后是个域名或者 <code>[IP]</code> 这种形式，也可以自定义字段，但可能会因此被归类为垃圾邮件</p>
<p>实际上现代的 SMTP 一般都支持 <code>EHLO</code> 扩展命令，这里就不详细说了</p>
<p>会返回类似下面内容</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">250 ... Hello cardinal3.stanford.edu [171.67.24.75], pleased to meet you
</span></span></code></pre></div></li>
<li>
<p><code>MAIL FROM: sunetid@stanford.edu</code></p>
<p>这里是明确发送方的 email，由于早期互联网是一个信任网络，因此这里可以随便写</p>
<p>但现在一般服务器都会去检测，如果是乱写的会被拒绝</p>
<p>返回如下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">250 2.1.0 Sender ok
</span></span></code></pre></div></li>
<li>
<p><code>RCPT TO: sunetid@stanford.edu</code></p>
<p>这里指定接收人的地址，可以直接指定自己，这样就是自己给自己发邮件</p>
<p>也可以指定其他任意地址，不过要注意可能会被当成垃圾邮件</p>
<p>返回内容如下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">250 2.1.5 Recipient ok.
</span></span></code></pre></div></li>
<li>
<p><code>DATA</code></p>
<p>输入该命令后，下面就是信封的文本内容了，如果正常会看到下面输出：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
</span></span></code></pre></div><p>现在需要先写好发件人、收件人、主题</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">From: sunetid@stanford.edu
</span></span><span class="line"><span class="cl">To: sunetid@stanford.edu
</span></span><span class="line"><span class="cl">Subject: Hello from CS144 Lab 0!
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">This is an email sent via SMTP manually! ...
</span></span><span class="line"><span class="cl">.
</span></span></code></pre></div><p>这些内容是给人类看的，当然可以随便写，但有些比较严格的服务器会检测这些字段内容。
如果和上面的 <code>MAIL FROM: / RCPT TO:</code> 不一致，可能会被拒收。
我试了下，qq 邮件会拒收，并会收到拒收码；而网易 126 邮箱就可以随便写。</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">抱歉，您的信件被退回
</span></span><span class="line"><span class="cl">尊敬的用户 **@126.com：
</span></span><span class="line"><span class="cl">您发送到 **@qq.com 的邮件被系统退回，以下是退信相关信息：
</span></span><span class="line"><span class="cl">因信头from字段拒收邮件
</span></span><span class="line"><span class="cl">建议解决方案：建议您检查邮件信头是否包含from字段，from字段中的邮箱地址是否正确，是否存在多个from字段等问题，并进行相应调整。您也可以尝试使用网页版邮箱或邮箱大师发送邮件。如果仍然投递失败，请联系收件方协助调整，或通过网易邮件帮助中心进行反馈问题。
</span></span><span class="line"><span class="cl">------------------------------- 原邮件信息 -------------------------------
</span></span><span class="line"><span class="cl">发送时间：2025-12-09 22:08:36
</span></span><span class="line"><span class="cl">邮件主题：CS144 - Test Message
</span></span><span class="line"><span class="cl">收件地址：**@qq.com
</span></span><span class="line"><span class="cl">服务器返回码：
</span></span><span class="line"><span class="cl">SMTP error, DOT: Host qq.com(157.255.221.253) DOT said 550 The &#34;From&#34; header is missing or invalid. Please follow RFC5322, RFC2047, RFC822 standard protocol. [MPaFZkPlT3GZDlVMiasbtU2tOYMzMMEOLjt1R3UrOzI24oWss6B56APQJEAznwCF9Q== IP: ***.***.***.*]. https://service.mail.qq.com/detail/124/995.
</span></span></code></pre></div><p>在 Subject 后面的邮件正文，必须要隔一行空格才行，否则解析会出错，最后邮件看不到正文信息。</p>
</li>
<li>
<p><code>.</code></p>
<p>单行的点代表结束，会收到下面类似返回</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">250 2.0.0 33h24dpdsr-1 Message accepted for delivery
</span></span></code></pre></div></li>
<li>
<p><code>QUIT</code></p>
<p>该命令结束邮件服务器的会话，一般邮件会加入队列，过一会儿才会收到。</p>
</li>
</ol>
<p>好了，上面介绍的是课程文档里面写的，但由于没有 sunetid，也就无法 ssh 到 Standard 去完成该课程实验，但是可以可以通过 126 邮箱完成。</p>
<p>注释一个 126 邮箱，去设置里面找到 POP3/SMTP/IMAP 相关项，把服务给打开，然后弄个授权码，等下可以使用这个连接到 126 服务器（QQ 不行）。</p>
<p>得到授权码后，要对邮件和授权吗进行编码</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">% echo -n &#34;xxx@126.com&#34; | base64
</span></span><span class="line"><span class="cl">a********************=
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">% echo -n &#34;授权码&#34; | base64
</span></span><span class="line"><span class="cl">T*********************==
</span></span></code></pre></div><p>由于现实中都使用 https，因此无法直接使用 telnet 连接，这里使用 openssl</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">openssl s_client -connect smtp.126.com:465 -quiet
</span></span></code></pre></div><p>然后通过命令 <code>HELO</code> 或 <code>EHLO</code> 后面加任意内容建立连接</p>
<p>这里使用上面生成的编码进行验证：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">AUTH LOGIN
</span></span></code></pre></div><p>输入验证登陆命令后，复制上面 邮件编码 回车，再复制 授权码编码 回车，这样就登陆成功了，接下来和前面的内容就一样了！</p>
<p>下面简单复制粘贴一个示例参考一下</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">% openssl s_client -connect smtp.126.com:465 -quiet
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Connecting to 220.197.33.216
</span></span><span class="line"><span class="cl">depth=2 C=US, O=DigiCert Inc, OU=www.digicert.com, CN=DigiCert Global Root G2
</span></span><span class="line"><span class="cl">verify return:1
</span></span><span class="line"><span class="cl">depth=1 C=US, O=DigiCert, Inc., CN=GeoTrust G2 TLS CN RSA4096 SHA256 2022 CA1
</span></span><span class="line"><span class="cl">verify return:1
</span></span><span class="line"><span class="cl">depth=0 C=CN, ST=Zhejiang, L=Hangzhou, O=NetEase (Hangzhou) Network Co., Ltd, CN=*.126.com
</span></span><span class="line"><span class="cl">verify return:1
</span></span><span class="line"><span class="cl">220 126.com Anti-spam GT for Coremail System (126com[20140526])
</span></span><span class="line"><span class="cl">HELO macbook.sx
</span></span><span class="line"><span class="cl">250 OK
</span></span><span class="line"><span class="cl">AUTH LOGIN
</span></span><span class="line"><span class="cl">334 dXNlcm5hbWU6
</span></span><span class="line"><span class="cl">a**********************=
</span></span><span class="line"><span class="cl">334 UGFzc3dvcmQ6
</span></span><span class="line"><span class="cl">T*********************==
</span></span><span class="line"><span class="cl">235 Authentication successful
</span></span><span class="line"><span class="cl">MAIL FROM: &lt;**@126.com&gt;
</span></span><span class="line"><span class="cl">250 Mail OK
</span></span><span class="line"><span class="cl">MAIL TO: &lt;**@126.com&gt;
</span></span><span class="line"><span class="cl">503 bad sequence of commands
</span></span><span class="line"><span class="cl">RCPT TO: &lt;**@126.com&gt;
</span></span><span class="line"><span class="cl">250 Mail OK
</span></span><span class="line"><span class="cl">DATA
</span></span><span class="line"><span class="cl">354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;
</span></span><span class="line"><span class="cl">From: **@126.com
</span></span><span class="line"><span class="cl">To: **@126.com
</span></span><span class="line"><span class="cl">Subject: CS144 Test
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">This is an email sent via SMTP manually!
</span></span><span class="line"><span class="cl">.
</span></span><span class="line"><span class="cl">250 Mail OK queued as gzga-smtp-mtada-g1-1,_____wD3f1hH6DdpREvXAQ--.30649S2 1765271741
</span></span><span class="line"><span class="cl">QUIT
</span></span><span class="line"><span class="cl">221 Bye
</span></span><span class="line"><span class="cl">00488F0302000000:error:0A000126:SSL routines::unexpected eof while reading:ssl/record/rec_layer_s3.c:701:
</span></span><span class="line"><span class="cl">00488F0302000000:error:0A000197:SSL routines:SSL_shutdown:shutdown while in init:ssl/ssl_lib.c:2834:
</span></span></code></pre></div><h3 id="33-listening-and-connecting">3.3 Listening and Connecting<a hidden class="anchor" aria-hidden="true" href="#33-listening-and-connecting">#</a></h3>
<p>之前的实验都是通过 telnet 运行的 <strong>client</strong> 程序，下面来运行一个 <strong>server</strong> 程序</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">netcat -v -l -p 9090
</span></span></code></pre></div><p>然后再开一个窗口，连接到该服务器</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">telnet localhost 9090
</span></span></code></pre></div><p>应该会看到 server 输出 <code>Connection fromlocalhost 53500 received!</code> 这样的内容，在两个窗口里输出任何内容回车，会立刻显示在两个窗口中，在 netcat 窗口按 <code>Ctrl-C</code> 会使两个窗口都被关闭。</p>
<h2 id="4-writing-a-network-program-using-an-os-system-socket">4 Writing a network program using an OS system socket<a hidden class="anchor" aria-hidden="true" href="#4-writing-a-network-program-using-an-os-system-socket">#</a></h2>
<p><del>现代</del> C++ 编程规则：</p>
<ul>
<li>使用文档 <a href="https://en.cppreference.com">https://en.cppreference.com</a>，cplusplus.com 有点过时了</li>
<li>永远不要使用 <code>malloc()</code> 或 <code>free()</code></li>
<li>永远不要使用 <code>new</code> 或 <code>delete</code></li>
<li>基本上永远不要使用原始指针 <code>*</code>，只在需要的时候使用智能指针 smart pointers <code>unique_ptr</code> 或 <code>shared_ptr</code>（本课程用不上）</li>
<li>避免 templates、threads、locks 和 virtual functions（本课程不会使用）</li>
<li>避免 C 风格字符串 <code>char *str</code> 或字符串函数 <code>strlen()</code>, <code>strcpy()</code>，这些很容易出错，应该使用 <code>std::string</code>。</li>
<li>永远不要使用 C 风格的类型转换，例如 <code>(FILE *) x</code>，使用 C++ <code>static_cast</code></li>
<li>使用常量引用传递函数参数，例如 <code>const Address &amp; address</code></li>
<li>每个变量都使用 const，除非要修改它</li>
<li>每个对象方法都使用 const，除非要修改它</li>
<li>避免使用全局变量，并给每个变量尽可能小的作用域</li>
<li>提交之前，运行 <code>cmake --build build --target tidy</code> 来获取改进建议，并运行 <code>cmake --build build --target format</code> 来格式化代码</li>
</ul>
<p>关于使用 Git：</p>
<p>高频率的最小化提交，并解释修改了什么，以及为什么。</p>
<p>进行小规模的“语义化”提交有助于调试（如果每次提交都能编译通过，并且提交信息清晰地描述了该次提交所做的一件事，那么调试起来会容易得多）</p>
<p>为了支持这种编程风格，Minnow 的类将操作系统函数（可通过 C 语言调用）封装在“现代” C++ 中。
并提供了针对 CS 111 课程中可能已广泛熟悉的概念（尤其是套接字和文件描述符）的 C++ 封装类。</p>
<p>请仔细阅读公共接口部分（位于文件 <code>util/socket.hh</code> 和 <code>util/file_descriptor.hh</code> 中 <code>public:</code> 之后的内容）。
（请注意，Socket 是 FileDescriptor 的一种类型，而 TCPSocket 是 Socket 的一种类型。）</p>
<h3 id="45-writing-webget">4.5 Writing webget<a hidden class="anchor" aria-hidden="true" href="#45-writing-webget">#</a></h3>
<p>现在要实现 <code>webget</code> 程序，一个利用操作系统 TCP 支持及流套接字抽象，来获取网页的程序，就像上那样。</p>
<ol>
<li>
<p>在 <code>bulid</code> 目录下，打开文件 <code>../apps/webget.cc</code></p>
</li>
<li>
<p>在 <code>get_URL</code> 函数中，安装文本描述实现简易 Web 客户端，使用前面一样的 HTTP 请求格式。使用 <code>TCPSocket</code> 和 <code>Address</code> 类。</p>
</li>
<li>
<p>提示：<br>
注意在 HTTP 每行必须以 <code>\r\n</code> 结尾</p>
<p>不要忘记在请求中包含 <code>Connection: close</code>，这告诉服务器，在这个请求后不应该继续等待更多信息的发送。<br>
相反，服务器将发送一个回复，然后立即结束其输出字节流。<br>
当读取完服务器发送的整个字节流后，套接字会达到 &ldquo;EOF&rdquo; 文件结束状态，这意味着传入的字节流已经终止。<br>
这样客户段就能知道服务器已经完成了回复。</p>
<p>确保 print 所有来自服务器的输出，直到 sockets 遇到 &ldquo;EOF&rdquo; (End Of File)，一次读取调用是不够的。</p>
<p>期望编写 8 行左右代码</p>
</li>
<li>
<p>使用 <code>cmake --build build</code> 编译代码</p>
</li>
<li>
<p>使用 <code>./apps/webget cs144.keithw.org /hello</code> 测试程序。<br>
对比浏览器中得到的结果，和上面 3.1 节中得到的结果</p>
</li>
<li>
<p>当系统运行正常时，执行 <code>cmake --build biuld --target check webget</code> 命令来运行自动化测试。<br>
在实现 <code>get_URL</code> 函数之前，应该会看到以下输出：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ cmake --build build --target check_webget
</span></span><span class="line"><span class="cl">Test project /home/cs144/minnow/build
</span></span><span class="line"><span class="cl">Start 1: compile with bug-checkers
</span></span><span class="line"><span class="cl">1/2 Test <span class="c1">#1: compile with bug-checkers ........ Passed 1.02 sec</span>
</span></span><span class="line"><span class="cl">Start 2: t_webget
</span></span><span class="line"><span class="cl">2/2 Test <span class="c1">#2: t_webget .........................***Failed 0.01 sec</span>
</span></span><span class="line"><span class="cl">DEBUG: Function called: get_URL<span class="o">(</span> <span class="s2">&#34;cs144.keithw.org&#34;</span>, <span class="s2">&#34;/nph-hasher/xyzzy&#34;</span> <span class="o">)</span>
</span></span><span class="line"><span class="cl">DEBUG: get_URL<span class="o">()</span> <span class="k">function</span> not yet implemented
</span></span><span class="line"><span class="cl">ERROR: webget returned output that did not match the test<span class="err">&#39;</span>s expectations
</span></span></code></pre></div><p>实现后会看到</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">$ cmake --build build --target check_webget
</span></span><span class="line"><span class="cl">Test project /home/cs144/minnow/build
</span></span><span class="line"><span class="cl">Start 1: compile with bug-checkers
</span></span><span class="line"><span class="cl">1/2 Test <span class="c1">#1: compile with bug-checkers ........ Passed 1.09 sec</span>
</span></span><span class="line"><span class="cl">Start 2: t_webget
</span></span><span class="line"><span class="cl">2/2 Test <span class="c1">#2: t_webget ......................... Passed 0.72 sec</span>
</span></span><span class="line"><span class="cl">100% tests passed, <span class="m">0</span> tests failed out of <span class="m">2</span>
</span></span></code></pre></div></li>
</ol>
<p>我的实现：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">get_URL</span><span class="p">(</span> <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">host</span><span class="p">,</span> <span class="k">const</span> <span class="n">string</span><span class="o">&amp;</span> <span class="n">path</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 创建 socket
</span></span></span><span class="line"><span class="cl">  <span class="n">TCPSocket</span> <span class="n">sock</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 连接服务器
</span></span></span><span class="line"><span class="cl">  <span class="n">sock</span><span class="p">.</span><span class="n">connect</span><span class="p">(</span> <span class="n">Address</span><span class="p">(</span> <span class="n">host</span><span class="p">,</span> <span class="s">&#34;http&#34;</span> <span class="p">)</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 发送数据
</span></span></span><span class="line"><span class="cl">  <span class="n">sock</span><span class="p">.</span><span class="n">write</span><span class="p">(</span> <span class="s">&#34;GET &#34;</span> <span class="o">+</span> <span class="n">path</span> <span class="o">+</span> <span class="s">&#34; HTTP/1.1</span><span class="se">\r\n</span><span class="s">&#34;</span> <span class="p">);</span> <span class="c1">// GET: path HTTP/1.1
</span></span></span><span class="line"><span class="cl">  <span class="n">sock</span><span class="p">.</span><span class="n">write</span><span class="p">(</span> <span class="s">&#34;Host: &#34;</span> <span class="o">+</span> <span class="n">host</span> <span class="o">+</span> <span class="s">&#34;</span><span class="se">\r\n</span><span class="s">&#34;</span> <span class="p">);</span>        <span class="c1">// Host: host
</span></span></span><span class="line"><span class="cl">  <span class="n">sock</span><span class="p">.</span><span class="n">write</span><span class="p">(</span> <span class="s">&#34;Connection: close</span><span class="se">\r\n\r\n</span><span class="s">&#34;</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 关闭写端
</span></span></span><span class="line"><span class="cl">  <span class="n">sock</span><span class="p">.</span><span class="n">shutdown</span><span class="p">(</span> <span class="n">SHUT_WR</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// 读取返回数据
</span></span></span><span class="line"><span class="cl">  <span class="n">string</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 判断是结束
</span></span></span><span class="line"><span class="cl">  <span class="k">while</span> <span class="p">(</span> <span class="o">!</span><span class="n">sock</span><span class="p">.</span><span class="n">eof</span><span class="p">()</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 存储读取内容到 data
</span></span></span><span class="line"><span class="cl">    <span class="n">sock</span><span class="p">.</span><span class="n">read</span><span class="p">(</span> <span class="n">data</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>到 <code>build/</code> 目录下运行测试命令 <code>./apps/webget cs144.keithw.org /hello</code> 返回内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">HTTP/1.1 200 OK
</span></span><span class="line"><span class="cl">Date: Sat, 10 Jan 2026 16:56:46 GMT
</span></span><span class="line"><span class="cl">Server: Apache
</span></span><span class="line"><span class="cl">Last-Modified: Thu, 13 Dec 2018 15:45:29 GMT
</span></span><span class="line"><span class="cl">ETag: &#34;e-57ce93446cb64&#34;
</span></span><span class="line"><span class="cl">Accept-Ranges: bytes
</span></span><span class="line"><span class="cl">Content-Length: 14
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Type: text/plain
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Hello, CS144!
</span></span></code></pre></div><p>对比之前使用 <code>telnet</code> 的返回内容：</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-text" data-lang="text"><span class="line"><span class="cl">HTTP/1.1 200 OK
</span></span><span class="line"><span class="cl">Date: Sat, 10 Jan 2026 16:00:48 GMT
</span></span><span class="line"><span class="cl">Server: Apache
</span></span><span class="line"><span class="cl">Last-Modified: Thu, 13 Dec 2018 15:45:29 GMT
</span></span><span class="line"><span class="cl">ETag: &#34;e-57ce93446cb64&#34;
</span></span><span class="line"><span class="cl">Accept-Ranges: bytes
</span></span><span class="line"><span class="cl">Content-Length: 14
</span></span><span class="line"><span class="cl">Connection: close
</span></span><span class="line"><span class="cl">Content-Type: text/plain
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">Hello, CS144!
</span></span><span class="line"><span class="cl">Connection closed by foreign host.
</span></span></code></pre></div><p>运行测试成功通过！</p>
<h2 id="5-an-in-memory-reliable-byte-stream">5 An in-memory reliable byte stream<a hidden class="anchor" aria-hidden="true" href="#5-an-in-memory-reliable-byte-stream">#</a></h2>
<table>
  <thead>
      <tr>
          <th>类/接口</th>
          <th>角色/关系</th>
          <th>说明</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>ByteStream</code></td>
          <td>基类</td>
          <td>提供共享缓冲区</td>
      </tr>
      <tr>
          <td><code>Writer</code></td>
          <td>继承自 <code>ByteStream</code></td>
          <td>写端，负责写入数据</td>
      </tr>
      <tr>
          <td><code>Reader</code></td>
          <td>继承自 <code>ByteStream</code></td>
          <td>读端，负责读出数据</td>
      </tr>
  </tbody>
</table>
<p><strong>关键设计</strong>：<code>Writer</code> 和 <code>Reader</code> 都继承自 <code>ByteStream</code>，共享同一个缓冲区。所有成员变量应定义在 <code>ByteStream</code> 类的 <strong><code>protected</code></strong> 部分。</p>
<ul>
<li>Writer 端（写入）</li>
</ul>
<table>
  <thead>
      <tr>
          <th>方法</th>
          <th>功能</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>push(data)</code></td>
          <td>写入数据（不超过可用容量）</td>
      </tr>
      <tr>
          <td><code>close()</code></td>
          <td>关闭流</td>
      </tr>
      <tr>
          <td><code>is_closed()</code></td>
          <td>流是否已关闭</td>
      </tr>
      <tr>
          <td><code>available_capacity()</code></td>
          <td>还能写多少字节</td>
      </tr>
      <tr>
          <td><code>bytes_pushed()</code></td>
          <td>累计写入了多少字节</td>
      </tr>
  </tbody>
</table>
<ul>
<li>Reader 端（读出）</li>
</ul>
<table>
  <thead>
      <tr>
          <th>方法</th>
          <th>功能</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td><code>peek()</code></td>
          <td>查看缓冲区内容（不移除）</td>
      </tr>
      <tr>
          <td><code>pop(len)</code></td>
          <td>移除前 <code>len</code> 个字节</td>
      </tr>
      <tr>
          <td><code>is_finished()</code></td>
          <td>流是否结束（已关闭且读完）</td>
      </tr>
      <tr>
          <td><code>bytes_buffered()</code></td>
          <td>缓冲区当前有多少字节</td>
      </tr>
      <tr>
          <td><code>bytes_popped()</code></td>
          <td>累计读出了多少字节</td>
      </tr>
  </tbody>
</table>
<p>类实现代码：</p>
<p>这里使用 string 作为数据流存储</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// byte_stream.hh
</span></span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ByteStream</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="k">explicit</span> <span class="n">ByteStream</span><span class="p">(</span> <span class="kt">uint64_t</span> <span class="n">capacity</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Helper functions (provided) to access the ByteStream&#39;s Reader and Writer interfaces
</span></span></span><span class="line"><span class="cl">  <span class="n">Reader</span><span class="o">&amp;</span> <span class="n">reader</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">Reader</span><span class="o">&amp;</span> <span class="n">reader</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">Writer</span><span class="o">&amp;</span> <span class="n">writer</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="n">Writer</span><span class="o">&amp;</span> <span class="n">writer</span><span class="p">()</span> <span class="k">const</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kt">void</span> <span class="nf">set_error</span><span class="p">()</span> <span class="p">{</span> <span class="n">error_</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span> <span class="p">};</span>       <span class="c1">// Signal that the stream suffered an error.
</span></span></span><span class="line"><span class="cl">  <span class="kt">bool</span> <span class="nf">has_error</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span> <span class="k">return</span> <span class="n">error_</span><span class="p">;</span> <span class="p">};</span> <span class="c1">// Has the stream had an error?
</span></span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">protected</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Please add any additional state to the ByteStream here, and not to the Writer and Reader interfaces.
</span></span></span><span class="line"><span class="cl">  <span class="kt">uint64_t</span> <span class="n">capacity_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kt">bool</span> <span class="n">error_</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">bool</span> <span class="n">is_closed_</span> <span class="p">{</span> <span class="nb">false</span> <span class="p">};</span> <span class="c1">// 流刚创建时为未关闭状态
</span></span></span><span class="line"><span class="cl">  <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">buffer_</span> <span class="p">{};</span>    <span class="c1">// 使用字符串存储数据流
</span></span></span><span class="line"><span class="cl">  <span class="kt">uint64_t</span> <span class="n">bytes_pushed_</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">  <span class="kt">uint64_t</span> <span class="n">bytes_popped_</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>注意流刚创建状态为为关闭。</p>
<hr>
<p>具体方法实现代码</p>
<ul>
<li>Writer</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">ByteStream</span><span class="o">::</span><span class="n">ByteStream</span><span class="p">(</span> <span class="kt">uint64_t</span> <span class="n">capacity</span> <span class="p">)</span> <span class="o">:</span> <span class="n">capacity_</span><span class="p">(</span> <span class="n">capacity</span> <span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Push data to stream, but only as much as available capacity allows.
</span></span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Writer</span><span class="o">::</span><span class="n">push</span><span class="p">(</span> <span class="n">string</span> <span class="n">data</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="kt">uint64_t</span> <span class="n">available</span> <span class="o">=</span> <span class="n">capacity_</span> <span class="o">-</span> <span class="n">buffer_</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 缓存满了
</span></span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span> <span class="n">available</span> <span class="o">==</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 对比 剩余空间 和 数据大小
</span></span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="kt">uint64_t</span> <span class="n">to_write</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span> <span class="n">available</span><span class="p">,</span> <span class="n">data</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 阶段字符串
</span></span></span><span class="line"><span class="cl">  <span class="n">data</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span> <span class="n">to_write</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 拼接缓存结果
</span></span></span><span class="line"><span class="cl">  <span class="n">buffer_</span> <span class="o">+=</span> <span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// 累计写入字节量
</span></span></span><span class="line"><span class="cl">  <span class="n">bytes_pushed_</span> <span class="o">+=</span> <span class="n">to_write</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Signal that the stream has reached its ending. Nothing more will be written.
</span></span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Writer</span><span class="o">::</span><span class="n">close</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">is_closed_</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Has the stream been closed?
</span></span></span><span class="line"><span class="cl"><span class="kt">bool</span> <span class="n">Writer</span><span class="o">::</span><span class="n">is_closed</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">is_closed_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// How many bytes can be pushed to the stream right now?
</span></span></span><span class="line"><span class="cl"><span class="kt">uint64_t</span> <span class="n">Writer</span><span class="o">::</span><span class="n">available_capacity</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">capacity_</span> <span class="o">-</span> <span class="n">buffer_</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Total number of bytes cumulatively pushed to the stream
</span></span></span><span class="line"><span class="cl"><span class="kt">uint64_t</span> <span class="n">Writer</span><span class="o">::</span><span class="n">bytes_pushed</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">bytes_pushed_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><ul>
<li>Reader</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// Peek at the next bytes in the buffer -- ideally as many as possible.
</span></span></span><span class="line"><span class="cl"><span class="c1">// It&#39;s not required to return a string_view of the *whole* buffer, but
</span></span></span><span class="line"><span class="cl"><span class="c1">// if the peeked string_view is only one byte at a time, it will probably force
</span></span></span><span class="line"><span class="cl"><span class="c1">// the caller to do a lot of extra work.
</span></span></span><span class="line"><span class="cl"><span class="n">string_view</span> <span class="n">Reader</span><span class="o">::</span><span class="n">peek</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">buffer_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Remove `len` bytes from the buffer.
</span></span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">Reader</span><span class="o">::</span><span class="n">pop</span><span class="p">(</span> <span class="kt">uint64_t</span> <span class="n">len</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">const</span> <span class="kt">uint64_t</span> <span class="n">popped</span> <span class="o">=</span> <span class="n">min</span><span class="p">(</span> <span class="n">len</span><span class="p">,</span> <span class="n">buffer_</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">buffer_</span><span class="p">.</span><span class="n">erase</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">popped</span> <span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">bytes_popped_</span> <span class="o">+=</span> <span class="n">popped</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Is the stream finished (closed and fully popped)?
</span></span></span><span class="line"><span class="cl"><span class="kt">bool</span> <span class="n">Reader</span><span class="o">::</span><span class="n">is_finished</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">is_closed_</span> <span class="o">&amp;&amp;</span> <span class="n">buffer_</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Number of bytes currently buffered (pushed and not popped)
</span></span></span><span class="line"><span class="cl"><span class="kt">uint64_t</span> <span class="n">Reader</span><span class="o">::</span><span class="n">bytes_buffered</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">buffer_</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Total number of bytes cumulatively popped from stream
</span></span></span><span class="line"><span class="cl"><span class="kt">uint64_t</span> <span class="n">Reader</span><span class="o">::</span><span class="n">bytes_popped</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="n">bytes_popped_</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>注意使用的变量尽量使用 <code>const</code>，除非要修改它。</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/netowrk/">Netowrk</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/python-tricks-part-8-modules-and-packages/">
    <span class="title">« Prev</span>
    <br>
    <span>Python Tricks Part 8: Modules and Packages</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/python-tricks-part-6-generators/">
    <span class="title">Next »</span>
    <br>
    <span>Python Tricks Part 6: Generators</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CS144 - lab0 on x"
            href="https://x.com/intent/tweet/?text=CS144%20-%20lab0&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fcs144-lab0%2f&amp;hashtags=Netowrk">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CS144 - lab0 on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fcs144-lab0%2f&amp;title=CS144%20-%20lab0&amp;summary=CS144%20-%20lab0&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fcs144-lab0%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CS144 - lab0 on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fcs144-lab0%2f&title=CS144%20-%20lab0">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CS144 - lab0 on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fcs144-lab0%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CS144 - lab0 on whatsapp"
            href="https://api.whatsapp.com/send?text=CS144%20-%20lab0%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fcs144-lab0%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CS144 - lab0 on telegram"
            href="https://telegram.me/share/url?text=CS144%20-%20lab0&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fcs144-lab0%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share CS144 - lab0 on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=CS144%20-%20lab0&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fcs144-lab0%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">Starslayerx&#39; Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
