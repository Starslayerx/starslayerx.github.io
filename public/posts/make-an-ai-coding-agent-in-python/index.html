<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Make an AI Coding Agent in python | Starslayerx&#39; Blog</title>
<meta name="keywords" content="LLMs, Agent">
<meta name="description" content="这篇文件介绍如何使用 Python 制作一个基础的 AI 编程助手
Minimal AI Coding Agent
下面是一个 AI Coding Agent 至少需要的功能

Chat loop 对话循环
Call an LLM 调用大语言模型
Add tools to call 增加工具调用
Handle tool request 处理工具调用请求

Step 1: Chat Loop
首先, 聊天循环一直循环等待用户输入, Python 的 &ldquo;input&rdquo; 方法可以获取用户输入
print(&#34;Type q to quit&#34;)

while True:
    user_message = input(&#34;You: &#34;)
    if user_message == &#34;q&#34;:
        break
    ai_message = f&#34;You said {user_message}... so insightful&#34;
    print(ai_message)
目前主流的 LLM 都是无状态的, 所以需要我们手动的去管理对话上下文, 这里使用一个 fake_ai 函数模拟真实的 LLM 调用, 并包含 role 和 content 内容">
<meta name="author" content="Starslayerx">
<link rel="canonical" href="http://localhost:1313/posts/make-an-ai-coding-agent-in-python/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css" integrity="sha256-2jIR5e&#43;Ge/K3X9WmUVz&#43;1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.svg">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon.svg">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon.svg">
<link rel="apple-touch-icon" href="http://localhost:1313/favicon.svg">
<link rel="mask-icon" href="http://localhost:1313/favicon.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/make-an-ai-coding-agent-in-python/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="http://localhost:1313/posts/make-an-ai-coding-agent-in-python/">
  <meta property="og:site_name" content="Starslayerx&#39; Blog">
  <meta property="og:title" content="Make an AI Coding Agent in python">
  <meta property="og:description" content="这篇文件介绍如何使用 Python 制作一个基础的 AI 编程助手
Minimal AI Coding Agent 下面是一个 AI Coding Agent 至少需要的功能
Chat loop 对话循环 Call an LLM 调用大语言模型 Add tools to call 增加工具调用 Handle tool request 处理工具调用请求 Step 1: Chat Loop 首先, 聊天循环一直循环等待用户输入, Python 的 “input” 方法可以获取用户输入
print(&#34;Type q to quit&#34;) while True: user_message = input(&#34;You: &#34;) if user_message == &#34;q&#34;: break ai_message = f&#34;You said {user_message}... so insightful&#34; print(ai_message) 目前主流的 LLM 都是无状态的, 所以需要我们手动的去管理对话上下文, 这里使用一个 fake_ai 函数模拟真实的 LLM 调用, 并包含 role 和 content 内容">
  <meta property="og:locale" content="en-US">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2025-09-01T08:00:00+08:00">
    <meta property="article:modified_time" content="2025-09-01T08:00:00+08:00">
    <meta property="article:tag" content="LLMs">
    <meta property="article:tag" content="Agent">
      <meta property="og:image" content="http://localhost:1313/images/og-default.avif">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/images/og-default.avif">
<meta name="twitter:title" content="Make an AI Coding Agent in python">
<meta name="twitter:description" content="这篇文件介绍如何使用 Python 制作一个基础的 AI 编程助手
Minimal AI Coding Agent
下面是一个 AI Coding Agent 至少需要的功能

Chat loop 对话循环
Call an LLM 调用大语言模型
Add tools to call 增加工具调用
Handle tool request 处理工具调用请求

Step 1: Chat Loop
首先, 聊天循环一直循环等待用户输入, Python 的 &ldquo;input&rdquo; 方法可以获取用户输入
print(&#34;Type q to quit&#34;)

while True:
    user_message = input(&#34;You: &#34;)
    if user_message == &#34;q&#34;:
        break
    ai_message = f&#34;You said {user_message}... so insightful&#34;
    print(ai_message)
目前主流的 LLM 都是无状态的, 所以需要我们手动的去管理对话上下文, 这里使用一个 fake_ai 函数模拟真实的 LLM 调用, 并包含 role 和 content 内容">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "Make an AI Coding Agent in python",
      "item": "http://localhost:1313/posts/make-an-ai-coding-agent-in-python/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "Make an AI Coding Agent in python",
  "name": "Make an AI Coding Agent in python",
  "description": "这篇文件介绍如何使用 Python 制作一个基础的 AI 编程助手\nMinimal AI Coding Agent 下面是一个 AI Coding Agent 至少需要的功能\nChat loop 对话循环 Call an LLM 调用大语言模型 Add tools to call 增加工具调用 Handle tool request 处理工具调用请求 Step 1: Chat Loop 首先, 聊天循环一直循环等待用户输入, Python 的 \u0026ldquo;input\u0026rdquo; 方法可以获取用户输入\nprint(\u0026#34;Type q to quit\u0026#34;) while True: user_message = input(\u0026#34;You: \u0026#34;) if user_message == \u0026#34;q\u0026#34;: break ai_message = f\u0026#34;You said {user_message}... so insightful\u0026#34; print(ai_message) 目前主流的 LLM 都是无状态的, 所以需要我们手动的去管理对话上下文, 这里使用一个 fake_ai 函数模拟真实的 LLM 调用, 并包含 role 和 content 内容\n",
  "keywords": [
    "LLMs", "Agent"
  ],
  "articleBody": "这篇文件介绍如何使用 Python 制作一个基础的 AI 编程助手\nMinimal AI Coding Agent 下面是一个 AI Coding Agent 至少需要的功能\nChat loop 对话循环 Call an LLM 调用大语言模型 Add tools to call 增加工具调用 Handle tool request 处理工具调用请求 Step 1: Chat Loop 首先, 聊天循环一直循环等待用户输入, Python 的 “input” 方法可以获取用户输入\nprint(\"Type q to quit\") while True: user_message = input(\"You: \") if user_message == \"q\": break ai_message = f\"You said {user_message}... so insightful\" print(ai_message) 目前主流的 LLM 都是无状态的, 所以需要我们手动的去管理对话上下文, 这里使用一个 fake_ai 函数模拟真实的 LLM 调用, 并包含 role 和 content 内容\n# step1.py import requests def fake_ai(message): latest_user_messages = messages[-1][\"content\"] ai_message = f\"You said {latest_user_messages}... so insightful\" return { \"role\": \"assistant\", \"content\": ai_message, } print(\"Press q to quit\") messages = [] while True: user_message = input(\"You: \") if user_message == \"q\": break messages.append({ \"role\": \"user\", \"content\": user_message, }) ai_message_obj = fake_ai(messages) print(\"AI: \" + ai_message_obj[\"content\"]) messages.append(ai_message_obj) Step2: Call an LLM 现在聊天循环已经设置好了正确的 API, 下面创建 llm 函数来替换 fake_ai.\n# step2.py def call_llm(messages): headers = { \"Authorization\": f\"Bearer $DASHSCOPE_API_KEY\", \"Content-Type\": \"application/json\", } data = { \"model\": \"qwen-plus\", \"messages\": messages, } base_url = \"https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions\" try: response = requests.post(url, json=data, headers=headers) message = response.json()[\"choices\"][0][\"message\"] return message except Exception as e: return {\"content\": f\"Error: {e}\"} while True: # ... ai_message_obj = call_llm(messages) # ... unchanged Step3: Add tools to call 哪些工具是需要的? 一个AI编码代理应该能够读取代码文件\n让我们从一个 read_file 工具开始. 我们要定义这个工具以及其参数, 然后将所有可用工具列表传递给 LLM, 当 LLM 认为某个响应需要调用工具, 它会返回一个内容为 None 的响应, 和一个要调用的工具列表.\n# step3.py TOOL_SPECS = [ { \"type\": \"function\", \"function\": { \"name\": \"read_file\", \"description\": \"Read the contents of a file\", \"parameters\": { \"type\": \"object\", \"properties\": { \"path\": { \"type\": \"string\", \"description\": \"The file path to read\" } }, \"required\": [\"path\"] } } } ] def call_llm(messages): data = { \"tools\": TOOL_SPECS, \"tool_choice\": \"auto\", } try: print(\"Full message\") print(message) return message 现在, 已经完成了将工具传递给 LLM 的部分, 但是还没有处理工具调用\nStep4: Handle tool requests 虽然 LLM 可以请求调用, 但是需要程序来调用代码以添加上下文或执行操作. LLM 通常会向用户返回一个包含所有新增上下文的最终消息. 在这里需要:\nA: 检查是否存在 tool_calls 键 B: 将这条调用消息添加到消息列表 C: 调用用过, 并将调用结果添加到消息列表 D: 最后一次调用 LLM, 并传入所有的上下文 # step4.py def handel_tool(tool_call): # TODO: need to call a read read_file function content = \"This secret is diving deep\" return { \"role\": \"tool\", \"tool_call_id\": tool_call[\"id\"], \"content\": content, } while True: # ... unchanged ai_message_obj = call_llm(messages) # A: 判断 AI 是否想调用工具 if \"tool_calls\" in ai_message_obj and ai_message_obj[\"tool_calls\"]: # B: 添加带有工具调用的 AI 信息 messages.append(ai_message_obj) # C: 执行每个工具, 并获取结果 for tool_call in ai_message_obj[\"tool_callls\"]: tool_result = handle_tool(tool_call) messages.append(tool_result) # D: 获取 AI 的响应 final_response = call_llm(responses) print(f\"AI: {final_response[\"content\"]}\") messages.append(final_response) else: # 默认流程 print(f\"AI: {ai_message_obj[\"content\"]}\") messages.append(ai_message_obj) 下面是工具函数, 以及执行工具的函数\n# step4_1.py def read_file(path): \"\"\"读取 path 路径文件内容\"\"\" try: with open(path, \"r\") as f: content = f.read() except Exception as e: return f\"Error reading file: {str(e)}\" def handle_tool(tool_call): \"\"\"执行一个 tool call 并返回值\"\"\" tool_name = tool_call[\"function\"][\"name\"] tool_args = json.loads(tool_call[\"function\"][\"arguments\"]) print(f\"[Exexuting {tool_name}...]\") if tool_name == \"read_file\": result = read_file(**tool_args) else: result = f\"Unknown tool: {tool_name}\" return { \"role\": \"tool\", \"tool_call_id\": tool_call[\"id\"], \"content\": result, } 恭喜! 现在所有步骤都已经完成了, 聊天循环, LLM 调用, 工具传递给 LLM 调用 并 调用工具.\n现在已经完成了让 AI 读取文件的功能, 然后就可以让 AI 查看我们的代码, 并给出建议.\n完整代码实现 (仅依赖 python 标准库运行)\nimport requests import os import json TOOL_SPECS = [ { \"type\": \"function\", \"function\": { \"name\": \"read_file\", \"description\": \"Read the content of a file.\", \"parameters\": { \"type\": \"object\", \"properties\":{ \"path\": { \"type\": \"string\", \"description\": \"The file path to read\" } }, \"required\": [\"path\"] } } } ] def read_file(path): \"\"\"Read the content of a file\"\"\" try: with open(path, \"r\") as f: content = f.read() return content except Exception as e: return f\"Error reading file: {str(e)}\" def handle_tool(tool_call): \"\"\"Execute a single tool call and return the result\"\"\" tool_name = tool_call[\"function\"][\"name\"] tool_args = json.loads(tool_call[\"function\"][\"arguments\"]) print(f\"[Executing {tool_name}...]\") if tool_name == \"read_file\": result = read_file(**tool_args) else: result = f\"Unknow tool: {tool_name}\" return { \"role\": \"tool\", \"tool_call_id\": tool_call[\"id\"], \"content\": result, } def call_llm(messages): api_key = \"sk-...\" headers = { \"Authorization\": f\"Bearer {api_key}\", \"Content-Type\": \"application/json\", } data = { \"model\": \"deepseek-v3\", \"messages\": messages, \"tools\": TOOL_SPECS, \"tool_choice\": \"auto\", } url = \"https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions\" try: response = requests.post(url, json=data, headers=headers) message = response.json()[\"choices\"][0][\"message\"] return message except: print(\"error\") raise Exception(\"bad\") def fake_ai(messages): latest_user_message = messages[-1][\"content\"] return f\"AI: You said {latest_user_message}... so insightful \" print(\"Press q to quit\") messages = [] while True: user_message = input(\"You: \") if user_message == \"q\": break messages.append({ \"role\": \"user\", \"content\": user_message, }) ai_message_obj = call_llm(messages) # Check if AI wants to use tools if \"tool_calls\" in ai_message_obj and ai_message_obj[\"tool_calls\"]: messages.append(ai_message_obj) for tool_call in ai_message_obj[\"tool_calls\"]: tool_result = handle_tool(tool_call) messages.append(tool_result) final_response = call_llm(messages) print(f\"AI: {final_response[\"content\"]}\") messages.append(final_response) else: print(f\"AI: {ai_message_obj[\"content\"]}\") messages.append(ai_message_obj) 运行示例:\n% uv run minimal-aiagent.py Press q to quit You: 你好, 介绍一下你自己. AI: 你好！我是一个智能助手，可以帮助你回答各种问题、提供建议或执行一些任务。无论是学习、工作还是日常生活相关的问题，你都可以问我。我没有 实体，但可以通过文字与你交流。请问有什么可以帮你的吗？ You: 读取一下 code_example.cc 文件里面的代码, 解释一下这个文件里面的代码实现了什么? [Executing read_file...] AI: `code_example.cc` 文件实现了一个优化的 KMP（Knuth-Morris-Pratt）字符串匹配算法。以下是代码的主要功能和逻辑： ### 1. **算法实现** - **`getNextval` 函数**： 生成模式串 `P` 的 `nextval` 数组，用于优化 KMP 算法中的回溯过程。`nextval` 数组在匹配失败时，提供更高效的跳转位置。 - 通过比较模式串的前缀和后缀，动态更新 `nextval` 数组。 - 如果字符匹配，继续向后比较；否则，利用 `nextval` 数组跳转。 - **`KMP_optimized` 函数**： 使用 `nextval` 数组在主串 `T` 中查找模式串 `P` 的首次出现位置。 - 如果匹配成功，返回模式串在主串中的起始位置；否则返回 `-1`。 ### 2. **示例运行** - **`main` 函数**： 提供了一个示例： - 主串（`text`）：`\"ABABABABCABABABABD\"` - 模式串（`pattern`）：`\"ABABABD\"` - 调用 `KMP_optimized` 进行匹配，并输出结果。 ### 3. **优化点** - 使用 `nextval` 数组进一步减少不必要的比较，相比普通 KMP 算法更高效。 ### 4. **输出结果** 运行后会输出匹配结果，例如： 主串: ABABABABCABABABABD 模式串: ABABABD 使用 nextval 数组，匹配成功，起始位置: 9 总结：该文件实现了一个优化的 KMP 字符串搜索算法，适用于高效查找子串位置。 You: q A Step Further 下面让我们更进一步:\n使用 agent 为 write_file 函数提出修改建议 允许 agent 写入名为 README.md 的文件 允许 agent 写入文件以创建 list_file 列出文件的功能 这需要处理链式工具调用, 因为编辑文件是 read + write 的操作 对比三个文件需要 read + read + read 的操作 编辑一个不熟悉格式的文件可能需要 read + web_reasearch + list + read + write 操作 Let AI suggest the “write file” function 我们可以使用刚刚编写的 agent 来完成写入文件函数的功能:\n复制一份代码到 step4_2.py 运行 minimal-aiagent.py 提示词: 你是一名资深工程师. 请查看 step4_2.py 文件, 如何添加一个 write_file 工具让 agent 修改文件? 要确保编写的工具与文件中的代码类型匹配, 最后展示代码更改. 示例:\n% uv run minimal-aiagent.py Press q to quit You: 你是一名资深工程师. 请查看 step4_2.py 文件, 如何添加一个 write_file 工具让 agent 修改文件? 要确保编写的工具与文件中的代码类型匹配, 最后展示代码更改. [Executing read_file...] AI: 为了添加 `write_file` 工具，我们需要在 `TOOL_SPECS` 中添加一个新的工具定义，并实现 `write_file` 函数。以下是修改后的代码： import requests import os import json TOOL_SPECS = [ { \"type\": \"function\", \"function\": { \"name\": \"read_file\", \"description\": \"Read the content of a file.\", \"parameters\": { \"type\": \"object\", \"properties\": { \"path\": { \"type\": \"string\", \"description\": \"The file path to read\" } }, \"required\": [\"path\"] } } }, { \"type\": \"function\", \"function\": { \"name\": \"write_file\", \"description\": \"Write content to a file.\", \"parameters\": { \"type\": \"object\", \"properties\": { \"path\": { \"type\": \"string\", \"description\": \"The file path to write\" }, \"content\": { \"type\": \"string\", \"description\": \"The content to write\" } }, \"required\": [\"path\", \"content\"] } } } ] def read_file(path): \"\"\"Read the content of a file\"\"\" try: with open(path, \"r\") as f: content = f.read() return content except Exception as e: return f\"Error reading file: {str(e)}\" def write_file(path, content): \"\"\"Write content to a file\"\"\" try: with open(path, \"w\") as f: f.write(content) return \"File written successfully.\" except Exception as e: return f\"Error writing file: {str(e)}\" def handle_tool(tool_call): \"\"\"Execute a single tool call and return the result\"\"\" tool_name = tool_call[\"function\"][\"name\"] tool_args = json.loads(tool_call[\"function\"][\"arguments\"]) print(f\"[Executing {tool_name}...]\") if tool_name == \"read_file\": result = read_file(**tool_args) elif tool_name == \"write_file\": result = write_file(**tool_args) else: result = f\"Unknown tool: {tool_name}\" return { \"role\": \"tool\", \"tool_call_id\": tool_call[\"id\"], \"content\": result, } def call_llm(messages): api_key = \"sk-...\" headers = { \"Authorization\": f\"Bearer {api_key}\", \"Content-Type\": \"application/json\", } data = { \"model\": \"deepseek-v3\", \"messages\": messages, \"tools\": TOOL_SPECS, \"tool_choice\": \"auto\", } url = \"https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions\" try: response = requests.post(url, json=data, headers=headers) message = response.json()[\"choices\"][0][\"message\"] return message except: print(\"error\") raise Exception(\"bad\") def fake_ai(messages): latest_user_message = messages[-1][\"content\"] return f\"AI: You said {latest_user_message}... so insightful \" print(\"Press q to quit\") messages = [] while True: user_message = input(\"You: \") if user_message == \"q\": break messages.append({ \"role\": \"user\", \"content\": user_message, }) ai_message_obj = call_llm(messages) # Check if AI wants to use tools if \"tool_calls\" in ai_message_obj and ai_message_obj[\"tool_calls\"]: messages.append(ai_message_obj) for tool_call in ai_message_obj[\"tool_calls\"]: tool_result = handle_tool(tool_call) messages.append(tool_result) final_response = call_llm(messages) print(f\"AI: {final_response['content']}\") messages.append(final_response) else: print(f\"AI: {ai_message_obj['content']}\") messages.append(ai_message_obj) ### 主要变更： 1. **添加 `write_file` 工具定义**： - 在 `TOOL_SPECS` 列表中添加了一个新的工具定义，支持 `path` 和 `content` 参数。 2. **实现 `write_file` 函数**： - 新增 `write_file` 函数，用于将内容写入文件。 3. **扩展 `handle_tool` 函数**： - 在 `handle_tool` 中添加了对 `write_file` 工具的支持。 现在，Agent 可以通过调用 `write_file` 工具修改文件内容。 You: q 太棒了! 现在这个 coding agent 已经在帮助我们编写代码和改进代理本身了.\n为了确保 agent 不会错误的修改其他地方的文件, 这里通过保证修改的文件在父目录下面来改进写入文件功能\n# Define safe directory (current directory only) SAFE_DIR = os.path.abspath(os.getcwd()) def is_safe_path(path): \"\"\"Check if path is within the safe directory\"\"\" # Resolve the absolute path abs_path = os.path.abspath(path) # Check if it's within the safe directory return abs_path.startswith(SAFE_DIR) def write_file(path, content): \"\"\"Write content to a file\"\"\" if not is_safe_path(path): return f\"Error: Access denied - path outside safe directory\" try: with open(path, \"w\") as f: f.write(content) return \"File successfully written\" except Exception as e: return f\"Error writing file: {str(e)}\" 请自行判断风险\n下面冒险运行最新的 step4_2.py 代码:\n% uv run step4_2.py Press q to quit You: 向 README.md 文件中写入这段文本: \"# AI Agent 编写的这段话\" [Executing write_file...] AI: The text \"# AI Age编写的这段话\" has been successfully written to the README.md file. You: q % cat README.md ───────┬─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── │ File: README.md ───────┼─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── 1 │ # AI Age编写的这段话 ───────┴─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────── Let AI write the “list files” with recursive tool calling 让 AI 编写 list_files 方法来递归调用工具\n现在这个 coding agent 能够修改文件了, 它可以为新的 list_files 函数提出代码更改建议，并将这些更改写入磁盘. 再次强调, 注意风险.\n然而, 修改一个文件需要两个链式工具调用: 1.read 2.write 比较三个文件则需要三个链式工具调用: 1.read 2.read 3.read 重构: 递归工具调用\n# step4_3.py def handle_message(messages, ai_message_obj): # Check if AI wants to use tools if 'tool_calls' in ai_message_obj and ai_message_obj['tool_calls']: # Add AI message with tool calls messages.append(ai_message_obj) # Execute each tool and add results for tool_call in ai_message_obj['tool_calls']: tool_result = handle_tool(tool_call) messages.append(tool_result) # Get final response from AI final_response = call_llm(messages) print(f\"maybe final response: {final_response['content']}\") if 'tool_calls' in final_response and ai_message_obj['tool_calls']: handle_message(messages, final_response) else: print(f\"AI: {ai_message_obj['content']}\") messages.append(ai_message_obj) return while True: # ... ai_message_obj = call_llm(messages) handle_message(messages, ai_message_obj) 运行示例:\n% uv run step4_3.py Press q to quit You: step1.py 和 step2.py 这两个文件有什么区别? [Executing read_file...] [Executing read_file...] maybe final response: `step1.py` 和 `step2.py` 的主要区别如下： 1. **工具支持**: - `step1.py` 只支持 `read_file` 一个工具。 - `step2.py` 新增了 `write_file` 工具，支持文件的读取和写入。 2. **函数实现**: - `step2.py` 中新增了 `write_file` 函数的实现，用于写入文件内容。 3. **消息处理逻辑**: - `step1.py` 在处理工具调用时直接返回最终响应。 - `step2.py` 引入了 `handle_message` 函数，支持递归处理多轮工具调用，确保所有工具调用完成后才返回最终响应。 4. **代码结构**: - `step2.py` 的代码结构更加模块化，将消息处理逻辑封装到了 `handle_message` 函数中，提升了可读性和复用性。 总结：`step2.py` 是 `step1.py` 的扩展版本，增加了文件写入功能，并优化了工具调用的处理逻辑。 现在再来编写 list_files\n% uv run step4_3.py Press q to quit You: 阅读 step4_4.py，在 TOOL_SPEC 中为 list_files 添加相应功能，并创建执行该操作的函数。不要删除任何现有功能（例如 read file 和 write file）。你是一名资深工程师，请进行深入思考（ultrathink）。完成后，再次读取该文件以确认所有功能仍然存在：聊天循环、调用 LLM、处理工具调用， 以及所有工具（read file、write file 和新增的 list file）。 [Executing read_file...] ... [Executing write_file...] maybe final response: 现在，我将重新读取 `step4_4.py` 文件，以验证所有功能是否完整： [Executing read_file...] maybe final response: ### 验证结果： 1. **功能完整性**： - 保留了原有的 `read_file` 和 `write_file` 功能。 - 新增了 `list_files` 功能，其工具规范已添加到 `TOOL_SPECS` 中。 - 更新了 `handle_tool` 函数以支持 `list_files` 调用。 2. **代码逻辑**： - 聊天循环、LLM 调用、工具调用处理均未受影响。 - 新增的 `list_files` 函数逻辑清晰，能够正确列出目录中的文件。 3. **测试验证**： - 可以通过实际调用 `list_files` 工具验证其功能。 - 现有工具（如 `read_file` 和 `write_file`）仍可正常使用。 ### 下一步： 如果需要进一步测试或扩展功能，请随时告知！ You: q 上面可以看到, 链式调用工作了! agent 修改后对比代码的变化:\n% diff --color step4_3.py step4_4.py 42a43,59 \u003e }, \u003e { \u003e \"type\": \"function\", \u003e \"function\": { \u003e \"name\": \"list_files\", \u003e \"description\": \"List files in a directory.\", \u003e \"parameters\": { \u003e \"type\": \"object\", \u003e \"properties\": { \u003e \"directory\": { \u003e \"type\": \"string\", \u003e \"description\": \"The directory path to list files from\" \u003e } \u003e }, \u003e \"required\": [\"directory\"] \u003e } \u003e } 63a81,88 \u003e def list_files(directory): \u003e \"\"\"List files in a directory\"\"\" \u003e try: \u003e files = os.listdir(directory) \u003e return {\"files\": files} \u003e except Exception as e: \u003e return f\"Error listing files: {str(e)}\" \u003e 74a100,101 \u003e elif tool_name == \"list_files\": \u003e result = list_files(**tool_args) 81c108 \u003c \"content\": result, --- \u003e \"content\": json.dumps(result), 148c175 \u003c handle_message(messages, ai_message_obj) --- \u003e handle_message(messages, ai_message_obj) \\ No newline at end of file 然后测试新的代码\n% uv run step4_4.py Press q to quit You: 列出所有文件 [Executing list_files...] maybe final response: 当前目录下的文件有： - `code_example.cc` - `step4_4.py` - `step2.py` - `README.md` - `step4_3.py` - `step1.py` You: q 最后给出完整实现\n# step4_4.py import requests import os import json TOOL_SPECS = [ { \"type\": \"function\", \"function\": { \"name\": \"read_file\", \"description\": \"Read the content of a file.\", \"parameters\": { \"type\": \"object\", \"properties\": { \"path\": { \"type\": \"string\", \"description\": \"The file path to read\" } }, \"required\": [\"path\"] } } }, { \"type\": \"function\", \"function\": { \"name\": \"write_file\", \"description\": \"Write content to a file.\", \"parameters\": { \"type\": \"object\", \"properties\": { \"path\": { \"type\": \"string\", \"description\": \"The file path to write\" }, \"content\": { \"type\": \"string\", \"description\": \"The content to write\" } }, \"required\": [\"path\", \"content\"] } } }, { \"type\": \"function\", \"function\": { \"name\": \"list_files\", \"description\": \"List files in a directory.\", \"parameters\": { \"type\": \"object\", \"properties\": { \"directory\": { \"type\": \"string\", \"description\": \"The directory path to list files from\" } }, \"required\": [\"directory\"] } } } ] def read_file(path): \"\"\"Read the content of a file\"\"\" try: with open(path, \"r\") as f: content = f.read() return content except Exception as e: return f\"Error reading file: {str(e)}\" def write_file(path, content): \"\"\"Write content to a file\"\"\" try: with open(path, \"w\") as f: f.write(content) return \"File written successfully.\" except Exception as e: return f\"Error writing file: {str(e)}\" def list_files(directory): \"\"\"List files in a directory\"\"\" try: files = os.listdir(directory) return {\"files\": files} except Exception as e: return f\"Error listing files: {str(e)}\" def handle_tool(tool_call): \"\"\"Execute a single tool call and return the result\"\"\" tool_name = tool_call[\"function\"][\"name\"] tool_args = json.loads(tool_call[\"function\"][\"arguments\"]) print(f\"[Executing {tool_name}...]\") if tool_name == \"read_file\": result = read_file(**tool_args) elif tool_name == \"write_file\": result = write_file(**tool_args) elif tool_name == \"list_files\": result = list_files(**tool_args) else: result = f\"Unknown tool: {tool_name}\" return { \"role\": \"tool\", \"tool_call_id\": tool_call[\"id\"], \"content\": json.dumps(result), } def call_llm(messages): api_key = \"sk-...\" headers = { \"Authorization\": f\"Bearer {api_key}\", \"Content-Type\": \"application/json\", } data = { \"model\": \"deepseek-v3\", \"messages\": messages, \"tools\": TOOL_SPECS, \"tool_choice\": \"auto\", } url = \"https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions\" try: response = requests.post(url, json=data, headers=headers) message = response.json()[\"choices\"][0][\"message\"] return message except: print(\"error\") raise Exception(\"bad\") def fake_ai(messages): latest_user_message = messages[-1][\"content\"] return f\"AI: You said {latest_user_message}... so insightful \" print(\"Press q to quit\") messages = [] def handle_message(messages, ai_message_obj): \"\"\"注意: messages 会被修改\"\"\" if \"tool_calls\" in ai_message_obj and ai_message_obj[\"tool_calls\"]: # Add AI message with tool calls messages.append(ai_message_obj) # Execute each tool and add results for tool_call in ai_message_obj[\"tool_calls\"]: tool_result = handle_tool(tool_call) messages.append(tool_result) # Get final response from AI final_response = call_llm(messages) print(f\"maybe final response: {final_response['content']}\") if \"tool_calls\" in final_response and ai_message_obj[\"tool_calls\"]: handle_message(messages, final_response) else: print(f\"AI: {ai_message_obj['content']}\") messages.append(ai_message_obj) return while True: user_message = input(\"You: \") if user_message == \"q\": break messages.append({ \"role\": \"user\", \"content\": user_message, }) ai_message_obj = call_llm(messages) handle_message(messages, ai_message_obj) Summary 基础部分已经完成, 可以看到这个 coding agent 已经可以读取文件 + 修改文件 + 列出目录下所有文件, 但仍有大量的改进空间:\nagent 没有进行多步工具调用和消息循环, 如果要对比5个文件, 可能只调用两个就结束了 agent 没有规划能力, 这一般是 AI 编程助手的默认能力 没有网络搜索能力 使用 Rust 重写 ",
  "wordCount" : "2265",
  "inLanguage": "en",
  "image": "http://localhost:1313/images/og-default.avif","datePublished": "2025-09-01T08:00:00+08:00",
  "dateModified": "2025-09-01T08:00:00+08:00",
  "author":{
    "@type": "Person",
    "name": "Starslayerx"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "http://localhost:1313/posts/make-an-ai-coding-agent-in-python/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Starslayerx' Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "http://localhost:1313/favicon.svg"
    }
  }
}
</script>
</head>
<body id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Starslayerx&#39; Blog (Alt + H)">
                <img src="http://localhost:1313/favicon.svg" alt="" aria-label="logo"
                    height="35">Starslayerx&#39; Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                    <ul class="lang-switch"><li>|</li>
                        <li>
                            <a href="http://localhost:1313/zh-cn/" title="简体中文"
                                aria-label="简体中文">Zh-Cn</a>
                        </li>
                    </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="Posts">
                    <span>Posts</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="http://localhost:1313/">Home</a>&nbsp;»&nbsp;<a href="http://localhost:1313/posts/">Posts</a></div>
    <h1 class="post-title entry-hint-parent">
      Make an AI Coding Agent in python
    </h1>
    <div class="post-meta"><span title='2025-09-01 08:00:00 +0800 CST'>September 1, 2025</span>&nbsp;·&nbsp;<span>11 min</span>&nbsp;·&nbsp;<span>2265 words</span>&nbsp;·&nbsp;<span>Starslayerx</span>

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><nav id="TableOfContents">
  <ul>
    <li><a href="#minimal-ai-coding-agent">Minimal AI Coding Agent</a>
      <ul>
        <li><a href="#step-1-chat-loop">Step 1: Chat Loop</a></li>
        <li><a href="#step2-call-an-llm">Step2: Call an LLM</a></li>
        <li><a href="#step3-add-tools-to-call">Step3: Add tools to call</a></li>
        <li><a href="#step4-handle-tool-requests">Step4: Handle tool requests</a></li>
      </ul>
    </li>
    <li><a href="#a-step-further">A Step Further</a>
      <ul>
        <li><a href="#let-ai-suggest-the-write-file-function">Let AI suggest the &ldquo;write file&rdquo; function</a></li>
        <li><a href="#let-ai-write-the-list-files-with-recursive-tool-calling">Let AI write the &ldquo;list files&rdquo; with recursive tool calling</a></li>
      </ul>
    </li>
    <li><a href="#summary">Summary</a></li>
  </ul>
</nav>
        </div>
    </details>
</div>

  <div class="post-content"><p>这篇文件介绍如何使用 Python 制作一个基础的 AI 编程助手</p>
<h2 id="minimal-ai-coding-agent">Minimal AI Coding Agent<a hidden class="anchor" aria-hidden="true" href="#minimal-ai-coding-agent">#</a></h2>
<p>下面是一个 AI Coding Agent 至少需要的功能</p>
<ol>
<li>Chat loop 对话循环</li>
<li>Call an LLM 调用大语言模型</li>
<li>Add tools to call 增加工具调用</li>
<li>Handle tool request 处理工具调用请求</li>
</ol>
<h3 id="step-1-chat-loop">Step 1: Chat Loop<a hidden class="anchor" aria-hidden="true" href="#step-1-chat-loop">#</a></h3>
<p>首先, 聊天循环一直循环等待用户输入, Python 的 &ldquo;input&rdquo; 方法可以获取用户输入</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Type q to quit&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_message</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;You: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">user_message</span> <span class="o">==</span> <span class="s2">&#34;q&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">ai_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;You said </span><span class="si">{</span><span class="n">user_message</span><span class="si">}</span><span class="s2">... so insightful&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">ai_message</span><span class="p">)</span>
</span></span></code></pre></div><p>目前主流的 LLM 都是无状态的, 所以需要我们手动的去管理对话上下文, 这里使用一个 <code>fake_ai</code> 函数模拟真实的 LLM 调用, 并包含 <code>role</code> 和 <code>content</code> 内容</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="c1"># step1.py</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">fake_ai</span><span class="p">(</span><span class="n">message</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">latest_user_messages</span> <span class="o">=</span> <span class="n">messages</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="s2">&#34;content&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ai_message</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&#34;You said </span><span class="si">{</span><span class="n">latest_user_messages</span><span class="si">}</span><span class="s2">... so insightful&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;assistant&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;content&#34;</span><span class="p">:</span> <span class="n">ai_message</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Press q to quit&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">messages</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">user_message</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&#34;You: &#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">user_message</span> <span class="o">==</span> <span class="s2">&#34;q&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">break</span>
</span></span><span class="line"><span class="cl">    <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;role&#34;</span><span class="p">:</span> <span class="s2">&#34;user&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;content&#34;</span><span class="p">:</span> <span class="n">user_message</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">})</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ai_message_obj</span> <span class="o">=</span> <span class="n">fake_ai</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;AI: &#34;</span> <span class="o">+</span> <span class="n">ai_message_obj</span><span class="p">[</span><span class="s2">&#34;content&#34;</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ai_message_obj</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="step2-call-an-llm">Step2: Call an LLM<a hidden class="anchor" aria-hidden="true" href="#step2-call-an-llm">#</a></h3>
<p>现在聊天循环已经设置好了正确的 API, 下面创建 <code>llm</code> 函数来替换 <code>fake_ai</code>.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="c1"># step2.py</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">call_llm</span><span class="p">(</span><span class="n">messages</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Authorization&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;Bearer $DASHSCOPE_API_KEY&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;Content-Type&#34;</span><span class="p">:</span> <span class="s2">&#34;application/json&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">data</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;model&#34;</span><span class="p">:</span> <span class="s2">&#34;qwen-plus&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="s2">&#34;messages&#34;</span><span class="p">:</span> <span class="n">messages</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&#34;https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">json</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">message</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()[</span><span class="s2">&#34;choices&#34;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="s2">&#34;message&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">message</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;content&#34;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&#34;Error: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">    <span class="n">ai_message_obj</span> <span class="o">=</span> <span class="n">call_llm</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ... unchanged</span>
</span></span></code></pre></div><h3 id="step3-add-tools-to-call">Step3: Add tools to call<a hidden class="anchor" aria-hidden="true" href="#step3-add-tools-to-call">#</a></h3>
<p>哪些工具是需要的? 一个AI编码代理应该能够读取代码文件<br>
让我们从一个 <code>read_file</code> 工具开始. 我们要定义这个工具以及其参数, 然后将所有可用工具列表传递给 LLM, 当 LLM 认为某个响应需要调用工具, 它会返回一个内容为 <code>None</code> 的响应, 和一个要调用的工具列表.</p>
<pre tabindex="0"><code># step3.py

TOOL_SPECS = [
    {
        &#34;type&#34;: &#34;function&#34;,
        &#34;function&#34;: {
            &#34;name&#34;: &#34;read_file&#34;,
            &#34;description&#34;: &#34;Read the contents of a file&#34;,
            &#34;parameters&#34;: {
                &#34;type&#34;: &#34;object&#34;,
                &#34;properties&#34;: {
                    &#34;path&#34;: {
                        &#34;type&#34;: &#34;string&#34;,
                        &#34;description&#34;: &#34;The file path to read&#34;
                    }
                },
                &#34;required&#34;: [&#34;path&#34;]
            }
        }
    }
]

def call_llm(messages):
    data = {
        &#34;tools&#34;: TOOL_SPECS,
        &#34;tool_choice&#34;: &#34;auto&#34;,
    }

    try:
        print(&#34;Full message&#34;)
        print(message)
        return message
</code></pre><p>现在, 已经完成了将工具传递给 LLM 的部分, 但是还没有处理工具调用</p>
<h3 id="step4-handle-tool-requests">Step4: Handle tool requests<a hidden class="anchor" aria-hidden="true" href="#step4-handle-tool-requests">#</a></h3>
<p>虽然 LLM 可以请求调用, 但是需要程序来调用代码以添加上下文或执行操作. LLM 通常会向用户返回一个包含所有新增上下文的最终消息. 在这里需要:</p>
<ul>
<li>A: 检查是否存在 <code>tool_calls</code> 键</li>
<li>B: 将这条调用消息添加到消息列表</li>
<li>C: 调用用过, 并将调用结果添加到消息列表</li>
<li>D: 最后一次调用 LLM, 并传入所有的上下文</li>
</ul>
<pre tabindex="0"><code># step4.py
def handel_tool(tool_call):
    # TODO: need to call a read read_file function
    content = &#34;This secret is diving deep&#34;
    return {
        &#34;role&#34;: &#34;tool&#34;,
        &#34;tool_call_id&#34;: tool_call[&#34;id&#34;],
        &#34;content&#34;: content,
    }

while True:
    # ... unchanged
    ai_message_obj = call_llm(messages)

    # A: 判断 AI 是否想调用工具
    if &#34;tool_calls&#34; in ai_message_obj and ai_message_obj[&#34;tool_calls&#34;]:
        # B: 添加带有工具调用的 AI 信息
        messages.append(ai_message_obj)

        # C: 执行每个工具, 并获取结果
        for tool_call in ai_message_obj[&#34;tool_callls&#34;]:
            tool_result = handle_tool(tool_call)
            messages.append(tool_result)

        # D: 获取 AI 的响应
        final_response = call_llm(responses)
        print(f&#34;AI: {final_response[&#34;content&#34;]}&#34;)
        messages.append(final_response)
    else: # 默认流程
        print(f&#34;AI: {ai_message_obj[&#34;content&#34;]}&#34;)
        messages.append(ai_message_obj)
</code></pre><p>下面是工具函数, 以及执行工具的函数</p>
<pre tabindex="0"><code># step4_1.py
def read_file(path):
    &#34;&#34;&#34;读取 path 路径文件内容&#34;&#34;&#34;
    try:
        with open(path, &#34;r&#34;) as f:
            content = f.read()
    except Exception as e:
        return f&#34;Error reading file: {str(e)}&#34;

def handle_tool(tool_call):
    &#34;&#34;&#34;执行一个 tool call 并返回值&#34;&#34;&#34;
    tool_name = tool_call[&#34;function&#34;][&#34;name&#34;]
    tool_args = json.loads(tool_call[&#34;function&#34;][&#34;arguments&#34;])

    print(f&#34;[Exexuting {tool_name}...]&#34;)

    if tool_name == &#34;read_file&#34;:
        result = read_file(**tool_args)
    else:
        result = f&#34;Unknown tool: {tool_name}&#34;

    return {
        &#34;role&#34;: &#34;tool&#34;,
        &#34;tool_call_id&#34;: tool_call[&#34;id&#34;],
        &#34;content&#34;: result,
    }
</code></pre><p>恭喜! 现在所有步骤都已经完成了, 聊天循环, LLM 调用, 工具传递给 LLM 调用 并 调用工具.<br>
现在已经完成了让 AI 读取文件的功能, 然后就可以让 AI 查看我们的代码, 并给出建议.</p>
<p>完整代码实现 (仅依赖 python 标准库运行)</p>
<pre tabindex="0"><code>import requests
import os
import json

TOOL_SPECS = [
    {
        &#34;type&#34;: &#34;function&#34;,
        &#34;function&#34;: {
            &#34;name&#34;: &#34;read_file&#34;,
            &#34;description&#34;: &#34;Read the content of a file.&#34;,
            &#34;parameters&#34;: {
                &#34;type&#34;: &#34;object&#34;,
                &#34;properties&#34;:{
                    &#34;path&#34;: {
                        &#34;type&#34;: &#34;string&#34;,
                        &#34;description&#34;: &#34;The file path to read&#34;
                    }
                },
                &#34;required&#34;: [&#34;path&#34;]
            }
        }
    }
]

def read_file(path):
    &#34;&#34;&#34;Read the content of a file&#34;&#34;&#34;
    try:
        with open(path, &#34;r&#34;) as f:
            content = f.read()
        return content
    except Exception as e:
        return f&#34;Error reading file: {str(e)}&#34;

def handle_tool(tool_call):
    &#34;&#34;&#34;Execute a single tool call and return the result&#34;&#34;&#34;
    tool_name = tool_call[&#34;function&#34;][&#34;name&#34;]
    tool_args = json.loads(tool_call[&#34;function&#34;][&#34;arguments&#34;])

    print(f&#34;[Executing {tool_name}...]&#34;)

    if tool_name == &#34;read_file&#34;:
        result = read_file(**tool_args)
    else:
        result = f&#34;Unknow tool: {tool_name}&#34;

    return {
        &#34;role&#34;: &#34;tool&#34;,
        &#34;tool_call_id&#34;: tool_call[&#34;id&#34;],
        &#34;content&#34;: result,
    }

def call_llm(messages):
    api_key = &#34;sk-...&#34;
    headers = {
        &#34;Authorization&#34;: f&#34;Bearer {api_key}&#34;,
        &#34;Content-Type&#34;: &#34;application/json&#34;,
    }

    data = {
        &#34;model&#34;: &#34;deepseek-v3&#34;,
        &#34;messages&#34;: messages,
        &#34;tools&#34;: TOOL_SPECS,
        &#34;tool_choice&#34;: &#34;auto&#34;,
    }

    url = &#34;https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions&#34;

    try:
        response = requests.post(url, json=data, headers=headers)
        message = response.json()[&#34;choices&#34;][0][&#34;message&#34;]
        return message
    except:
        print(&#34;error&#34;)
        raise Exception(&#34;bad&#34;)

def fake_ai(messages):
    latest_user_message = messages[-1][&#34;content&#34;]
    return f&#34;AI: You said {latest_user_message}... so insightful &#34;

print(&#34;Press q to quit&#34;)
messages = []

while True:
    user_message = input(&#34;You: &#34;)
    if user_message == &#34;q&#34;:
        break

    messages.append({
        &#34;role&#34;: &#34;user&#34;,
        &#34;content&#34;: user_message,
    })

    ai_message_obj = call_llm(messages)

    # Check if AI wants to use tools
    if &#34;tool_calls&#34; in ai_message_obj and ai_message_obj[&#34;tool_calls&#34;]:
        messages.append(ai_message_obj)

        for tool_call in ai_message_obj[&#34;tool_calls&#34;]:
            tool_result = handle_tool(tool_call)
            messages.append(tool_result)

        final_response = call_llm(messages)
        print(f&#34;AI: {final_response[&#34;content&#34;]}&#34;)
        messages.append(final_response)
    else:
        print(f&#34;AI: {ai_message_obj[&#34;content&#34;]}&#34;)
        messages.append(ai_message_obj)
</code></pre><p>运行示例:</p>
<pre tabindex="0"><code>% uv run minimal-aiagent.py
Press q to quit
You: 你好, 介绍一下你自己.
AI: 你好！我是一个智能助手，可以帮助你回答各种问题、提供建议或执行一些任务。无论是学习、工作还是日常生活相关的问题，你都可以问我。我没有 实体，但可以通过文字与你交流。请问有什么可以帮你的吗？
You: 读取一下 code_example.cc 文件里面的代码, 解释一下这个文件里面的代码实现了什么?
[Executing read_file...]
AI: `code_example.cc` 文件实现了一个优化的 KMP（Knuth-Morris-Pratt）字符串匹配算法。以下是代码的主要功能和逻辑：

### 1. **算法实现**
- **`getNextval` 函数**：
  生成模式串 `P` 的 `nextval` 数组，用于优化 KMP 算法中的回溯过程。`nextval` 数组在匹配失败时，提供更高效的跳转位置。
  - 通过比较模式串的前缀和后缀，动态更新 `nextval` 数组。
  - 如果字符匹配，继续向后比较；否则，利用 `nextval` 数组跳转。

- **`KMP_optimized` 函数**：
  使用 `nextval` 数组在主串 `T` 中查找模式串 `P` 的首次出现位置。
  - 如果匹配成功，返回模式串在主串中的起始位置；否则返回 `-1`。

### 2. **示例运行**
- **`main` 函数**：
  提供了一个示例：
  - 主串（`text`）：`&#34;ABABABABCABABABABD&#34;`
  - 模式串（`pattern`）：`&#34;ABABABD&#34;`
  - 调用 `KMP_optimized` 进行匹配，并输出结果。

### 3. **优化点**
- 使用 `nextval` 数组进一步减少不必要的比较，相比普通 KMP 算法更高效。

### 4. **输出结果**
运行后会输出匹配结果，例如：
主串: ABABABABCABABABABD
模式串: ABABABD
使用 nextval 数组，匹配成功，起始位置: 9

总结：该文件实现了一个优化的 KMP 字符串搜索算法，适用于高效查找子串位置。
You: q
</code></pre><h2 id="a-step-further">A Step Further<a hidden class="anchor" aria-hidden="true" href="#a-step-further">#</a></h2>
<p>下面让我们更进一步:</p>
<ul>
<li>使用 agent 为 <code>write_file</code> 函数提出修改建议</li>
<li>允许 agent 写入名为 <code>README.md</code> 的文件</li>
<li>允许 agent 写入文件以创建 <code>list_file</code> 列出文件的功能
<ul>
<li>这需要处理链式工具调用, 因为编辑文件是 <code>read + write</code> 的操作</li>
<li>对比三个文件需要 <code>read + read + read</code> 的操作</li>
<li>编辑一个不熟悉格式的文件可能需要 <code>read + web_reasearch + list + read + write</code> 操作</li>
</ul>
</li>
</ul>
<h3 id="let-ai-suggest-the-write-file-function">Let AI suggest the &ldquo;write file&rdquo; function<a hidden class="anchor" aria-hidden="true" href="#let-ai-suggest-the-write-file-function">#</a></h3>
<p>我们可以使用刚刚编写的 agent 来完成写入文件函数的功能:</p>
<ul>
<li>复制一份代码到 <code>step4_2.py</code></li>
<li>运行 <code>minimal-aiagent.py</code></li>
<li>提示词: <code>你是一名资深工程师. 请查看 step4_2.py 文件, 如何添加一个 write_file 工具让 agent 修改文件? 要确保编写的工具与文件中的代码类型匹配, 最后展示代码更改.</code></li>
</ul>
<p>示例:</p>
<pre tabindex="0"><code>% uv run minimal-aiagent.py
Press q to quit
You: 你是一名资深工程师. 请查看 step4_2.py 文件, 如何添加一个 write_file 工具让 agent 修改文件? 要确保编写的工具与文件中的代码类型匹配,  最后展示代码更改.
[Executing read_file...]
AI: 为了添加 `write_file` 工具，我们需要在 `TOOL_SPECS` 中添加一个新的工具定义，并实现 `write_file` 函数。以下是修改后的代码：

import requests
import os
import json

TOOL_SPECS = [
    {
        &#34;type&#34;: &#34;function&#34;,
        &#34;function&#34;: {
            &#34;name&#34;: &#34;read_file&#34;,
            &#34;description&#34;: &#34;Read the content of a file.&#34;,
            &#34;parameters&#34;: {
                &#34;type&#34;: &#34;object&#34;,
                &#34;properties&#34;: {
                    &#34;path&#34;: {
                        &#34;type&#34;: &#34;string&#34;,
                        &#34;description&#34;: &#34;The file path to read&#34;
                    }
                },
                &#34;required&#34;: [&#34;path&#34;]
            }
        }
    },
    {
        &#34;type&#34;: &#34;function&#34;,
        &#34;function&#34;: {
            &#34;name&#34;: &#34;write_file&#34;,
            &#34;description&#34;: &#34;Write content to a file.&#34;,
            &#34;parameters&#34;: {
                &#34;type&#34;: &#34;object&#34;,
                &#34;properties&#34;: {
                    &#34;path&#34;: {
                        &#34;type&#34;: &#34;string&#34;,
                        &#34;description&#34;: &#34;The file path to write&#34;
                    },
                    &#34;content&#34;: {
                        &#34;type&#34;: &#34;string&#34;,
                        &#34;description&#34;: &#34;The content to write&#34;
                    }
                },
                &#34;required&#34;: [&#34;path&#34;, &#34;content&#34;]
            }
        }
    }
]

def read_file(path):
    &#34;&#34;&#34;Read the content of a file&#34;&#34;&#34;
    try:
        with open(path, &#34;r&#34;) as f:
            content = f.read()
        return content
    except Exception as e:
        return f&#34;Error reading file: {str(e)}&#34;

def write_file(path, content):
    &#34;&#34;&#34;Write content to a file&#34;&#34;&#34;
    try:
        with open(path, &#34;w&#34;) as f:
            f.write(content)
        return &#34;File written successfully.&#34;
    except Exception as e:
        return f&#34;Error writing file: {str(e)}&#34;

def handle_tool(tool_call):
    &#34;&#34;&#34;Execute a single tool call and return the result&#34;&#34;&#34;
    tool_name = tool_call[&#34;function&#34;][&#34;name&#34;]
    tool_args = json.loads(tool_call[&#34;function&#34;][&#34;arguments&#34;])

    print(f&#34;[Executing {tool_name}...]&#34;)

    if tool_name == &#34;read_file&#34;:
        result = read_file(**tool_args)
    elif tool_name == &#34;write_file&#34;:
        result = write_file(**tool_args)
    else:
        result = f&#34;Unknown tool: {tool_name}&#34;

    return {
        &#34;role&#34;: &#34;tool&#34;,
        &#34;tool_call_id&#34;: tool_call[&#34;id&#34;],
        &#34;content&#34;: result,
    }

def call_llm(messages):
    api_key = &#34;sk-...&#34;
    headers = {
        &#34;Authorization&#34;: f&#34;Bearer {api_key}&#34;,
        &#34;Content-Type&#34;: &#34;application/json&#34;,
    }

    data = {
        &#34;model&#34;: &#34;deepseek-v3&#34;,
        &#34;messages&#34;: messages,
        &#34;tools&#34;: TOOL_SPECS,
        &#34;tool_choice&#34;: &#34;auto&#34;,
    }

    url = &#34;https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions&#34;

    try:
        response = requests.post(url, json=data, headers=headers)
        message = response.json()[&#34;choices&#34;][0][&#34;message&#34;]
        return message
    except:
        print(&#34;error&#34;)
        raise Exception(&#34;bad&#34;)

def fake_ai(messages):
    latest_user_message = messages[-1][&#34;content&#34;]
    return f&#34;AI: You said {latest_user_message}... so insightful &#34;

print(&#34;Press q to quit&#34;)
messages = []

while True:
    user_message = input(&#34;You: &#34;)
    if user_message == &#34;q&#34;:
        break

    messages.append({
        &#34;role&#34;: &#34;user&#34;,
        &#34;content&#34;: user_message,
    })

    ai_message_obj = call_llm(messages)

    # Check if AI wants to use tools
    if &#34;tool_calls&#34; in ai_message_obj and ai_message_obj[&#34;tool_calls&#34;]:
        messages.append(ai_message_obj)

        for tool_call in ai_message_obj[&#34;tool_calls&#34;]:
            tool_result = handle_tool(tool_call)
            messages.append(tool_result)

        final_response = call_llm(messages)
        print(f&#34;AI: {final_response[&#39;content&#39;]}&#34;)
        messages.append(final_response)
    else:
        print(f&#34;AI: {ai_message_obj[&#39;content&#39;]}&#34;)
        messages.append(ai_message_obj)

### 主要变更：
1. **添加 `write_file` 工具定义**：
   - 在 `TOOL_SPECS` 列表中添加了一个新的工具定义，支持 `path` 和 `content` 参数。
2. **实现 `write_file` 函数**：
   - 新增 `write_file` 函数，用于将内容写入文件。
3. **扩展 `handle_tool` 函数**：
   - 在 `handle_tool` 中添加了对 `write_file` 工具的支持。

现在，Agent 可以通过调用 `write_file` 工具修改文件内容。
You: q
</code></pre><p>太棒了! 现在这个 coding agent 已经在帮助我们编写代码和改进代理本身了.<br>
为了确保 agent 不会错误的修改其他地方的文件, 这里通过保证修改的文件在父目录下面来改进写入文件功能</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="c1"># Define safe directory (current directory only)</span>
</span></span><span class="line"><span class="cl"><span class="n">SAFE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">is_safe_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Check if path is within the safe directory&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Resolve the absolute path</span>
</span></span><span class="line"><span class="cl">    <span class="n">abs_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Check if it&#39;s within the safe directory</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">abs_path</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">SAFE_DIR</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">write_file</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">content</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="s2">&#34;&#34;&#34;Write content to a file&#34;&#34;&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">is_safe_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;Error: Access denied - path outside safe directory&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s2">&#34;w&#34;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">content</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="s2">&#34;File successfully written&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="sa">f</span><span class="s2">&#34;Error writing file: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&#34;</span>
</span></span></code></pre></div><p><strong>请自行判断风险</strong></p>
<p>下面冒险运行最新的 <code>step4_2.py</code> 代码:</p>
<pre tabindex="0"><code>% uv run step4_2.py
Press q to quit
You: 向 README.md  文件中写入这段文本: &#34;# AI Agent 编写的这段话&#34;
[Executing write_file...]
AI: The text &#34;# AI Age编写的这段话&#34; has been successfully written to the README.md file.
You: q

% cat README.md
───────┬───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
       │ File: README.md
───────┼───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
   1   │ # AI Age编写的这段话
───────┴───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────
</code></pre><h3 id="let-ai-write-the-list-files-with-recursive-tool-calling">Let AI write the &ldquo;list files&rdquo; with recursive tool calling<a hidden class="anchor" aria-hidden="true" href="#let-ai-write-the-list-files-with-recursive-tool-calling">#</a></h3>
<p>让 AI 编写 <code>list_files</code> 方法来递归调用工具<br>
现在这个 coding agent 能够修改文件了, 它可以为新的 <code>list_files</code> 函数提出代码更改建议，并将这些更改写入磁盘.
再次强调, 注意风险.</p>
<ul>
<li>然而, 修改一个文件需要两个链式工具调用: 1.read 2.write</li>
<li>比较三个文件则需要三个链式工具调用: 1.read 2.read 3.read</li>
</ul>
<p><strong>重构: 递归工具调用</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="c1"># step4_3.py</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">handle_message</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="n">ai_message_obj</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># Check if AI wants to use tools</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="s1">&#39;tool_calls&#39;</span> <span class="ow">in</span> <span class="n">ai_message_obj</span> <span class="ow">and</span> <span class="n">ai_message_obj</span><span class="p">[</span><span class="s1">&#39;tool_calls&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Add AI message with tool calls</span>
</span></span><span class="line"><span class="cl">        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ai_message_obj</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Execute each tool and add results</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">tool_call</span> <span class="ow">in</span> <span class="n">ai_message_obj</span><span class="p">[</span><span class="s1">&#39;tool_calls&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">tool_result</span> <span class="o">=</span> <span class="n">handle_tool</span><span class="p">(</span><span class="n">tool_call</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tool_result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Get final response from AI</span>
</span></span><span class="line"><span class="cl">        <span class="n">final_response</span> <span class="o">=</span> <span class="n">call_llm</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;maybe final response: </span><span class="si">{</span><span class="n">final_response</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="s1">&#39;tool_calls&#39;</span> <span class="ow">in</span> <span class="n">final_response</span> <span class="ow">and</span> <span class="n">ai_message_obj</span><span class="p">[</span><span class="s1">&#39;tool_calls&#39;</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">handle_message</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="n">final_response</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;AI: </span><span class="si">{</span><span class="n">ai_message_obj</span><span class="p">[</span><span class="s1">&#39;content&#39;</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">messages</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ai_message_obj</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># ...</span>
</span></span><span class="line"><span class="cl">    <span class="n">ai_message_obj</span> <span class="o">=</span> <span class="n">call_llm</span><span class="p">(</span><span class="n">messages</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">handle_message</span><span class="p">(</span><span class="n">messages</span><span class="p">,</span> <span class="n">ai_message_obj</span><span class="p">)</span>
</span></span></code></pre></div><p>运行示例:</p>
<pre tabindex="0"><code>% uv run step4_3.py
Press q to quit
You: step1.py 和 step2.py 这两个文件有什么区别?
[Executing read_file...]
[Executing read_file...]
maybe final response: `step1.py` 和 `step2.py` 的主要区别如下：

1. **工具支持**:
   - `step1.py` 只支持 `read_file` 一个工具。
   - `step2.py` 新增了 `write_file` 工具，支持文件的读取和写入。

2. **函数实现**:
   - `step2.py` 中新增了 `write_file` 函数的实现，用于写入文件内容。

3. **消息处理逻辑**:
   - `step1.py` 在处理工具调用时直接返回最终响应。
   - `step2.py` 引入了 `handle_message` 函数，支持递归处理多轮工具调用，确保所有工具调用完成后才返回最终响应。

4. **代码结构**:
   - `step2.py` 的代码结构更加模块化，将消息处理逻辑封装到了 `handle_message` 函数中，提升了可读性和复用性。

总结：`step2.py` 是 `step1.py` 的扩展版本，增加了文件写入功能，并优化了工具调用的处理逻辑。
</code></pre><p>现在再来编写 <code>list_files</code></p>
<pre tabindex="0"><code>% uv run step4_3.py
Press q to quit
You: 阅读 step4_4.py，在 TOOL_SPEC 中为 list_files 添加相应功能，并创建执行该操作的函数。不要删除任何现有功能（例如 read file 和 write file）。你是一名资深工程师，请进行深入思考（ultrathink）。完成后，再次读取该文件以确认所有功能仍然存在：聊天循环、调用 LLM、处理工具调用， 以及所有工具（read file、write file 和新增的 list file）。
[Executing read_file...]
...
[Executing write_file...]
maybe final response: 现在，我将重新读取 `step4_4.py` 文件，以验证所有功能是否完整：
[Executing read_file...]
maybe final response: ### 验证结果：
1. **功能完整性**：
   - 保留了原有的 `read_file` 和 `write_file` 功能。
   - 新增了 `list_files` 功能，其工具规范已添加到 `TOOL_SPECS` 中。
   - 更新了 `handle_tool` 函数以支持 `list_files` 调用。

2. **代码逻辑**：
   - 聊天循环、LLM 调用、工具调用处理均未受影响。
   - 新增的 `list_files` 函数逻辑清晰，能够正确列出目录中的文件。

3. **测试验证**：
   - 可以通过实际调用 `list_files` 工具验证其功能。
   - 现有工具（如 `read_file` 和 `write_file`）仍可正常使用。

### 下一步：
如果需要进一步测试或扩展功能，请随时告知！
You: q
</code></pre><p>上面可以看到, 链式调用工作了! agent 修改后对比代码的变化:</p>
<pre tabindex="0"><code>% diff --color step4_3.py step4_4.py
42a43,59
&gt;     },
&gt;     {
&gt;         &#34;type&#34;: &#34;function&#34;,
&gt;         &#34;function&#34;: {
&gt;             &#34;name&#34;: &#34;list_files&#34;,
&gt;             &#34;description&#34;: &#34;List files in a directory.&#34;,
&gt;             &#34;parameters&#34;: {
&gt;                 &#34;type&#34;: &#34;object&#34;,
&gt;                 &#34;properties&#34;: {
&gt;                     &#34;directory&#34;: {
&gt;                         &#34;type&#34;: &#34;string&#34;,
&gt;                         &#34;description&#34;: &#34;The directory path to list files from&#34;
&gt;                     }
&gt;                 },
&gt;                 &#34;required&#34;: [&#34;directory&#34;]
&gt;             }
&gt;         }
63a81,88
&gt; def list_files(directory):
&gt;     &#34;&#34;&#34;List files in a directory&#34;&#34;&#34;
&gt;     try:
&gt;         files = os.listdir(directory)
&gt;         return {&#34;files&#34;: files}
&gt;     except Exception as e:
&gt;         return f&#34;Error listing files: {str(e)}&#34;
&gt;
74a100,101
&gt;     elif tool_name == &#34;list_files&#34;:
&gt;         result = list_files(**tool_args)
81c108
&lt;         &#34;content&#34;: result,
---
&gt;         &#34;content&#34;: json.dumps(result),
148c175
&lt;     handle_message(messages, ai_message_obj)
---
&gt;     handle_message(messages, ai_message_obj)
\ No newline at end of file
</code></pre><p>然后测试新的代码</p>
<pre tabindex="0"><code>% uv run step4_4.py
Press q to quit
You: 列出所有文件
[Executing list_files...]
maybe final response: 当前目录下的文件有：

- `code_example.cc`
- `step4_4.py`
- `step2.py`
- `README.md`
- `step4_3.py`
- `step1.py`
You: q
</code></pre><p>最后给出完整实现</p>
<pre tabindex="0"><code># step4_4.py
import requests
import os
import json

TOOL_SPECS = [
    {
        &#34;type&#34;: &#34;function&#34;,
        &#34;function&#34;: {
            &#34;name&#34;: &#34;read_file&#34;,
            &#34;description&#34;: &#34;Read the content of a file.&#34;,
            &#34;parameters&#34;: {
                &#34;type&#34;: &#34;object&#34;,
                &#34;properties&#34;: {
                    &#34;path&#34;: {
                        &#34;type&#34;: &#34;string&#34;,
                        &#34;description&#34;: &#34;The file path to read&#34;
                    }
                },
                &#34;required&#34;: [&#34;path&#34;]
            }
        }
    },
    {
        &#34;type&#34;: &#34;function&#34;,
        &#34;function&#34;: {
            &#34;name&#34;: &#34;write_file&#34;,
            &#34;description&#34;: &#34;Write content to a file.&#34;,
            &#34;parameters&#34;: {
                &#34;type&#34;: &#34;object&#34;,
                &#34;properties&#34;: {
                    &#34;path&#34;: {
                        &#34;type&#34;: &#34;string&#34;,
                        &#34;description&#34;: &#34;The file path to write&#34;
                    },
                    &#34;content&#34;: {
                        &#34;type&#34;: &#34;string&#34;,
                        &#34;description&#34;: &#34;The content to write&#34;
                    }
                },
                &#34;required&#34;: [&#34;path&#34;, &#34;content&#34;]
            }
        }
    },
    {
        &#34;type&#34;: &#34;function&#34;,
        &#34;function&#34;: {
            &#34;name&#34;: &#34;list_files&#34;,
            &#34;description&#34;: &#34;List files in a directory.&#34;,
            &#34;parameters&#34;: {
                &#34;type&#34;: &#34;object&#34;,
                &#34;properties&#34;: {
                    &#34;directory&#34;: {
                        &#34;type&#34;: &#34;string&#34;,
                        &#34;description&#34;: &#34;The directory path to list files from&#34;
                    }
                },
                &#34;required&#34;: [&#34;directory&#34;]
            }
        }
    }
]

def read_file(path):
    &#34;&#34;&#34;Read the content of a file&#34;&#34;&#34;
    try:
        with open(path, &#34;r&#34;) as f:
            content = f.read()
        return content
    except Exception as e:
        return f&#34;Error reading file: {str(e)}&#34;

def write_file(path, content):
    &#34;&#34;&#34;Write content to a file&#34;&#34;&#34;
    try:
        with open(path, &#34;w&#34;) as f:
            f.write(content)
        return &#34;File written successfully.&#34;
    except Exception as e:
        return f&#34;Error writing file: {str(e)}&#34;

def list_files(directory):
    &#34;&#34;&#34;List files in a directory&#34;&#34;&#34;
    try:
        files = os.listdir(directory)
        return {&#34;files&#34;: files}
    except Exception as e:
        return f&#34;Error listing files: {str(e)}&#34;

def handle_tool(tool_call):
    &#34;&#34;&#34;Execute a single tool call and return the result&#34;&#34;&#34;
    tool_name = tool_call[&#34;function&#34;][&#34;name&#34;]
    tool_args = json.loads(tool_call[&#34;function&#34;][&#34;arguments&#34;])

    print(f&#34;[Executing {tool_name}...]&#34;)

    if tool_name == &#34;read_file&#34;:
        result = read_file(**tool_args)
    elif tool_name == &#34;write_file&#34;:
        result = write_file(**tool_args)
    elif tool_name == &#34;list_files&#34;:
        result = list_files(**tool_args)
    else:
        result = f&#34;Unknown tool: {tool_name}&#34;

    return {
        &#34;role&#34;: &#34;tool&#34;,
        &#34;tool_call_id&#34;: tool_call[&#34;id&#34;],
        &#34;content&#34;: json.dumps(result),
    }

def call_llm(messages):
    api_key = &#34;sk-...&#34;
    headers = {
        &#34;Authorization&#34;: f&#34;Bearer {api_key}&#34;,
        &#34;Content-Type&#34;: &#34;application/json&#34;,
    }

    data = {
        &#34;model&#34;: &#34;deepseek-v3&#34;,
        &#34;messages&#34;: messages,
        &#34;tools&#34;: TOOL_SPECS,
        &#34;tool_choice&#34;: &#34;auto&#34;,
    }

    url = &#34;https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions&#34;

    try:
        response = requests.post(url, json=data, headers=headers)
        message = response.json()[&#34;choices&#34;][0][&#34;message&#34;]
        return message
    except:
        print(&#34;error&#34;)
        raise Exception(&#34;bad&#34;)

def fake_ai(messages):
    latest_user_message = messages[-1][&#34;content&#34;]
    return f&#34;AI: You said {latest_user_message}... so insightful &#34;

print(&#34;Press q to quit&#34;)
messages = []

def handle_message(messages, ai_message_obj):
    &#34;&#34;&#34;注意: messages 会被修改&#34;&#34;&#34;
    if &#34;tool_calls&#34; in ai_message_obj and ai_message_obj[&#34;tool_calls&#34;]:
        # Add AI message with tool calls
        messages.append(ai_message_obj)

        # Execute each tool and add results
        for tool_call in ai_message_obj[&#34;tool_calls&#34;]:
            tool_result = handle_tool(tool_call)
            messages.append(tool_result)

        # Get final response from AI
        final_response = call_llm(messages)
        print(f&#34;maybe final response: {final_response[&#39;content&#39;]}&#34;)
        if &#34;tool_calls&#34; in final_response and ai_message_obj[&#34;tool_calls&#34;]:
            handle_message(messages, final_response)
    else:
        print(f&#34;AI: {ai_message_obj[&#39;content&#39;]}&#34;)
        messages.append(ai_message_obj)
        return


while True:
    user_message = input(&#34;You: &#34;)
    if user_message == &#34;q&#34;:
        break

    messages.append({
        &#34;role&#34;: &#34;user&#34;,
        &#34;content&#34;: user_message,
    })

    ai_message_obj = call_llm(messages)
    handle_message(messages, ai_message_obj)
</code></pre><h2 id="summary">Summary<a hidden class="anchor" aria-hidden="true" href="#summary">#</a></h2>
<p>基础部分已经完成, 可以看到这个 coding agent 已经可以读取文件 + 修改文件 + 列出目录下所有文件, 但仍有大量的改进空间:</p>
<ul>
<li>agent 没有进行多步工具调用和消息循环, 如果要对比5个文件, 可能只调用两个就结束了</li>
<li>agent 没有规划能力, 这一般是 AI 编程助手的默认能力</li>
<li>没有网络搜索能力</li>
<li>使用 Rust 重写</li>
</ul>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="http://localhost:1313/tags/llms/">LLMs</a></li>
      <li><a href="http://localhost:1313/tags/agent/">Agent</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="http://localhost:1313/posts/how-ai-assistants-make-precise-edits-to-your-files/">
    <span class="title">« Prev</span>
    <br>
    <span>How AI Assistants Make Precise Edits to Your Files</span>
  </a>
  <a class="next" href="http://localhost:1313/posts/kmp-algorithm/">
    <span class="title">Next »</span>
    <br>
    <span>KMP Algorithm</span>
  </a>
</nav>


<ul class="share-buttons">
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Make an AI Coding Agent in python on x"
            href="https://x.com/intent/tweet/?text=Make%20an%20AI%20Coding%20Agent%20in%20python&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fmake-an-ai-coding-agent-in-python%2f&amp;hashtags=LLMs%2cAgent">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M512 62.554 L 512 449.446 C 512 483.97 483.97 512 449.446 512 L 62.554 512 C 28.03 512 0 483.97 0 449.446 L 0 62.554 C 0 28.03 28.029 0 62.554 0 L 449.446 0 C 483.971 0 512 28.03 512 62.554 Z M 269.951 190.75 L 182.567 75.216 L 56 75.216 L 207.216 272.95 L 63.9 436.783 L 125.266 436.783 L 235.9 310.383 L 332.567 436.783 L 456 436.783 L 298.367 228.367 L 432.367 75.216 L 371.033 75.216 Z M 127.633 110 L 164.101 110 L 383.481 400.065 L 349.5 400.065 Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Make an AI Coding Agent in python on linkedin"
            href="https://www.linkedin.com/shareArticle?mini=true&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fmake-an-ai-coding-agent-in-python%2f&amp;title=Make%20an%20AI%20Coding%20Agent%20in%20python&amp;summary=Make%20an%20AI%20Coding%20Agent%20in%20python&amp;source=http%3a%2f%2flocalhost%3a1313%2fposts%2fmake-an-ai-coding-agent-in-python%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Make an AI Coding Agent in python on reddit"
            href="https://reddit.com/submit?url=http%3a%2f%2flocalhost%3a1313%2fposts%2fmake-an-ai-coding-agent-in-python%2f&title=Make%20an%20AI%20Coding%20Agent%20in%20python">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Make an AI Coding Agent in python on facebook"
            href="https://facebook.com/sharer/sharer.php?u=http%3a%2f%2flocalhost%3a1313%2fposts%2fmake-an-ai-coding-agent-in-python%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Make an AI Coding Agent in python on whatsapp"
            href="https://api.whatsapp.com/send?text=Make%20an%20AI%20Coding%20Agent%20in%20python%20-%20http%3a%2f%2flocalhost%3a1313%2fposts%2fmake-an-ai-coding-agent-in-python%2f">
            <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve" height="30px" width="30px" fill="currentColor">
                <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Make an AI Coding Agent in python on telegram"
            href="https://telegram.me/share/url?text=Make%20an%20AI%20Coding%20Agent%20in%20python&amp;url=http%3a%2f%2flocalhost%3a1313%2fposts%2fmake-an-ai-coding-agent-in-python%2f">
            <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28" height="30px" width="30px" fill="currentColor">
                <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
            </svg>
        </a>
    </li>
    <li>
        <a target="_blank" rel="noopener noreferrer" aria-label="share Make an AI Coding Agent in python on ycombinator"
            href="https://news.ycombinator.com/submitlink?t=Make%20an%20AI%20Coding%20Agent%20in%20python&u=http%3a%2f%2flocalhost%3a1313%2fposts%2fmake-an-ai-coding-agent-in-python%2f">
            <svg version="1.1" xml:space="preserve" width="30px" height="30px" viewBox="0 0 512 512" fill="currentColor"
                xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape">
                <path
                    d="M449.446 0C483.971 0 512 28.03 512 62.554L512 449.446C512 483.97 483.97 512 449.446 512L62.554 512C28.03 512 0 483.97 0 449.446L0 62.554C0 28.03 28.029 0 62.554 0L449.446 0ZM183.8767 87.9921H121.8427L230.6673 292.4508V424.0079H281.3328V292.4508L390.1575 87.9921H328.1233L256 238.2489z" />
            </svg>
        </a>
    </li>
</ul>

  </footer>
</article>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">Starslayerx&#39; Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerHTML = 'copy';

        function copyingDone() {
            copybutton.innerHTML = 'copied!';
            setTimeout(() => {
                copybutton.innerHTML = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                navigator.clipboard.writeText(codeblock.textContent);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) { };
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild == container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName == "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>
</body>

</html>
