<!DOCTYPE html>
<html lang="en" dir="auto" data-theme="auto">

<head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>Posts | Starslayerx&#39; Blog</title>
<meta name="keywords" content="">
<meta name="description" content="Posts - Starslayerx&#39; Blog">
<meta name="author" content="Starslayerx">
<link rel="canonical" href="http://localhost:1313/posts/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.da3211e5ef867bf2b75fd5a6515cfed7195c011e8ab735694e203810a827097b.css" integrity="sha256-2jIR5e&#43;Ge/K3X9WmUVz&#43;1xlcAR6KtzVpTiA4EKgnCXs=" rel="preload stylesheet" as="style">
<link rel="icon" href="http://localhost:1313/favicon.svg">
<link rel="icon" type="image/png" sizes="16x16" href="http://localhost:1313/favicon.svg">
<link rel="icon" type="image/png" sizes="32x32" href="http://localhost:1313/favicon.svg">
<link rel="apple-touch-icon" href="http://localhost:1313/favicon.svg">
<link rel="mask-icon" href="http://localhost:1313/favicon.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" type="application/rss+xml" href="http://localhost:1313/posts/index.xml" title="rss">
<link rel="alternate" hreflang="en" href="http://localhost:1313/posts/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
                color-scheme: dark;
            }

            .list {
                background: var(--theme);
            }

            .toc {
                background: var(--entry);
            }
        }

        @media (prefers-color-scheme: light) {
            .list::-webkit-scrollbar-thumb {
                border-color: var(--code-bg);
            }
        }

    </style>
</noscript>
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.querySelector("html").dataset.theme = 'dark';
    } else if (localStorage.getItem("pref-theme") === "light") {
       document.querySelector("html").dataset.theme = 'light';
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.querySelector("html").dataset.theme = 'dark';
    } else {
        document.querySelector("html").dataset.theme = 'light';
    }

</script><meta property="og:url" content="http://localhost:1313/posts/">
  <meta property="og:site_name" content="Starslayerx&#39; Blog">
  <meta property="og:title" content="Posts">
  <meta property="og:description" content="A personal blog about technology, programming, and daily notes">
  <meta property="og:locale" content="en-US">
  <meta property="og:type" content="website">
      <meta property="og:image" content="http://localhost:1313/images/og-default.avif">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://localhost:1313/images/og-default.avif">
<meta name="twitter:title" content="Posts">
<meta name="twitter:description" content="A personal blog about technology, programming, and daily notes">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "http://localhost:1313/posts/"
    }
  ]
}
</script>
</head>
<body class="list" id="top">
    <header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="http://localhost:1313/" accesskey="h" title="Starslayerx&#39; Blog (Alt + H)">
                <img src="http://localhost:1313/favicon.svg" alt="" aria-label="logo"
                    height="35">Starslayerx&#39; Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)" aria-label="Toggle theme">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
                    <ul class="lang-switch"><li>|</li>
                        <li>
                            <a href="http://localhost:1313/zh-cn/" title="简体中文"
                                aria-label="简体中文">Zh-Cn</a>
                        </li>
                    </ul>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="http://localhost:1313/posts/" title="Posts">
                    <span class="active">Posts</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/archives/" title="Archives">
                    <span>Archives</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/categories/" title="Categories">
                    <span>Categories</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/tags/" title="Tags">
                    <span>Tags</span>
                </a>
            </li>
            <li>
                <a href="http://localhost:1313/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main"> 
<header class="page-header"><div class="breadcrumbs"><a href="http://localhost:1313/">Home</a></div>
  <h1>
    Posts
    <a href="/posts/index.xml" title="RSS" aria-label="RSS">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
        stroke-linecap="round" stroke-linejoin="round" height="23">
        <path d="M4 11a9 9 0 0 1 9 9" />
        <path d="M4 4a16 16 0 0 1 16 16" />
        <circle cx="5" cy="19" r="1" />
      </svg>
    </a>
  </h1>
</header>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">FastAPI Response Model
    </h2>
  </header>
  <div class="entry-content">
    <p>本篇文章介绍 FastAPI 的返回类型 response model
可以在返回函数的类型注解中声明该接口的响应数据类型
类型注解的用法和输入数据参数一样, 可以使用:
Pydantic 模型 list 列表 dict 字典 scalar 标量值 (int, bool …) @app.post(&#34;/items/&#34;) async def create_item(item: Item) -&gt; Item: ... @app.get(&#34;/items/&#34;) async def read_items() -&gt; list[Item]: ... FastAPI 会使用返回类型完成一下事情:
验证返回类型 如果返回的数据无效, 说明业务代码有问题, FastAPI 会返回服务器错误, 而不是把数据发给客户端
在 OpenAPI 中为响应添加 JSON Schema 用于自动生成接口文档, 自动生成客户端代码
最重要的是 它会限制并过滤出数据, 只保留返回类型中定义的字段
response_model Parameter 有时候可能需要返回的数据和类型注解不完全一致, 例如:
可能想返回字典或数据库对象, 但声明的响应类型为 Pydantic 模型 这样 Pydantic 会做数据文档、验证等工作, 即使返回的是字典或 ORM 对象 如果直接用返回类型注解, 编辑器会提示类型不匹配的错误
这种情况下, 可以用路径装饰器的 response_model 参数来声明响应类型, 而不是用返回类型注解
class Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None tags: list[str] = [] @app.post(&#34;/items/&#34;, response_model=Item) async def create_item(item: Item) -&gt; Any: return item @app.get(&#34;/items/&#34;, response_model=list[Item]) async def read_items() -&gt; Any: return [ {&#34;name&#34;: &#34;Portal Gun&#34;, &#34;price&#34;: 42.0}, {&#34;name&#34;: &#34;Plumbus&#34;, &#34;price&#34;: 32.0}, ] 注意:
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-08-12 08:00:00 +0800 CST'>August 12, 2025</span>&nbsp;·&nbsp;<span>5 min</span>&nbsp;·&nbsp;<span>918 words</span>&nbsp;·&nbsp;<span>Starslayerx</span></footer>
  <a class="entry-link" aria-label="post link to FastAPI Response Model" href="http://localhost:1313/posts/fastapi-response-model/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Fastapi Cookie and Header Parameters
    </h2>
  </header>
  <div class="entry-content">
    <p>这篇文章介绍 Fastapi 的 Cookie 和 Header 参数
Cookie Parameters 通过定义 Query 和 Path 参数一样定义 Cookie 参数
from typing Annotated from fastapi import Cookie, FastAPI app = FastAPI() @app.get(&#34;/items/&#34;) async def read_items(ads_id: Annotated[str | None, Cookie()] = None): return {&#34;ads_id&#34;: ads_id} Cookie Parameters Models 如果有一组相关的 cookies, 可以使用 Pydantic model 来声明.
这样可以在多个部分复用这个模型, 同时还能一次性为所有参数声明验证规则和元数据.
下面使用 Pydantic 模型定义 Cookies, 然后将参数声明为 Cookie
from typing import Annotated from fastapi import FastAPI, Cookie from pydantic import BaseModel app = FastAPI() class Cookie(BaseModel): session_id: str fatebook_tracker: str | None = None googall_tracker: str | None = None @app.get(&#34;/items/&#34;) async def read_items(cookies: Annotated[Cookies, Cookie()]): return cookies Forbid Extra Cookies 禁止额外的Cookie 在某些场景下(虽然并不常见), 可能希望限制 API 只能接收特定的 Cookie. 这样, API 就可以&#34;自己&#34;管理 Cookie 同意策略了.
from typing import Annotated from fastapi import FastAPI, Cookie from pydantic import BaseModel app = FastAPI() class Cookies(BaseModel): model_config = {&#34;extra&#34;: &#34;forbid&#34;} # forbid extra cookies session_id: str fatebook_tracker: str | None = None googall_tracker: str | None = None @app.get(&#34;/items/&#34;) async def read_items(cookies: Annotated[Cookies, Cookie()]): return cookies 这样, 如果客户端发送额外的 cookies, 则会收到一个错误响应. 例如, 客户端发送了 santa_tracker 这个额外 Cookie
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-08-11 08:00:00 +0800 CST'>August 11, 2025</span>&nbsp;·&nbsp;<span>3 min</span>&nbsp;·&nbsp;<span>499 words</span>&nbsp;·&nbsp;<span>Starslayerx</span></footer>
  <a class="entry-link" aria-label="post link to Fastapi Cookie and Header Parameters" href="http://localhost:1313/posts/fastapi-cookie-and-header-parameters/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Python Asyncio Introduce
      <span class="entry-hint" title="Draft">
        <svg xmlns="http://www.w3.org/2000/svg" height="20" viewBox="0 -960 960 960" fill="currentColor">
          <path
            d="M160-410v-60h300v60H160Zm0-165v-60h470v60H160Zm0-165v-60h470v60H160Zm360 580v-123l221-220q9-9 20-13t22-4q12 0 23 4.5t20 13.5l37 37q9 9 13 20t4 22q0 11-4.5 22.5T862.09-380L643-160H520Zm300-263-37-37 37 37ZM580-220h38l121-122-18-19-19-18-122 121v38Zm141-141-19-18 37 37-18-19Z" />
        </svg>
      </span>
    </h2>
  </header>
  <div class="entry-content">
    <p>Fast Introduce 下面代码中, 定义了一个 main() 协程函数, 然后通过 asyncio.run() 来执行它
import asyncio import time async def main(): print(f&#34;{time.ctime()} Hello!&#34;) await asyncio.sleep(1.0) print(f&#34;{time.ctime()} Goodbye!&#34;) asyncio.run(main()) 在实践中, 大多数基于 asyncio 的代码都会使用 run() 函数, 但是要了解实际发生了什么, 参考下面这段代码 (实现了同样的功能)
import asyncio import time async def main(): print(f&#34;{time.ctime()} Hello!&#34;) await asyncio.sleep(1.0) print(f&#34;{time.ctime()} Goodbye!&#34;) loop = asyncio.get_event_loop() # 1 task = loop.create_task(main()) # 2 loop.run_until_complete(task) # 3 pending = asyncio.all_tasks(loop=loop) # 4 for task in pending: # 5 task.cancel() group = asyncio.gather(*pending, return_exceptions=True) # 6 loop.run_until_complete(group) # 7 loop.close() # 8 代码解释:
获取事件循环: 使用 get_event_loop() 创建一个事件循环实例(如果当前线程没有 loop 就会创建一个), 一个线程中, 多次调用 get_running_loop() 会返回同一个 loop 对象
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-08-10 08:00:00 +0800 CST'>August 10, 2025</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>159 words</span>&nbsp;·&nbsp;<span>Starslayerx</span></footer>
  <a class="entry-link" aria-label="post link to Python Asyncio Introduce" href="http://localhost:1313/posts/python-asyncio-introduce/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Python Function Parameters
    </h2>
  </header>
  <div class="entry-content">
    <p>今天是周日, 简单写点吧, 简单总结一下 Python 中函数参数
Python Function Parameters Python 函数参数机制非常灵活丰富, 理解各种参数类型及其用法对于写出优雅、易维护的代码非常重要. 本文将介绍 Python 中函数参数的种类与用法, 并详细讲解 Python 3.8 引入的参数分隔符 / 和 *, 帮助你更好地设计函数接口.
1. Postional Arguments 位置参数 函数定义中最常见的参数, 调用时按顺序传入值
def greet(name, age): print(f&#34;Hello, {name}. You are {age} years old.&#34;) greet(&#34;Alice&#34;, 30) # Hello, Alice. You are 30 years old. 2. Keyword Arguments 关键字参数 调用时以 key=value 形式传入, 顺序可变
greet(age=30, name=&#34;Alice&#34;) 3. Default Arguments 默认参数 定义函数时给参数赋默认值, 调用时可省略
def greet(name, age=20): print(f&#34;Hello, {name}. You are {age} years old.&#34;) greet(&#34;Bob&#34;) # 使用默认年龄20 greet(&#34;Bob&#34;, 25) # 指定年龄 注意: 使用默认参数尽量不要使用可变类型(mutable), 例如列表, 因为默认参数是存储在函数中的, 而非函数实例中, 多次调用会改变默认值的内容. def greet(names: list[str] = [&#34;Alice&#34;, &#34;Bob&#34;]): ... 若希望使用默认值, 建议使用下面这种方法
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-08-10 08:00:00 +0800 CST'>August 10, 2025</span>&nbsp;·&nbsp;<span>2 min</span>&nbsp;·&nbsp;<span>278 words</span>&nbsp;·&nbsp;<span>Starslayerx</span></footer>
  <a class="entry-link" aria-label="post link to Python Function Parameters" href="http://localhost:1313/posts/python-function-parameters/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">FastAPI Body Advanced Uses
    </h2>
  </header>
  <div class="entry-content">
    <p>本篇文章介绍 FastAPI Request Body 的进阶用法
Body - Multiple Parameters 首先, 可以将Path, Query 和 request body 参数声明自由的写在一起
对于 request body 参数可以是可选的, 并且可设置为默认的 None
from typing import Annotated from fastapi import FastAPI, Path from pydantic import BaseModel app = FastAPI() class Item(BaseModel): name: str description: str | None = None price: float tax: float | None = None @app.put(&#34;/items/{item_id}&#34;) async def update_item( item_id: Annotated[int, Path(title=&#34;The ID of the item to get&#34;, ge=0, le=1000)], # Path q: str | None = None, # Query item: Item | None = None, # body ): results = {&#34;item_id&#34;: item_id} if q: results.update({&#34;q&#34;: q}) if item: results.update({&#34;item&#34;: item}) return results Multiple body parameters 多参数请求体 在上面例子中, FastAPI 期望一个包含 Item 属性的 JSON body, 例如
{ &#34;name&#34;: &#34;Foo&#34;, &#34;description&#34;: &#34;The pretender&#34;, &#34;price&#34;: 42.0, &#34;tax&#34;: 3.2 } 但也可以声明多个body parameters, 例如 item 和 user
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-08-09 08:00:00 +0800 CST'>August 9, 2025</span>&nbsp;·&nbsp;<span>5 min</span>&nbsp;·&nbsp;<span>911 words</span>&nbsp;·&nbsp;<span>Starslayerx</span></footer>
  <a class="entry-link" aria-label="post link to FastAPI Body Advanced Uses" href="http://localhost:1313/posts/fastapi-body-advanced-uses/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Git Whitelist
    </h2>
  </header>
  <div class="entry-content">
    <p>有时你开启了一个新的项目, 运行了 cargo init、uv init 和 go mod init
这些命令创建了工作所需要的必要文件, 同时也在 .gitignore 文件中添加了以下内容
target __pycache__ bin 一切都很顺利, 你继续开发新功能, 等到时机成熟时就将项目发布到了 Git 托管平台上
人们开始对你的项目感兴趣, 甚至有人决定为你实现一个新功能, 这简直是免费劳动力!
当你查看代码, 发现了一个格格不入的文件 .DS_Store, 你问那个人这是什么, 他说他根本不知道
然后你只是将该文件从分支里面删除, 并把文件名加入了仓库的 .gitignore
target __pycache__ bin .DS_Store 现在代码合并到了 main, 仓库里只包含有用的内容
接着, 另一人使用基于 Web 技术的 IDE 提交了另一个合并请求, 一看发现有一个完全无关的目录也被提交了, 于是 .gitignore 里又增加了一条内容
target __pycache__ bin .DS_Store .vscode 接下来, 有人使用 IntelliJ IDEA 提交了五百个 XML 文件和 .idea 目录, 这时又不得不将其加入 .gitignore
target __pycache__ bin .DS_Store .vscode .idea 多年后, .gitignore 已经有了上百行, 但是仍然时不时有各种奇怪的文件, 例如 testscripts、foo、a、qux、data.tar.gz、start.sh、cat ……
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-08-08 08:00:00 +0800 CST'>August 8, 2025</span>&nbsp;·&nbsp;<span>1 min</span>&nbsp;·&nbsp;<span>127 words</span>&nbsp;·&nbsp;<span>Starslayerx</span></footer>
  <a class="entry-link" aria-label="post link to Git Whitelist" href="http://localhost:1313/posts/git-whitelist/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">FastAPI Parameters and Validations
    </h2>
  </header>
  <div class="entry-content">
    <p>这篇文章介绍 FastAPI 中的参数验证功能
Query Parameters and String Validations FastAPI 允许为参数声明额外的信息和验证规则
from fastapi import FastAPI app = FastAPI() @app.get(&#34;/items/&#34;) async def read_items(q: str | None = None): results = {&#34;items&#34;: [{&#34;item_id&#34;: &#34;Foo&#34;}, {&#34;item_id&#34;: &#34;Bar&#34;}]} if q: results.update({&#34;q&#34;: q}) return results q 是类型为 str | None 的查询参数, 这意味着它可以是字符串, 也可以是 None. 其默认值是 None, 因此 FastAPI 会识别它为“可选参数”
FastAPI 通过 = None 的默认值知道该参数是非必填的
使用 str | None 还能帮助编辑器提供更好的类型提示和错误检测
Additional validation 额外验证 即使 q 是可选的, 但仍然可以设置条件: 如果提供了 q, 则长度不能超过50个字符
使用 Query 和 Annotated 来实现
from typing import Annotated from fastapi import FastAPI, Query app = FastAPI() @app.get(&#34;/items/&#34;) async def read_items(q: Annotated[str | None, Query(max_length=50)] = None): results = {&#34;items&#34;: [{&#34;item_id&#34;: &#34;Foo&#34;}, {&#34;item_id&#34;: &#34;Bar&#34;}]} if q: results.update({&#34;q&#34;: q}) return results 使用 Annotated 包装后, 就可以传递额外的元数据(Query(max_length=5)), 用于校验或者文档
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-08-07 08:00:00 +0800 CST'>August 7, 2025</span>&nbsp;·&nbsp;<span>4 min</span>&nbsp;·&nbsp;<span>779 words</span>&nbsp;·&nbsp;<span>Starslayerx</span></footer>
  <a class="entry-link" aria-label="post link to FastAPI Parameters and Validations" href="http://localhost:1313/posts/fastapi-parameters-and-validations/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">FastAPI Parameters
    </h2>
  </header>
  <div class="entry-content">
    <p>FastAPI 是一个现代、快速（高性能）的 Python Web 框架, 它自动处理参数的解析、验证和文档生成
本文将介绍 FastAPI 中三类最常用的参数: 路径参数 (Path Parameters)、查询参数 (Query Parameters) 和 请求体(Request Body) 的用法与原理
1. Path Parameters 路径参数 路径参数是 URL 路径中的动态部分, 使用 {} 包裹表示
from fastapi import FastAPI app = FastAPI() @app.get(&#34;/items/{item_id}&#34;) async def read_item(item_id: str): return {&#34;item_id&#34;: item_id} 访问 /items/foo 返回:
{&#34;item_id&#34;: &#34;foo&#34;} Data conversion &amp; validation 类型声明与自动转换 可以为路径参数声明类型, FastAPI 会自动解析并验证:
@app.get(&#34;/items/{item_id}&#34;) async def read_item(item_id: int): return {&#34;item_id&#34;: item_id} 访问 /items/3, item_id 会被转换为 int 类型
Routing orders 路由匹配顺序 路径匹配按声明顺序执行, 例如
@app.get(&#34;/users/me&#34;) async def read_user_me(): return {&#34;user_id&#34;: &#34;current_user&#34;} @app.get(&#34;/users/{user_id}&#34;) async def read_user(user_id: str): return {&#34;user_id&#34;: user_id} 必须先声明 /users/me, 否则会被 /users/{user_id} 捕获
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-08-06 08:00:00 +0800 CST'>August 6, 2025</span>&nbsp;·&nbsp;<span>3 min</span>&nbsp;·&nbsp;<span>525 words</span>&nbsp;·&nbsp;<span>Starslayerx</span></footer>
  <a class="entry-link" aria-label="post link to FastAPI Parameters" href="http://localhost:1313/posts/fastapi-parameters/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Python Tricks
    </h2>
  </header>
  <div class="entry-content">
    <p>1. The Self-Replicating Trick 将一个含有空列表的列表乘5, 得到有5个空列表的列表
x = [[]] * 5 x [[], [], [], [], []]
当使用.append(&#34;x&#34;)方法时, 所有列表都被修改
x[0].append(&#34;x&#34;) x [[“x”], [“x”], [“x”], [“x”], [“x”]]
打印其 id 可以看到, id 都相同
for item in x: print(id(item)) 4417579584
4417579584
4417579584
4417579584
4417579584
或者使用set()发现 id 唯一
set(id(item) for item in x) {4417579584}
也就是说, 当使用乘法的时候, 创建了5个内部列表的引用副本
使用反汇编发现, 只创建了两个列表, 并执行乘5
dis.dis(&#34;[[]] * 5&#34;) 0 0 RESUME 0 # 用于支持解释器恢复 (py3.11) 1 2 BUILD_LIST 0 # 构造一个空列表[], 压栈 4 BUILD_LIST 1 # 从栈顶取一个对象, 构造列表[[]] 6 LOAD_CONST 0 (5) # 加载常量 5 8 BINARY_OP 5 (*) # 对栈顶两个元素执行乘法 12 RETURN_VALUE # 返回栈顶结果 The alternative 如果要构造独立列表, 应改用列表推导式
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-08-05 08:00:00 +0800 CST'>August 5, 2025</span>&nbsp;·&nbsp;<span>3 min</span>&nbsp;·&nbsp;<span>432 words</span>&nbsp;·&nbsp;<span>Starslayerx</span></footer>
  <a class="entry-link" aria-label="post link to Python Tricks" href="http://localhost:1313/posts/python-tricks/"></a>
</article>

<article class="post-entry"> 
  <header class="entry-header">
    <h2 class="entry-hint-parent">Executing arbitrary Python code from a comment
    </h2>
  </header>
  <div class="entry-content">
    <p>通过注释执行任意Python代码
问题描述 Q: 只能控制一行的.py代码中注释的内容(\n\r均会被替换为空字符), 如何执行任意代码?
A: 在注释#中, 构造一个.zip 文件, python 会将该内容当成一个zip包执行, 触发任意代码执行
解决方案 从 Python 3.5 起, 可以直接执行一个 .zip 文件
python myapp.zip 前提是ZIP 包中包含一个顶层的__main__.py文件, Python 会把它当作 zipapp, 自动解压并运行__main__.py
Python 会从末尾找到 ZIP 的目录结构, 而不是依赖文件头, 所以前面的“垃圾”字节会被忽略
Python 源码中的任何行, 只要以 # 开头, 解释器都会忽略后面内容, 因此可以:
把 ZIP 文件的数据藏在 Python 源码中的注释中（开头加 #） 把 ZIP 数据直接拼接在 Python 文件的后面, 只保证文件头部分是合法 Python ZIP 不关心前缀, Python 只要最前面是有效源码, 也不会管后面 难点 ZIP 文件头包含二进制字段，比如
偏移量（文件数据相对于 ZIP 开头的位置） 长度（文件名长度、注释长度等） 这些值写死在 header 里, 是十六进制整数 如果这些字节中出现了像 \x00、\xFF 等非 ASCII 内容, Python 就不能把它当注释 解决方法: 暴力穷举合法组合
...</p>
  </div>
  <footer class="entry-footer"><span title='2025-08-04 08:00:00 +0800 CST'>August 4, 2025</span>&nbsp;·&nbsp;<span>3 min</span>&nbsp;·&nbsp;<span>561 words</span>&nbsp;·&nbsp;<span>Starslayerx</span></footer>
  <a class="entry-link" aria-label="post link to Executing arbitrary Python code from a comment" href="http://localhost:1313/posts/executing-arbitrary-python-code-from-a-comment/"></a>
</article>
<footer class="page-footer">
  <nav class="pagination">
    <a class="prev" href="http://localhost:1313/posts/page/9/">
      «&nbsp;Prev&nbsp;
    </a>
    <a class="next" href="http://localhost:1313/posts/page/11/">Next&nbsp;&nbsp;»
    </a>
  </nav>
</footer>
    </main>
    
<footer class="footer">
        <span>&copy; 2026 <a href="http://localhost:1313/">Starslayerx&#39; Blog</a></span> · 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu');
    if (menu) {
        
        const scrollPosition = localStorage.getItem("menu-scroll-position");
        if (scrollPosition) {
            menu.scrollLeft = parseInt(scrollPosition, 10);
        }
        
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        const html = document.querySelector("html");
        if (html.dataset.theme === "dark") {
            html.dataset.theme = 'light';
            localStorage.setItem("pref-theme", 'light');
        } else {
            html.dataset.theme = 'dark';
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
